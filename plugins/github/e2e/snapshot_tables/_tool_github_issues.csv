github_id,repo_id,number,state,title,body,priority,type,status,author_id,author_name,assignee_id,assignee_name,lead_time_minutes,url,closed_at,github_created_at,github_updated_at,severity,component,_raw_data_params,_raw_data_table,_raw_data_id,_raw_data_remark
339004478,134018330,1,closed,æµ‹è¯•å‘ç°ä½¿ç”¨æ± è®¡ç®—æ—¶é—´å¹¶æ²¡æœ‰ç¼©çŸ­ï¼Œåªæœ‰å†…å­˜å ç”¨å˜å°äº†ã€‚,"![image](https://user-images.githubusercontent.com/3971390/42390612-0f596eca-817f-11e8-975a-bb8091f5dd5a.png)
æ‚¨å¥½ï¼Œæˆ‘æŠŠæ‚¨çš„ä»£ç æ‹‰å€’æœ¬åœ°ï¼Œè¿è¡Œäº†æµ‹è¯•ï¼Œä½†æ˜¯å‘ç°ï¼Œæµ‹è¯•ç»“æœå’Œæ‚¨æˆªå›¾ç»“æœæ˜¯æœ‰å·®è·çš„ï¼Œåªæ˜¯å†…å­˜å ç”¨å˜å°‘äº†ï¼Œä½†æ˜¯è®¡ç®—çš„æ—¶é—´å¹¶æ²¡æœ‰æ‚¨æµ‹è¯•çš„é‚£ç§æå‡ï¼Œå¸Œæœ›å¯ä»¥è¯·æ•™ä¸€ä¸‹è¿™é‡Œçš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ",,,,3971390,ppmoon,0,,731,https://github.com/panjf2000/ants/issues/1,2018-07-07T12:58:38.000+08:00,2018-07-07T00:46:59.000+08:00,2018-07-07T12:58:38.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,7,
340102987,134018330,2,closed,å‡½æ•°æ‰§è¡Œä¿æŠ¤,"```
func (w *Worker) run() {
	//atomic.AddInt32(&w.pool.running, 1)
	go func() {
		for f := range w.task {
			if f == nil {
				atomic.AddInt32(&w.pool.running, -1)
				return
			}
			f()//ç›´æ¥æ‰§è¡Œäº†
			w.pool.putWorker(w)
		}
	}()
}
```

é‚£ä¹ˆä¼šä¸ä¼šå‡ºç°fæ‰§è¡Œé”™è¯¯å´©æºƒçš„æƒ…å†µï¼Ÿ
åŠ ä¸ªæ‰§è¡Œä¿æŠ¤ä¸çŸ¥é“è¡Œä¸è¡Œã€‚ã€‚ã€‚æ–°æ‰‹ã€‚",,,,3714381,imnewbe,0,,1921,https://github.com/panjf2000/ants/issues/2,2018-07-12T22:04:26.000+08:00,2018-07-11T14:02:56.000+08:00,2018-07-12T22:04:26.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,8,
344278000,134018330,3,closed,workers ä½¿ç”¨slice è¿˜æ˜¯listé—®é¢˜,"çœ‹äº†ä¸‹ä»£ç ï¼Œ Poolæ˜¯ç”¨sliceæ¥è£…workersï¼Œ ä½†Poolçš„æ“ä½œä¸­ï¼Œé™¤äº†purgeå’Œreleaseä¸­éœ€è¦éå†workersï¼Œ getWorkerå’ŒputWorker éƒ½æ˜¯å¯¹é˜Ÿå°¾å‡ºé˜Ÿå…¥é˜Ÿçš„æ“ä½œï¼Œ æ˜¯å¦å¯ä»¥è€ƒè™‘ç”¨ container/list ? (å‡è®¾ï¼Œè¿˜æ²¡éªŒè¯)ã€‚


å¦å¤–è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œ åœ¨putWokersæ—¶æœ‰ä¸ªappendæ“ä½œï¼Œ è¿™é‡Œæ˜¯ä¸æ˜¯å¯ä»¥åœ¨NewPoolæ—¶ï¼Œ ç»™workers slice é¢„åˆ†é…ä¸€äº›ç©ºé—´å‘¢ï¼Ÿ",,,,16658738,barryz,0,,1390,https://github.com/panjf2000/ants/issues/3,2018-07-26T10:32:41.000+08:00,2018-07-25T11:22:01.000+08:00,2018-07-26T10:32:41.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,9,
346842831,134018330,5,closed,å…³äº <-p.freeSignal çš„ç–‘æƒ‘,"Hi,
    æˆ‘é˜…è¯»äº†æºç ï¼Œå¯¹ `<-p.freeSignal` è¿™å¥ä»£ç æœ‰ç–‘æƒ‘ã€‚ è¿™å¥ä»£ç å‡ºç°åœ¨äº†å¤šä¸ªåœ°æ–¹ï¼ŒfreeSignal çš„ä½œç”¨è‹±æ–‡æ³¨é‡Šæˆ‘æ˜¯ç†è§£çš„ï¼Œå¹¶ä¸”çŸ¥é“åœ¨ `putWorker` ä¸­æ‰è¿›è¡Œ `p.freeSignal <- sig{}`

å¯¹äºä¸‹é¢çš„ä»£ç 
```
func (p *Pool) getWorker() *Worker {
	var w *Worker
	waiting := false

	p.lock.Lock()
	idleWorkers := p.workers
	n := len(idleWorkers) - 1
	if n < 0 { // è¯´æ˜ poolä¸­æ²¡æœ‰workeräº†
		waiting = p.Running() >= p.Cap()
	} else { // è¯´æ˜poolä¸­æœ‰worker
		<-p.freeSignal      
		w = idleWorkers[n]  
		idleWorkers[n] = nil
		p.workers = idleWorkers[:n]
	}
	p.lock.Unlock()


func (p *Pool) Release() error {
	p.once.Do(func() { // ä¿è¯åªé‡Šæ”¾ä¸€æ¬¡
		p.release <- sig{}
		p.lock.Lock()
		idleWorkers := p.workers
		for i, w := range idleWorkers {
			<-p.freeSignal
			w.task <- nil
			idleWorkers[i] = nil
		}
		p.workers = nil
		p.lock.Unlock()
	})
	return nil
}

```

ä¸­çš„ `<-p.freeSignal`ï¼Œ é‚£ä¸æ˜¯è¦ç­‰putWorkerè§¦å‘äº†æ‰ä¼šç»§ç»­è¿›è¡Œå—ï¼Ÿå¦‚æœ putWorkerä¸è§¦å‘ï¼Œå°±ä¸€ç›´é˜»å¡åœ¨é‚£äº†ï¼Œå³ä½¿ idleWorkers ä¸­å¯èƒ½æ˜¯æœ‰workerçš„

å¯å¦è§£é‡Šä¸‹è¿™è¾¹çš„é€»è¾‘ï¼Ÿè°¢è°¢",,,,8605102,pathbox,0,,2182,https://github.com/panjf2000/ants/issues/5,2018-08-03T23:32:00.000+08:00,2018-08-02T11:09:57.000+08:00,2018-08-10T12:06:36.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,11,
347255859,134018330,6,closed,æ­»é”bug,"func (p *Pool) getWorker() *Worker  è¿™ä¸ªå‡½æ•°çš„ 199è¡Œ 
å¿…é¡»å…ˆè§£é”åœ¨åŠ é”ï¼Œ è¦ä¸ç„¶ä¼šäº§ç”Ÿæ­»é”

	p.lock.Unlock()
		<-p.freeSignal
		p.lock.Lock()",,,,13118848,lovelly,0,,1786,https://github.com/panjf2000/ants/issues/6,2018-08-04T18:18:41.000+08:00,2018-08-03T12:32:28.000+08:00,2018-08-04T18:18:41.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,12,
348630179,134018330,7,closed,æ¸…ç†è¿‡æœŸåç¨‹æŠ¥é”™,"ä½ å¥½ï¼Œéå¸¸æ„Ÿè°¢æä¾›è¿™ä¹ˆå¥½ç”¨çš„å·¥å…·åŒ…ã€‚æˆ‘åœ¨ä½¿ç”¨antsæ—¶ï¼Œå‘ç°æŠ¥å¼‚å¸¸ã€‚ç»“æœè§ä¸‹å›¾
![image](https://user-images.githubusercontent.com/4555057/43823431-98384444-9b21-11e8-880c-7458b931734a.png)
æ—¥å¿—æ˜¯æˆ‘åœ¨periodicallyPurgeé‡ŒåŠ çš„è°ƒè¯•ä¿¡æ¯
![image](https://user-images.githubusercontent.com/4555057/43823534-e3c624a8-9b21-11e8-96c6-512e3e08db22.png)

### åŸå› åˆ†æ

æˆ‘è®¤ä¸ºå¯èƒ½åŸå› æ˜¯æ²¡æœ‰å¤„ç†n==0çš„æƒ…å†µ
```
if n > 0 {
	n++
	p.workers = idleWorkers[n:]
}
```


### æµ‹è¯•ä»£ç 
```
package main

import (
	""github.com/panjf2000/ants""
	""fmt""
	""time""
	""strconv""
)

func main() {

	pool,err := ants.NewPool(100000)

	if err != nil {
		panic(err)
	}

	for i:=0;i<10000;i++{
		pool.Submit(
			func() error {
				time.Sleep(1 * time.Millisecond)
				fmt.Println(strconv.Itoa(i))
				return nil
			})
	}

	for{
		pool.Submit(
			func() error {
				time.Sleep(10 * time.Millisecond)
			return nil
		})
		time.Sleep(1 * time.Millisecond)
	}
}
```",,,,4555057,huiwq1990,0,,2602,https://github.com/panjf2000/ants/issues/7,2018-08-10T12:06:04.000+08:00,2018-08-08T16:43:15.000+08:00,2018-08-10T12:06:04.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,13,
356703393,134018330,10,closed,é«˜å¹¶å‘ä¸‹è®¾å®šè¾ƒå°çš„workeræ•°é‡é—®é¢˜,ä¼šå­˜åœ¨cpué£šå‡çš„é—®é¢˜å§ï¼Ÿ,,,,11763614,Moonlight-Zhao,0,,36198,https://github.com/panjf2000/ants/issues/10,2018-09-29T19:45:00.000+08:00,2018-09-04T16:26:55.000+08:00,2018-09-29T19:45:00.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,16,
364361014,134018330,12,closed,æ½˜å°‘ï¼Œæ›´æ–°ä¸‹tagå§,é„™äººç°åœ¨åœ¨å¼„depä¾èµ–ç®¡ç†ï¼Œæœ‰ç”¨åˆ°ä½ å†™çš„antsé¡¹ç›®ï¼Œå¯æ˜¯ä½ å¥½åƒå¿˜è®°æ‰“æœ€æ–°çš„tagäº†ã€‚æœ€æ–°çš„tag 3.6æ˜¯æŒ‡å‘ed55924è¿™ä¸ªæäº¤ï¼Œgitä¸Šçš„æœ€æ–°ä»£ç æ˜¯af376f1bè¿™æ¬¡æäº¤ï¼Œä¸¤æ¬¡æäº¤éƒ½éš”äº†å¿«5ä¸ªæœˆäº†ï¼Œçœ‹åˆ°çš„è¯ï¼Œéº»çƒ¦æ‰“ä¸€ä¸ªæœ€æ–°çš„tagå§ã€‚ï¼ˆæ‰‹åŠ¨å¯æ€œï¼‰,,,,29452204,edcismybrother,0,,1293,https://github.com/panjf2000/ants/issues/12,2018-09-28T14:05:58.000+08:00,2018-09-27T16:32:25.000+08:00,2019-04-21T16:19:58.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,18,
381941219,134018330,17,closed,å…³äºä¼˜é›…é€€å‡ºçš„é—®é¢˜,"å…³äºè¿™ä¸ªpackageä¼˜é›…é€€å‡ºçš„é—®é¢˜ï¼Œæˆ‘çœ‹äº†ä¸€ä¸‹Releaseçš„ä»£ç ï¼š

`
	// Release Closed this pool.
	func (p *PoolWithFunc) Release() error {
		p.once.Do(func() {
			p.release <- sig{}
			p.lock.Lock()
			idleWorkers := p.workers
			for i, w := range idleWorkers {
				w.args <- nil
				idleWorkers[i] = nil
			}
			p.workers = nil
			p.lock.Unlock()
		})
		return nil
	}
`

releaseä¸­ï¼Œå¥½åƒæ²¡æœ‰å»ç­‰å¾…é‚£äº›å·²ç»æ­£åœ¨å·¥ä½œçš„workerå¤„ç†å®Œå®ƒä»¬çš„å·¥ä½œï¼Ÿ
ä»…ä»…æ˜¯å›æ”¶äº†ç©ºé—²çš„worker

é‚£ä¹ˆåœ¨æ”¶åˆ°ç¨‹åºé€€å‡ºçš„ä¿¡å·æ—¶å€™ï¼Œreleaseæ˜¯ä¸èƒ½ç¡®ä¿æ­£åœ¨å·¥ä½œçš„workerèƒ½å¦¥å–„å®Œæˆå·¥ä½œ

å¦‚æœæƒ³å®ç°æ¯”è¾ƒå¥½é€€å‡ºæ–¹å¼ç›®å‰å¥½åƒæ˜¯ï¼š

ReSize(0) 

ä¸çŸ¥é“æˆ‘ç†è§£çš„å¯¹ä¸å¯¹ï¼Ÿ
",,,,7931755,zplzpl,0,,103594,https://github.com/panjf2000/ants/issues/17,2019-01-29T15:24:37.000+08:00,2018-11-18T16:50:31.000+08:00,2019-01-29T15:24:37.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,23,
382039050,134018330,18,closed,goåç¨‹çš„ç†è§£,"ä½ å¥½æ¥¼ä¸»ï¼Œå‘æ‚¨è¯·æ•™ä¸€ä¸ªåç¨‹å’Œçº¿ç¨‹çš„é—®é¢˜ï¼Œåç¨‹åŸºäºgoè¿›ç¨‹è°ƒåº¦ï¼Œçº¿ç¨‹åŸºäºç³»ç»Ÿå†…æ ¸è°ƒåº¦ï¼Œè°ƒåº¦åç¨‹çš„è¿‡ç¨‹æ˜¯å…ˆè°ƒåº¦çº¿ç¨‹åè·å¾—èµ„æºå†å»è°ƒåº¦åç¨‹ã€‚""å®˜æ–¹è§£é‡Šï¼š GOMAXPROCS sets the maximum number of CPUs that can be executing simultaneouslyã€‚é™åˆ¶cpuæ•°ï¼Œæœ¬è´¨ä¸Šæ˜¯ä»€ä¹ˆï¼Œé™åˆ¶å¹¶è¡Œæ•°?ï¼Œå¹¶è¡Œæ•°å³åŒæ—¶æ‰§è¡Œæ•°é‡?ï¼Œæ‰§è¡Œå•å…ƒå³çº¿ç¨‹?ï¼Œå³é™åˆ¶æœ€å¤§å¹¶è¡Œçº¿ç¨‹æ•°é‡?""",,,,13944100,LinuxForYQH,0,,20213,https://github.com/panjf2000/ants/issues/18,2018-12-03T11:53:50.000+08:00,2018-11-19T10:59:53.000+08:00,2018-12-03T11:53:50.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,24,
382574800,134018330,20,closed,æ˜¯å¦è€ƒè™‘ä»»åŠ¡æ”¯æŒå›è°ƒå‡½æ•°å¤„ç†å¤±è´¥çš„é€»è¾‘å’Œä»»åŠ¡ä¾èµ–,#,,,,5668717,kklinan,0,,95398,https://github.com/panjf2000/ants/issues/20,2019-01-25T23:34:03.000+08:00,2018-11-20T17:36:02.000+08:00,2019-01-25T23:34:03.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,26,
388907811,134018330,21,closed,Benchmark ä¸‹ç›´æ¥ä½¿ç”¨ Semaphore ä¼¼ä¹æ›´å¿«å‘¢ï¼Ÿ,"ç®€å•è·‘äº†ä¸€ä¸‹ benchmarkï¼ŒSemaphore æ›´å¿«ä¸”å¾ˆç®€å•

```bash
$ go test -bench .
goos: darwin
goarch: amd64
pkg: github.com/panjf2000/ants
BenchmarkGoroutineWithFunc-4   	       1	3445631705 ns/op
BenchmarkSemaphoreWithFunc-4   	       1	1037219073 ns/op
BenchmarkAntsPoolWithFunc-4    	       1	1138053222 ns/op
BenchmarkGoroutine-4           	       2	 731850771 ns/op
BenchmarkSemaphore-4           	       2	 914855967 ns/op
BenchmarkAntsPool-4            	       1	1094379445 ns/op
PASS
ok  	github.com/panjf2000/ants	33.173s
```
é‚£ Ants åœ¨ä»€ä¹ˆæƒ…å†µä¸‹æœ‰ä¼˜åŠ¿å‘¢ï¼Ÿ",,,,720086,huangjunwen,0,,8392,https://github.com/panjf2000/ants/issues/21,2018-12-14T14:01:07.000+08:00,2018-12-08T18:08:17.000+08:00,2018-12-14T14:01:07.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,27,
401277739,134018330,22,closed,æ˜¯å¦è€ƒè™‘ worker ä¸­æ·»åŠ   PanicHandler ï¼Ÿ,æ¯”æ–¹è¯´åœ¨åˆ›å»º Pool çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ª PanicHandlerï¼Œç„¶ååœ¨æ¯ä¸ª worker åˆ›å»ºçš„æ—¶å€™ recover ä¹‹åä¼ ç»™ PanicHandler  å¤„ç†ã€‚å¦åˆ™æ± å­é‡Œå¦‚æœå‘ç”Ÿ panic ä¼šç›´æ¥æŒ‚æ‰æ•´ä¸ªè¿›ç¨‹ã€‚,,,,8923413,choleraehyq,0,,1174,https://github.com/panjf2000/ants/issues/22,2019-01-22T13:41:34.000+08:00,2019-01-21T18:06:56.000+08:00,2019-01-22T13:41:34.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,28,
402513849,134018330,24,closed,æäº¤ä»»åŠ¡ä¸é˜»å¡,`Pool.Submit`å’Œ`PoolWithFunc.Server`æäº¤ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰ç©ºçš„workerï¼Œä¼šä¸€ç›´é˜»å¡ã€‚å»ºè®®å¢åŠ ä¸é˜»å¡çš„æ¥å£ï¼Œå½“å‰å¤±è´¥æ—¶ç›´æ¥è¿”å›é”™è¯¯ã€‚,,,,5044825,tenfyzhong,0,,300032,https://github.com/panjf2000/ants/issues/24,2019-08-20T18:56:30.000+08:00,2019-01-24T10:24:13.000+08:00,2019-08-20T18:56:30.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,30,
405951301,134018330,25,closed,use example errors,"./antstest.go:37:14: cannot use syncCalculateSum (type func()) as type ants.f in argument to ants.Submit
./antstest.go:45:35: cannot use func literal (type func(interface {})) as type ants.pf in argument to ants.NewPoolWithFunc
",,,,5244267,jiashiwen,0,,3088,https://github.com/panjf2000/ants/issues/25,2019-02-04T17:11:52.000+08:00,2019-02-02T13:43:38.000+08:00,2019-02-04T17:11:52.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,31,
413968505,134018330,26,closed,runningå¯èƒ½å¤§äºcapçš„é—®é¢˜,"runningä¸capçš„æ¯”è¾ƒåˆ¤æ–­ä¸incRuningåˆ†å¼€æ‰§è¡Œçš„, å¯èƒ½ä¼šå‡ºç°runningå¤§äºcapçš„é—®é¢˜?
`func (p *Pool) retrieveWorker() *Worker {
	var w *Worker

	p.lock.Lock()
	idleWorkers := p.workers
	n := len(idleWorkers) - 1
	if n >= 0 {
		w = idleWorkers[n]
		idleWorkers[n] = nil
		p.workers = idleWorkers[:n]
		p.lock.Unlock()
	} else if p.Running() < p.Cap() {
		p.lock.Unlock()
		if cacheWorker := p.workerCache.Get(); cacheWorker != nil {
			w = cacheWorker.(*Worker)
		} else {
			w = &Worker{
				pool: p,
				task: make(chan func(), workerChanCap),
			}
		}
		w.run()`",,,,10361713,Ainiroad,0,,21872,https://github.com/panjf2000/ants/issues/26,2019-03-12T20:01:57.000+08:00,2019-02-25T15:29:33.000+08:00,2019-03-12T20:01:57.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,32,
419183961,134018330,27,closed,ä¸ºä½•goroutineä¸€ç›´ä¸Šä¸å»ï¼Œç”¨æˆ·é‡ä¹Ÿæ‰“ä¸ä¸Šå»,"ä¸ºä½•goroutineä¸€ç›´ä¸Šä¸å»ï¼Œç”¨æˆ·é‡ä¹Ÿæ‰“ä¸ä¸Šå»
æ˜¯æˆ‘ç”¨çš„æœ‰é—®é¢˜å—ï¼Ÿ

websocket server
https://github.com/im-ai/pushm/blob/master/learn/goroutine/goroutinepoolwebsocket.go

websocket cient
https://github.com/im-ai/pushm/blob/master/learn/goroutine/goroutinepoolwebsocketclient.go
",,,,38367404,liliang8858,0,,37496,https://github.com/panjf2000/ants/issues/27,2019-04-05T22:05:20.000+08:00,2019-03-10T21:08:52.000+08:00,2019-04-05T22:05:20.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,33,
419268851,134018330,28,closed,cap å’Œ running æ¯”è¾ƒçš„é—®é¢˜,"è¿™æ˜¯æˆ‘åœ¨ Playground ä¸Šé¢çš„ä»£ç  https://play.golang.org/p/D94YUU3FnX6
atomic åªèƒ½ä¿è¯è‡ªå¢è‡ªå‡æ—¶çš„åŸå­æ“ä½œï¼Œåœ¨æ¯”è¾ƒè¿‡ç¨‹ä¸­ï¼Œå…¶ä»–çº¿ç¨‹å¯¹å˜é‡è¿›è¡Œäº†æ“ä½œ æ¯”è¾ƒè¿‡ç¨‹å¹¶æ— æ„ŸçŸ¥ï¼Œæ‰€ä»¥è¿™ä¸ªæ¯”è¾ƒç»“æœ ä¸æ˜¯å®Œå…¨æ­£ç¡®çš„ï¼Œæƒ³è¦å®ç° æ¯”è¾ƒçš„æ•°é‡å®Œå…¨æ­£ç¡®ï¼Œåªèƒ½åœ¨ä¿®æ”¹å’Œæ¯”è¾ƒä¸¤ä¸ªå€¼çš„åœ°æ–¹åŠ é”
åƒ #26 è¯´çš„æ˜¯å¯¹çš„",,,,29243953,naiba,0,,237002,https://github.com/panjf2000/ants/issues/28,2019-08-23T00:27:37.000+08:00,2019-03-11T10:24:41.000+08:00,2019-08-23T00:27:37.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,34,
424634533,134018330,29,closed,ä»»åŠ¡ä¼ å‚,"ä½ å¥½ï¼Œä½ çš„é¡¹ç›®å¤ªé…·äº†ğŸ‘

https://github.com/panjf2000/ants/blob/master/pool.go#L124 è²Œä¼¼ä¸æ”¯æŒå¸¦å‚æ•°çš„ä»»åŠ¡, è¯·é—®ä¼ å‚æ˜¯ç”¨é—­åŒ…çš„æ–¹å¼å—?
",,,,8509898,prprprus,0,,999,https://github.com/panjf2000/ants/issues/29,2019-03-25T17:32:11.000+08:00,2019-03-25T00:52:21.000+08:00,2019-03-25T17:45:05.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,35,
429972115,134018330,31,closed,Add go.mod,,,,,48135919,tsatke,0,,3474,https://github.com/panjf2000/ants/issues/31,2019-04-08T17:45:31.000+08:00,2019-04-06T07:50:36.000+08:00,2019-10-17T11:12:19.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,37,
433564955,134018330,32,closed,å…³äºç‰ˆæœ¬é—®é¢˜ï¼Œæˆ‘å‘ç°å°ç‰ˆæœ¬(0.0.x)è¿™ç§æ›´æ–°å°±ä¼šä¸å‘ä¸‹å…¼å®¹ï¼Ÿ,"å¦‚é¢˜ï¼Œæˆ‘æ„Ÿè§‰è¿™æ ·ä¸å¥½ã€‚

åŠŸèƒ½ç‰ˆæœ¬å·ä¸å‘ä¸‹å…¼å®¹èƒ½ç†è§£

ä¿®å¤é—®é¢˜çš„ç‰ˆæœ¬å·ä¹Ÿä¸å‘ä¸‹å…¼å®¹ï¼Œéš¾ä»¥ç†è§£ã€‚",,,,7931755,zplzpl,0,,7440,https://github.com/panjf2000/ants/issues/32,2019-04-21T15:16:26.000+08:00,2019-04-16T11:16:02.000+08:00,2019-04-21T15:16:26.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,38,
434069015,134018330,33,closed,support semantic versioning.,"å»ºè®®å°†å‘å¸ƒçš„tagå…¼å®¹ä¸ºsemantic versioningï¼ŒvX.Y.Zã€‚go moduleså¯¹æ­¤æ”¯æŒæ¯”è¾ƒè‰¯å¥½ã€‚
https://semver.org/
https://research.swtch.com/vgo-import",,,,1284892,jjeffcaii,0,,6090,https://github.com/panjf2000/ants/issues/33,2019-04-21T16:25:20.000+08:00,2019-04-17T10:55:11.000+08:00,2019-04-21T16:25:20.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,39,
435486645,134018330,34,closed,Important announcement about <ants> from author !!!,"**Dear users of `ants`:**
I am apologetically telling you that I have to dump all tags which already presents in `ants` repository.

The reason why I'm doing so is to standardize the version management with `Semantic Versioning`, which will make a formal and clear dependency management in go, for go modules, godep, or glide, etc. So I decide to start over the tag sequence, you could find more details in [Semantic Versioning](https://semver.org/) and [Semantic Import Versioning](https://research.swtch.com/vgo-import), related issue: #32, #33 (very thankful to @jjeffcaii and @zplzpl who provided the suggestions about it).

I ought to apologize for the bothers brought by this change, the arch-criminal who leads to this issue would be my lack of concept about `Semantic Versioning`, I will spend more times learning the knowledge afterwards. 

Once again, sorry for your costs in this change and thanks for your support to `ants`! 

*Have fun!*

**Best regards,
Andy Pan**
",,,,7496278,panjf2000,0,,23484,https://github.com/panjf2000/ants/issues/34,2019-05-07T23:35:08.000+08:00,2019-04-21T16:10:28.000+08:00,2019-05-07T23:35:08.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,40,
461280653,134018330,35,closed,worker exit on panic,"ä¸ªäººè®¤ä¸ºPanicHandlerè®¾è®¡ä¸å¦¥ã€‚
1.æ— PanicHandleræ—¶ï¼ŒæŠ›å‡ºç»™å¤–é¢çš„ä¸æ˜¯panic,å¤–å±‚æ„Ÿå—ä¸åˆ°ã€‚
2.æ— è®ºæœ‰æ²¡æœ‰PanicHandlerï¼Œéƒ½ä¼šå¯¼è‡´workeré€€å‡ºï¼Œæœ€ç»ˆpoolé˜»å¡ä½å…¨éƒ¨ä»»åŠ¡ã€‚",,,,38849208,king526,0,,74481,https://github.com/panjf2000/ants/issues/35,2019-08-18T04:33:10.000+08:00,2019-06-27T11:11:49.000+08:00,2019-08-18T04:33:10.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,41,
462631417,134018330,37,closed,è¯·ä¸è¦å†éšæ„å˜æ›´ç‰ˆæœ¬å·äº†ã€‚ã€‚ã€‚,ä¹‹å‰ç”¨çš„æ˜¯ 3.9.9ï¼Œç»“æœä»Šå¤©æ„å»ºå‡ºäº†é—®é¢˜ï¼Œä¸€çœ‹å‘ç°è¿™ä¸ªç‰ˆæœ¬æ²¡äº†ï¼Œå˜æˆ 1.0.0ã€‚è¿™ç§å˜æ›´å®Œå…¨ä¸è€ƒè™‘ç°æœ‰ç”¨æˆ·çš„æƒ…å†µã€‚å¸Œæœ›ä»¥åä¸è¦éšæ„å˜æ›´äº†,,,,8923413,choleraehyq,0,,140,https://github.com/panjf2000/ants/issues/37,2019-07-01T20:37:55.000+08:00,2019-07-01T18:17:15.000+08:00,2019-07-02T18:17:31.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,43,
472125082,134018330,38,closed,retrieveWorkerä¸revertWorkerä¹‹é—´ä¼šå¯¼è‡´æ­»é”,"func (p *Pool) retrieveWorker() *Worker {
	var w *Worker

	**p.lock.Lock()**
	idleWorkers := p.workers
	n := len(idleWorkers) - 1
	if n >= 0 {
		w = idleWorkers[n]
		idleWorkers[n] = nil
		p.workers = idleWorkers[:n]
		p.lock.Unlock()
	} else if p.Running() < p.Cap() {
		p.lock.Unlock()
		if cacheWorker := p.workerCache.Get(); cacheWorker != nil {
			w = cacheWorker.(*Worker)
		} else {
			w = &Worker{
				pool: p,
				task: make(chan func(), workerChanCap),
			}
		}
		w.run()
	} else {
		for {
			**p.cond.Wait()** 
			l := len(p.workers) - 1
			if l < 0 {
				continue
			}
			w = p.workers[l]
			p.workers[l] = nil
			p.workers = p.workers[:l]
			break
		}
		**p.lock.Unlock()**
	}
	return w
}

// revertWorker puts a worker back into free pool, recycling the goroutines.
func (p *Pool) revertWorker(worker *Worker) bool {
	if CLOSED == atomic.LoadInt32(&p.release) {
		return false
	}
	worker.recycleTime = time.Now()
	**p.lock.Lock()** // åç¨‹æ± æ»¡äº†ä¹‹åè·å–ä¸åˆ°é”
	p.workers = append(p.workers, worker)
	// Notify the invoker stuck in 'retrieveWorker()' of there is an available worker in the worker queue.
	p.cond.Signal()
	**p.lock.Unlock()**
	return true
}
",,,,1290360,wwjiang,0,,67,https://github.com/panjf2000/ants/issues/38,2019-07-24T16:40:01.000+08:00,2019-07-24T15:32:58.000+08:00,2019-07-24T16:40:01.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,44,
483164833,134018330,42,closed,å¸¦é€‰é¡¹çš„åˆå§‹åŒ–å‡½æ•°ï¼Œæˆ‘è§‰å¾—ç”¨ functional options æ›´å¥½ä¸€ç‚¹,"ä»¥ä¸‹æ˜¯ç¤ºæ„ä»£ç 
å¦‚æœç”¨ functional optionsï¼ŒåŸæ¥çš„å†™æ³•æ˜¯
```
ants.NewPool(10)
```
æ–°çš„å†™æ³•ï¼Œå¦‚æœä¸åŠ  optionï¼Œå†™æ³•æ˜¯ä¸å˜çš„ï¼Œå› ä¸º options æ˜¯ä½œä¸ºå¯å˜å‚æ•°ä¼ è¿›å»çš„ã€‚å¦‚æœè¦åŠ  optionï¼Œåªéœ€è¦æ”¹æˆ
```
ants.NewPool(10, ants.WithNonblocking(true))
```
è¿™æ ·ã€‚

ç°åœ¨æ˜¯ç›´æ¥ä¼ ä¸€ä¸ª Option ç»“æ„ä½“è¿›å»ï¼Œæ‰€æœ‰çš„åœ°æ–¹éƒ½è¦æ”¹ï¼Œæ„Ÿè§‰å¾ˆä¸ä¼˜é›…ã€‚
å…·ä½“ functional options çš„è®¾è®¡å¯ä»¥çœ‹ rob pike çš„ä¸€ç¯‡åšå®¢ https://commandcenter.blogspot.com/2014/01/self-referential-functions-and-design.html",,,,8923413,choleraehyq,0,,732,https://github.com/panjf2000/ants/issues/42,2019-08-21T22:32:51.000+08:00,2019-08-21T10:20:08.000+08:00,2019-08-21T22:32:51.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,48,
483736247,134018330,43,closed,1.3.0 æ˜¯ä¸å…¼å®¹æ›´æ–°,Pool é‡Œé‚£äº›æš´éœ²å‡ºæ¥çš„å­—æ®µï¼ˆPanicHandler ä¹‹ç±»çš„ï¼‰éƒ½æ²¡äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å…¼å®¹æ›´æ–°ï¼Œæ ¹æ®è¯­ä¹‰åŒ–ç‰ˆæœ¬çš„è¦æ±‚è¦å‘å¤§ç‰ˆæœ¬ã€‚,,,,8923413,choleraehyq,0,,652,https://github.com/panjf2000/ants/issues/43,2019-08-22T21:22:10.000+08:00,2019-08-22T10:29:34.000+08:00,2019-08-22T21:22:10.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,49,
484311063,134018330,44,closed,1.1.1 -> 1.2.0 ä¹Ÿæ˜¯ä¸å…¼å®¹æ›´æ–°,Pool.Release çš„è¿”å›å€¼æ²¡äº†,,,,8923413,choleraehyq,0,,3068,https://github.com/panjf2000/ants/issues/44,2019-08-25T14:36:14.000+08:00,2019-08-23T11:27:38.000+08:00,2019-08-25T14:36:14.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,50,
484885860,134018330,45,closed,"p.Tune is only for cutting down pool size, but not support enlarge.","In the Tune Method, the scale up the pool size should be supported also. 
So, before do the pool size change, check which one is bigger for the p.Running() and size, the using the bigger one to minus the small one, then assign the result to diff. 
What do you think? 
-------------------------------
func (p *Pool) Tune(size uint) 
...
**### diff := p.Running() - int(size)**
	for i := 0; i < diff; i++ {
		p.retrieveWorker().task <- nil
	}",,,,31562832,laodano1,0,,168,https://github.com/panjf2000/ants/issues/45,2019-08-25T14:20:09.000+08:00,2019-08-25T11:31:11.000+08:00,2019-08-25T14:20:09.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,51,
484923460,134018330,46,closed,About the ExpiryDuration of ants,workerçš„ExpiryDurationæ—¶é—´æ€ä¹ˆè®¾ç½®ï¼Œä¸€èˆ¬è®¾ç½®æˆå¤šå°‘æ¯”è¾ƒåˆé€‚ï¼Ÿ,,,,41182093,ymichaelson,0,,2469,https://github.com/panjf2000/ants/issues/46,2019-08-27T13:13:44.000+08:00,2019-08-25T20:04:29.000+08:00,2019-08-27T13:13:44.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,52,
485565755,134018330,47,closed,Nonstandard operation to the Existing tag,æˆ‘ä»¬çš„é¡¹ç›®ä¾èµ–äº† 2.0.0-alphaï¼Œä»Šå¤©ä¸€æ„å»ºå‘ç° 2.0.0-alpha åˆæ²¡äº†,,,,8923413,choleraehyq,7496278,panjf2000,86,https://github.com/panjf2000/ants/issues/47,2019-08-27T13:10:32.000+08:00,2019-08-27T11:44:02.000+08:00,2019-08-27T13:10:32.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,53,
491601411,134018330,49,closed,Checksum mismatch for go 1.13,"Expect (go version go1.12.9 darwin/amd64):

```
â†’ go mod tidy -v
go: downloading github.com/panjf2000/ants v1.2.0
go: extracting github.com/panjf2000/ants v1.2.0
```

Actual (go version go1.13 darwin/amd64)
```
â†’ go mod tidy -v
verifying github.com/panjf2000/ants@v1.2.0: checksum mismatch
        downloaded: h1:Ufw4aDz9RqH1RVblx2W9L9Uv5vSX5apbX5+peR7LQ5k=
        sum.golang.org: h1:pMQ1/XpSgnWx3ro4y1xr/uA3jXUsTuAaU3Dm0JjwggE=

SECURITY ERROR
This download does NOT match the one reported by the checksum server.
The bits may have been replaced on the origin server, or an attacker may
have intercepted the download attempt.

For more information, see 'go help module-auth'.
```

---

**UPD**: mb this issue will be useful - https://github.com/golang/go/issues/33665

---

**UPD**: how resolve issue step by step (macOS):
- sudo go clean -modcache
- git checkout go.sum
- go mod tidy -v

---

**UPD** for Linux:
- `cd /another/path`
- `go clean -modcache`
- `cd /project/path`
- `go mod tidy`",,,,888650,im-kulikov,7496278,panjf2000,943402,https://github.com/panjf2000/ants/issues/49,2021-06-26T22:22:09.000+08:00,2019-09-10T19:00:06.000+08:00,2021-06-26T22:22:09.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,55,
492083734,134018330,50,closed,worker åœ¨ revertworker è¿”å› false é€€å‡ºæ—¶æ²¡æœ‰ decRunning,"**Describe the bug**
A clear and concise description of what the bug is.
retrieveWorker ä¸­ï¼Œæœ‰ä¸€ä¸ªåˆ†æ”¯æ˜¯åˆ¤ p.Running() < p.Cap()ï¼Œç„¶å spawnWorkerï¼›ç”±äºè¿™ä¸ªåœ°æ–¹æ²¡é”ï¼Œå¯èƒ½å¾ˆå¤šä¸ª goroutine éƒ½è¿›å…¥åˆ°äº†è¿™ä¸ªåœ°æ–¹ï¼Œè¶…è¿‡äº† Cap çš„æ•°é‡ã€‚

worker å®Œæˆå·¥ä½œä¹‹åï¼ŒrevertWorkerï¼Œä¼šå‘ç° Running > Cap ï¼Œè¿”å› falseï¼Œworker å°±ä¼šé€€å‡ºï¼Œé€€å‡ºå‰æ²¡æœ‰å‡ Runningï¼Œå¯¼è‡´ Running å§‹ç»ˆå¤§äº Capï¼Œæ± å­å¡æ­»ã€‚

**To Reproduce**
Steps to reproduce the behavior:
1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error
ç”Ÿäº§ç¯å¢ƒé«˜è´Ÿè½½ä¸‹å‹å‡ºæ¥çš„ã€‚

**Expected behavior**
A clear and concise description of what you expected to happen.
å¯¼è‡´æ± å­å¡ä½ã€‚

**Error messages/Trace logs**
If applicable, add some logs to help explain your problem.

**System info (please complete the following information):**
 - OS: [e.g. linux, macOS]
 - Go Version [e.g. 1.12]

**Additional context**
Add any other context about the problem here.
",,,,8923413,choleraehyq,7496278,panjf2000,1008,https://github.com/panjf2000/ants/issues/50,2019-09-12T09:00:52.000+08:00,2019-09-11T16:12:26.000+08:00,2019-09-12T09:00:52.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,56,
492130196,134018330,52,closed,workerCache æ²¡æœ‰åˆå§‹åŒ–,"**Describe the bug**
A clear and concise description of what the bug is.
æ²¡æœ‰è®¾ç½® New å‡½æ•°ï¼Œè¿™ä¸ªæ˜¯å¿˜äº†è¿˜æ˜¯æœ‰ä»€ä¹ˆç„æœºå‘¢
**To Reproduce**
Steps to reproduce the behavior:
1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error

**Expected behavior**
A clear and concise description of what you expected to happen.

**Error messages/Trace logs**
If applicable, add some logs to help explain your problem.

**System info (please complete the following information):**
 - OS: [e.g. linux, macOS]
 - Go Version [e.g. 1.12]

**Additional context**
Add any other context about the problem here.
",,,,8923413,choleraehyq,7496278,panjf2000,200,https://github.com/panjf2000/ants/issues/52,2019-09-11T21:06:46.000+08:00,2019-09-11T17:46:11.000+08:00,2019-09-11T21:06:46.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,58,
509545524,134018330,55,closed,æ˜¯å¦å¯ä»¥æ·»åŠ SubmitQueueç±»ä¼¼çš„æ¥å£,"ç°åœ¨submitçš„ä»»åŠ¡æ‰§è¡Œé¡ºåºå¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œä½†æ˜¯æœ‰åº”ç”¨çš„æƒ…å†µæ˜¯å¤„ç†æ•°æ®æ—¶æœ‰é¡ºåºå…³ç³»ï¼Œç”¨æˆ·å¯ä»¥ç”¨é˜Ÿåˆ—æ¥å¤„ç†æ­¤ç±»ä»»åŠ¡ï¼Œä½†æ˜¯æ¯ä¸ªtask handlerä¸­éƒ½å¢åŠ äº†é˜Ÿåˆ—çš„ä»£ç ï¼Œæ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹ç´¯èµ˜ã€‚

å¦‚æœantsæœ‰SumbitQueue(queueName interface{}, task func())error è¿™æ ·çš„æ¥å£ï¼Œåˆ™ä½¿ç”¨èµ·æ¥æ„Ÿè§‰æ–¹ä¾¿å¾ˆå¤š",,,,47293522,yangjuncode,7496278,panjf2000,560,https://github.com/panjf2000/ants/issues/55,2019-10-20T22:05:46.000+08:00,2019-10-20T12:45:37.000+08:00,2019-10-20T22:05:47.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,61,
513276141,134018330,56,closed,éé˜»å¡åœ¨PoolOverloadæ—¶è¿›å…¥ç­‰å¾…é˜Ÿåˆ—,"**Is your feature request related to a problem? Please describe.**
submitçš„å‡½æ•°å¦‚æœæ˜¯é€’å½’å‡½æ•°ï¼Œåˆ™å¦‚æœæ˜¯é˜»å¡æ¨¡å¼ï¼Œåœ¨é€’å½’æ·±åº¦è¾ƒå¤§çš„æ—¶å€™ï¼Œä¼šå› ä¸ºworkerç”¨å…‰ï¼Œç¨‹åºç›´æ¥è¢«é˜»å¡äº†ï¼Œå¦‚æœè°ƒæ•´ä¸ºéé˜»å¡æ¨¡å¼ï¼Œåˆ™ä¼šåœ¨workerç”¨å…‰ä¹‹åï¼Œåé¢çš„ä»»åŠ¡ç›´æ¥è¿”å›ErrPoolOverloadè€Œè¢«èˆå¼ƒã€‚æˆ‘æ˜¯åœ¨éå†ç›®å½•çš„æ—¶å€™é‡åˆ°çš„è¿™ä¸ªé—®é¢˜ã€‚

**Describe the solution you'd like**
å¢åŠ ä¸€ä¸ªé…ç½®é¡¹ï¼Œéé˜»å¡æ¨¡å¼ä¸‹ï¼Œå¯ä»¥é€‰æ‹©å¢åŠ ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯èˆå¼ƒã€‚

**Describe alternatives you've considered**
å¢åŠ ä¸€ä¸ªchannelï¼Œç”¨äºtaskå®Œæˆåé€šçŸ¥ç­‰å¾…é˜Ÿåˆ—


",,,,16379361,HaoKunT,7496278,panjf2000,176,https://github.com/panjf2000/ants/issues/56,2019-10-28T23:29:24.000+08:00,2019-10-28T20:33:09.000+08:00,2019-10-28T23:29:24.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,62,
515876300,134018330,57,closed,è¯·é—® bytedance çš„ä»€ä¹ˆé¡¹ç›®ä½¿ç”¨äº† antsï¼Ÿ,çœ‹ readme é‡Œå†™äº† bytedance,,,,8923413,choleraehyq,0,,154,https://github.com/panjf2000/ants/issues/57,2019-11-01T13:13:48.000+08:00,2019-11-01T10:39:33.000+08:00,2019-11-01T13:13:48.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,63,
519634014,134018330,58,closed,ä¸šåŠ¡é€»è¾‘ panic é—®é¢˜,"`package main

import (
	""fmt""
	""net""
	""sync""
	""time""

	""github.com/panjf2000/ants/v2""
)



func doPortScan(i interface{}) {
	
	port := i.(int32)

	_, err := net.DialTimeout(""tcp"", fmt.Sprintf(""192.168.20.1:%d"", port), time.Second*1)
	if err != nil {
		return
	}

	fmt.Printf(""Port  %d is open\n"", port)


}




func main() {
	defer ants.Release()

	runTimes := 65535

	// Use the common pool.
	var wg sync.WaitGroup


	// Use the pool with a method,
	// set 10 to the capacity of goroutine pool and 1 second for expired duration.
	p, _ := ants.NewPoolWithFunc(300, func(i interface{}) {
		doPortScan(i)
		wg.Done()
	})
	defer p.Release()
	// Submit tasks one by one.
	for i := 0; i < runTimes; i++ {
		wg.Add(1)

		_ = p.Invoke(int32(i))
	}
	wg.Wait()
	fmt.Printf(""running goroutines: %d\n"", p.Running())

}
`
å´©æºƒæ—¶çš„ç°è±¡å¦‚ä¸‹ï¼š
`
goroutine 543 [runnable]:
github.com/panjf2000/ants/v2.(*goWorkerWithFunc).run.func1(0xc000255e00)
	/Users/mac/go/src/github.com/panjf2000/ants/worker_func.go:65 +0x85
created by github.com/panjf2000/ants/v2.(*goWorkerWithFunc).run
	/Users/mac/go/src/github.com/panjf2000/ants/worker_func.go:49 +0x4c

goroutine 544 [runnable]:
syscall.syscall(0x108b820, 0x25, 0xc00048800c, 0x10, 0xffffffffffffffff, 0xffffffffffffffff, 0x24)
	/usr/local/go/src/runtime/sys_darwin.go:63 +0x2e
syscall.connect(0x25, 0xc00048800c, 0x10, 0x0, 0x0)
	/usr/local/go/src/syscall/zsyscall_darwin_amd64.go:91 +0x5c
syscall.Connect(0x25, 0x1158f40, 0xc000488000, 0x111ac80, 0x1)
	/usr/local/go/src/syscall/syscall_unix.go:251 +0x62
net.(*netFD).connect(0xc0000e2180, 0x115a280, 0xc0003ff200, 0x0, 0x0, 0x1158f40, 0xc000488000, 0x0, 0x0, 0x0, ...)
	/usr/local/go/src/net/fd_unix.go:70 +0x7b
net.(*netFD).dial(0xc0000e2180, 0x115a280, 0xc0003ff200, 0x115a7a0, 0x0, 0x115a7a0, 0xc000255e90, 0x0, 0x1, 0xc000061890)
	/usr/local/go/src/net/sock_posix.go:149 +0xff
net.socket(0x115a280, 0xc0003ff200, 0x1133ff4, 0x3, 0x2, 0x1, 0x0, 0x0, 0x115a7a0, 0x0, ...)
	/usr/local/go/src/net/sock_posix.go:70 +0x1c0
net.internetSocket(0x115a280, 0xc0003ff200, 0x1133ff4, 0x3, 0x115a7a0, 0x0, 0x115a7a0, 0xc000255e90, 0x1, 0x0, ...)
	/usr/local/go/src/net/ipsock_posix.go:141 +0x141
net.(*sysDialer).doDialTCP(0xc0000e2100, 0x115a280, 0xc0003ff200, 0x0, 0xc000255e90, 0x110a680, 0x123ab20, 0x0)
	/usr/local/go/src/net/tcpsock_posix.go:65 +0xc2
net.(*sysDialer).dialTCP(0xc0000e2100, 0x115a280, 0xc0003ff200, 0x0, 0xc000255e90, 0xc034fda0d3, 0x121ffc0, 0xc000061ad0)
	/usr/local/go/src/net/tcpsock_posix.go:61 +0xd7
net.(*sysDialer).dialSingle(0xc0000e2100, 0x115a280, 0xc0003ff200, 0x11593c0, 0xc000255e90, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/dial.go:578 +0x36e
net.(*sysDialer).dialSerial(0xc0000e2100, 0x115a280, 0xc0003ff200, 0xc0000b38a0, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/dial.go:546 +0x221
net.(*Dialer).DialContext(0xc000061e40, 0x115a240, 0xc0000ce008, 0x1133ff4, 0x3, 0xc0000ce6f0, 0x10, 0x0, 0x0, 0x0, ...)
	/usr/local/go/src/net/dial.go:424 +0x666
net.(*Dialer).Dial(...)
	/usr/local/go/src/net/dial.go:347
net.DialTimeout(0x1133ff4, 0x3, 0xc0000ce6f0, 0x10, 0x3b9aca00, 0xc0000ce6f0, 0x10, 0x0, 0x0)
	/usr/local/go/src/net/dial.go:333 +0xb5
main.doPortScan(0x10fe540, 0xc0000ce6d4)
	/Users/mac/go/src/github.com/panjf2000/ants/examples/main.go:42 +0xd8
main.main.func1(0x10fe540, 0xc0000ce6d4)
	/Users/mac/go/src/github.com/panjf2000/ants/examples/main.go:90 +0x3e
github.com/panjf2000/ants/v2.(*goWorkerWithFunc).run.func1(0xc000255e30)
	/Users/mac/go/src/github.com/panjf2000/ants/worker_func.go:69 +0xbd
created by github.com/panjf2000/ants/v2.(*goWorkerWithFunc).run
	/Users/mac/go/src/github.com/panjf2000/ants/worker_func.go:49 +0x4c
exit status 2`",,,,36106762,pwnfun,7496278,panjf2000,7144,https://github.com/panjf2000/ants/issues/58,2019-11-13T10:19:02.000+08:00,2019-11-08T11:14:31.000+08:00,2019-11-13T10:19:03.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,64,
524118492,134018330,59,open,ä¼˜å…ˆçº§é˜Ÿåˆ—æ”¯æŒ,"**Is your feature request related to a problem? Please describe.**
A clear and concise description of what the problem is. Ex. I'm always frustrated when [...]
ä¼˜å…ˆçº§è°ƒåº¦ã€‚æ¯”å¦‚é™¤äº† Submit ä¹‹å¤–ï¼Œæä¾› SubmitUrge æ¥å£ä¹‹ç±»çš„ï¼Œæä¾›å¤šä¼˜å…ˆçº§è°ƒåº¦åŠŸèƒ½

**Describe the solution you'd like**
A clear and concise description of what you want to happen.
æœ€ç®€å•çš„åŠæ³•ï¼Œå¯ä»¥åšä¸‰ä¸ªé˜Ÿåˆ—ï¼Œæœ€é«˜çš„æ˜¯ urgentï¼Œæœ€ä½çš„æ˜¯ delayedï¼Œä¸­é—´çš„å°±æ˜¯ç°åœ¨çš„é˜Ÿåˆ—ã€‚è°ƒåº¦ç­–ç•¥å¯ä»¥å¼€æˆ interface æ–¹ä¾¿å®šåˆ¶ï¼Œç®€å•çš„ç­–ç•¥å¯ä»¥ç±»ä¼¼äºå†…æ ¸ io è°ƒåº¦çš„ deadline è°ƒåº¦å™¨ã€‚

**Describe alternatives you've considered**
A clear and concise description of any alternative solutions or features you've considered.
åªèƒ½åšå¤šä¸ª poolï¼Œä½†æ˜¯ä¹Ÿä¸å¥½å®ç°å¤šä¸ª pool ä¹‹é—´çš„ä¼˜å…ˆçº§è°ƒåº¦ã€‚

**Additional context**
Add any other context or screenshots about the feature request here.
ç¡®å®æœ‰é«˜ä¼˜å…ˆçº§è°ƒåº¦çš„éœ€æ±‚
",,,,8923413,choleraehyq,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/59,,2019-11-18T11:49:17.000+08:00,2021-07-03T16:30:50.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,65,
524800426,134018330,60,closed,goroutine ä¸æ˜¯åç¨‹ï¼Œé¡¹ç›®æè¿°ä¸å‡†ç¡®ã€‚,"**Describe the bug**
A clear and concise description of what the bug is.

ç›®å‰çš„é¡¹ç›®æè¿°é‡Œæåˆ°ï¼Œâ€œ ants æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ä¸”ä½æŸè€—çš„ goroutine åç¨‹æ± ã€‚â€ï¼Œè¿™ä¸ªè¯´æ³•æ˜¯ä¸æ­£ç¡®çš„ï¼Œgoroutine ä¸æ˜¯åç¨‹ã€‚

é¦–å…ˆï¼Œgoroutine ä¸æ˜¯æˆ‘ä»¬é€šå¸¸è¯´çš„åä½œå¼è°ƒåº¦ï¼Œç»å¤§éƒ¨åˆ†çš„ go ç¨‹åºéƒ½æ˜¯æ²¡æœ‰ runtime.Gosched çš„ã€‚å¦‚æœè®¤ä¸º go scheduler å†…éƒ¨çš„æŠ¢å è°ƒåº¦ç›®å‰ä¸å®Œå–„ï¼Œé‚£ linux å†…æ ¸åœ¨ 2.å‡  æŸä¸ªç‰ˆæœ¬ä¹‹å‰ä¹Ÿæ²¡æœ‰å®Œå–„çš„æŠ¢å è°ƒåº¦ï¼Œéš¾é“ linux çº¿ç¨‹ä¹Ÿæ˜¯åç¨‹å—ã€‚

å¦å¤–ï¼Œé¢„æœŸ Go 1.14 å°±æœ‰å®Œå…¨çš„æŠ¢å è°ƒåº¦äº†ï¼Œæ›´è·Ÿåç¨‹ä¸æ­è¾¹äº†ã€‚

**To Reproduce**
Steps to reproduce the behavior:
1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error

**Expected behavior**
A clear and concise description of what you expected to happen.

**Error messages/Trace logs**
If applicable, add some logs to help explain your problem.

**System info (please complete the following information):**
 - OS: [e.g. linux, macOS]
 - Go Version: [e.g. 1.12]
 - ants version: [e.g. v2.2.2]

**Additional context**
Add any other context about the problem here.
",,,,8923413,choleraehyq,7496278,panjf2000,2763,https://github.com/panjf2000/ants/issues/60,2019-11-21T12:24:33.000+08:00,2019-11-19T14:21:33.000+08:00,2020-04-07T09:27:12.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,66,
524906588,134018330,61,closed,ä¸ºä»€ä¹ˆæˆ‘æ— æ³•è·å–åˆ° v2 ç‰ˆæœ¬,"go get -u github.com/panjf2000/ants/v2

```
package github.com/panjf2000/ants/v2: cannot find package ""github.com/panjf2000/ants/v2"" in any of:
        /usr/local/go/src/github.com/panjf2000/ants/v2 (from $GOROOT)
        /Users/xxx/Desktop/go/gin/src/github.com/panjf2000/ants/v2 (from $GOPATH)

```",,,,10721527,chinawangyu,7496278,panjf2000,4,https://github.com/panjf2000/ants/issues/61,2019-11-19T18:16:01.000+08:00,2019-11-19T18:11:36.000+08:00,2019-11-19T18:16:02.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,67,
524907361,134018330,62,closed,ä¸ºä»€ä¹ˆæˆ‘æ— æ³•è·å–åˆ° v2 ç‰ˆæœ¬,"go get -u github.com/panjf2000/ants/v2

```
package github.com/panjf2000/ants/v2: cannot find package ""github.com/panjf2000/ants/v2"" in any of:
        /usr/local/go/src/github.com/panjf2000/ants/v2 (from $GOROOT)
        /Users/xxx/Desktop/go/gin/src/github.com/panjf2000/ants/v2 (from $GOPATH)

```",,,,10721527,chinawangyu,7496278,panjf2000,2535,https://github.com/panjf2000/ants/issues/62,2019-11-21T12:28:17.000+08:00,2019-11-19T18:12:56.000+08:00,2019-11-21T12:28:17.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,68,
526983024,134018330,63,closed,go1.8æ— æ³•è¿è¡Œbenchmarkæµ‹è¯•,"ä½ å¥½ï¼Œæˆ‘çš„æœ¬åœ°ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒéƒ½æ˜¯go1.8ï¼Œç›®å‰é€šè¿‡go getä¼šæŠ¥cannot find package ""github.com/panjf2000/ants/v2/internalâ€é”™è¯¯ï¼Œè€Œgo1.8è¿˜ä¸æ”¯æŒgo modulesã€‚
æƒ³é—®ä¸€ä¸‹è¿™ä¸ªä»£ç éœ€è¦åšå“ªäº›å˜åŠ¨æ‰å¯ä»¥è¿è¡Œåœ¨go1.8ä¸Šå‘¢ï¼Ÿä½ ä»¬å¯ä»¥æä¾›æ”¯æŒä¹ˆï¼Ÿ
è°¢è°¢~ #62 ",,,,15848536,Kuching,0,,1306,https://github.com/panjf2000/ants/issues/63,2019-11-23T10:25:15.000+08:00,2019-11-22T12:39:07.000+08:00,2019-11-23T10:25:15.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,69,
529767734,134018330,64,closed,"Hi, boys","**Is your feature request related to a problem? Please describe.**
A clear and concise description of what the problem is. Ex. I'm always frustrated when [...]

**Describe the solution you'd like**
A clear and concise description of what you want to happen.

**Describe alternatives you've considered**
A clear and concise description of any alternative solutions or features you've considered.

**Additional context**
Add any other context or screenshots about the feature request here.
",,,,16028668,jjshi,7496278,panjf2000,288,https://github.com/panjf2000/ants/issues/64,2019-11-28T21:28:37.000+08:00,2019-11-28T16:40:25.000+08:00,2019-11-28T21:28:37.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,70,
529770094,134018330,65,closed,internal.NewSpinLock about runtime.Gosched(),"I see that internal.NewSpinLock() is internal Lock. Why don't use sync.Mutex?
runtime.Gosched() is put current goroutine to global run queue tail.
Hope your response.",,,,16028668,jjshi,7496278,panjf2000,7234,https://github.com/panjf2000/ants/issues/65,2019-12-03T17:19:56.000+08:00,2019-11-28T16:45:36.000+08:00,2020-10-18T22:46:07.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,71,
530708513,134018330,67,closed,å¢åŠ è°ƒè¯•åŠŸèƒ½,"**Is your feature request related to a problem? Please describe.**
A clear and concise description of what the problem is. Ex. I'm always frustrated when [...]
æœ‰æ—¶ä»»åŠ¡å‘ç”Ÿé—®é¢˜ï¼Œä¸€ç›´ä¸ç»“æŸæˆ–ä»»åŠ¡å¤ªå¤šï¼Œ æƒ³çŸ¥é“æ˜¯å“ªäº›ä»»åŠ¡

**Describe the solution you'd like**
A clear and concise description of what you want to happen.

å¢åŠ è°ƒè¯•åŠŸèƒ½ï¼Œ ä¸º ä»»åŠ¡å¢åŠ  ä»»åŠ¡åï¼ŒåŠ å…¥æ—¶é—´ç­‰ä¿¡æ¯ï¼Œ ç„¶å Pool æ·»åŠ  Stats() []TaskInfo
ä¸º Submit æ·»åŠ ä¸€ä¸ªäº›å¯é€‰é¡¹ï¼Œç”¨æˆ·æ·»åŠ ä»»åŠ¡åï¼ŒåŠ å…¥æ—¶é—´ï¼Œ
Submit(cb func(), opts ...TaskOption)
",,,,1052632,runner-mei,7496278,panjf2000,213,https://github.com/panjf2000/ants/issues/67,2019-12-01T21:59:08.000+08:00,2019-12-01T18:25:29.000+08:00,2019-12-01T21:59:08.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,73,
537859668,134018330,68,closed,workerçš„taské—®é¢˜,"æˆ‘åˆç•¥çš„çœ‹äº†ä¸€ä¸‹å¯åŠ¨çš„è¿‡ç¨‹ï¼Œæœ‰å‡ ä¸ªç–‘é—®æƒ³è¯·æ•™ä¸€ä¸‹
åœ¨newpoolä¹‹åï¼Œæƒ³è¦æ‰§è¡Œä»»åŠ¡éœ€è¦è°ƒç”¨poolçš„submitã€‚åœ¨submité‡Œé¢ï¼Œæœ‰ä¸€æ®µä»£ç æ˜¯w.task <- task.
wæ˜¯workerçš„æ„æ€ï¼Œä½†workerçš„task chané•¿åº¦åªæœ‰1ï¼Œæ‰€ä»¥æœ‰å¹¶å‘ä»»åŠ¡æ¥çš„æ—¶å€™ï¼Œéƒ½åœ¨æŠ¢å è¿™ä¸ªw.taskã€‚è¦æ€ä¹ˆä¿è¯ä»»åŠ¡çš„å…ˆåé¡ºåºçš„ï¼Ÿ",,,,11144120,nagasawaja,7496278,panjf2000,119,https://github.com/panjf2000/ants/issues/68,2019-12-14T13:32:54.000+08:00,2019-12-14T11:33:30.000+08:00,2019-12-14T14:05:43.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,74,
538994753,134018330,69,closed,æä¸¤ä¸ªå°éœ€æ±‚,"1. åœ¨æ‰¹é‡æäº¤ä»»åŠ¡åï¼Œè·å–æ¯ä¸ªä»»åŠ¡å¯¹åº”çš„è¿”å›å€¼.
2. åœ¨æ‰¹é‡æäº¤ä»»åŠ¡æ—¶ï¼Œå¯ä»¥æºå¸¦ä¸€ä¸ªè¶…æ—¶å‚æ•°ï¼Œè¡¨ç¤ºè¿™æ‰¹ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œå¦‚æœè¶…æ—¶ï¼Œåˆ™å·²æ‰§è¡Œçš„ä»»åŠ¡æ­£å¸¸è¿”å›æ‰§è¡Œç»“æœï¼Œæœªæ‰§è¡Œçš„ä»»åŠ¡éƒ½æå‰ç»“æŸï¼ˆæˆ–ä¹Ÿè¿”å›æ‰§è¡Œç»“æœï¼Œä½†æ˜¯æ ‡æ˜æ˜¯timeoutï¼‰ã€‚",,,,9315278,bglmmz,7496278,panjf2000,1011,https://github.com/panjf2000/ants/issues/69,2019-12-18T11:54:53.000+08:00,2019-12-17T19:03:45.000+08:00,2021-09-28T16:33:48.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,75,
542347075,134018330,70,closed,å…³äºretrieveWorkerä¸­ä¸€å°æ®µä»£ç çš„ç–‘é—®,"```go
if n >= 0 {
		w = idleWorkers[n]
		idleWorkers[n] = nil
		p.workers = idleWorkers[:n]
		p.lock.Unlock()
	} else if p.Running() < p.Cap() {
		p.lock.Unlock()
		spawnWorker()
	} else {
		if p.nonblocking {
			p.lock.Unlock()
			return nil
		}
```
 if p.Running() < p.Cap() åˆ¤æ–­ä»¥åç¬¦åˆæ¡ä»¶è§£é”ï¼Œå†é‡æ–°åˆ›å»ºworkerï¼Œworkerä¼šåœ¨runçš„æ—¶å€™æ‰è¿›è¡Œrunningæ•°çš„åŠ 1ä¼šä¸ä¼šæœ‰workeråœ¨runçš„æ—¶å€™è®©å‡ºcpuï¼Œæ­¤æ—¶å¦ä¸€ä¸ªåç¨‹æ‰§è¡Œåˆ°p.Running() < p.Cap()åˆ¤æ–­ä¹Ÿç¬¦åˆï¼Œä»è€Œå¯¼è‡´æœ€ç»ˆçš„runningå…¶å®æ˜¯å¤§äºcapçš„æƒ…å†µå‘¢",,,,35391181,HobbyBear,7496278,panjf2000,909,https://github.com/panjf2000/ants/issues/70,2019-12-26T13:14:15.000+08:00,2019-12-25T22:05:01.000+08:00,2019-12-26T13:14:15.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,76,
543230040,134018330,71,closed,å¦‚ä½•é™åˆ¶httpserverçš„æœ€å¤§åç¨‹æ•°,ä¸httpserveré›†æˆå¥½åƒå¹¶æ²¡èƒ½è§£å†³å†…ç½®httpåŒ…æ¥ä¸€ä¸ªè¯·æ±‚å¼€ä¸€ä¸ªgoroutineçš„é—®é¢˜ï¼Œè¯·é—®è¯¥å¦‚ä½•é™åˆ¶å†…ç½®httpåŒ…çš„æœ€å¤§åç¨‹æ•°å‘¢ï¼Ÿ,,,,44720525,xuyang404,7496278,panjf2000,4796,https://github.com/panjf2000/ants/issues/71,2020-01-01T08:19:53.000+08:00,2019-12-29T00:23:21.000+08:00,2020-01-01T08:19:53.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,77,
543871027,134018330,72,closed,å®‰è£…v1ç‰ˆæœ¬é—®é¢˜ï¼Ÿ,"æˆ‘ç”¨go get -u github.com/panjf2000/antså®‰è£…åï¼Œä¸ºå•¥åœ¨pool.goé‡Œè¿˜æœ‰v2çš„ä¸œè¥¿ï¼Ÿ
""github.com/panjf2000/ants/v2/internal""
",,,,9315278,bglmmz,7496278,panjf2000,2122,https://github.com/panjf2000/ants/issues/72,2020-01-01T08:19:23.000+08:00,2019-12-30T20:56:57.000+08:00,2020-01-01T08:19:23.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,78,
548918163,134018330,73,closed,how to wait for completion,"I need graceful shutdown of my app with ants.PoolWithFunc so i need firstly forbid new tasks, and second wait for completion of already running. How can i do that with ants ?",,,,481307,vtolstov,7496278,panjf2000,184,https://github.com/panjf2000/ants/issues/73,2020-01-14T00:12:11.000+08:00,2020-01-13T21:08:06.000+08:00,2020-01-14T00:12:12.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,79,
550305777,134018330,74,closed,periodicallyPurgeå¯ä»¥è€ƒè™‘recoveræ•è·ä¸€ä¸‹panic,"**What is your question about ants?**
Please describe your question meticulously.
è™½ç„¶çœ‹äº†ä¸€ä¸‹è¿™ä¸ªå‡½æ•°æ²¡å¯èƒ½painc,ä½†æ˜¯å¼€å¯goroutineä¸recoverè®©äººå¿ƒæ…Œã€‚
",,,,31125408,Andrewpqc,7496278,panjf2000,630,https://github.com/panjf2000/ants/issues/74,2020-01-16T11:19:03.000+08:00,2020-01-16T00:48:32.000+08:00,2020-01-17T00:20:18.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,80,
550555088,134018330,75,closed,æ±‚æ•™å…³äº Release å®ç°çš„ä¸€äº›ç–‘é—®,"release æ–¹æ³•çš„å®ç°ä¸ºä»€ä¹ˆè¦è¿™æ ·é‡Šæ”¾å†…å­˜? 

```golang
func (p *PoolWithFunc) Release() {
	p.once.Do(func() {
		atomic.StoreInt32(&p.release, 1)
		p.lock.Lock()
		idleWorkers := p.workers
		for i, w := range idleWorkers {
			w.args <- nil
			idleWorkers[i] = nil
		}
		p.workers = nil
		p.lock.Unlock()
	})
}
```
ç›´æ¥ p.workers = nil ä¸èƒ½åšåˆ°é‡Šæ”¾å†…å­˜çš„åŠ¨ä½œå—ï¼Ÿ
",,,,38727061,chengyayu,7496278,panjf2000,8,https://github.com/panjf2000/ants/issues/75,2020-01-16T11:49:30.000+08:00,2020-01-16T11:41:16.000+08:00,2020-01-16T11:49:30.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,81,
551948830,134018330,76,closed,Use pool as a queue,"**Is your feature request related to a problem? Please describe.**
I have a limited pool (sized pool), but when I reach the capacity of the pool, `Submit()` returns an error (`ErrPoolOverload`) which means the pool is full and no workers available.
Even if i set `Nonblocking` to true in [`Option`].(https://gowalker.org/github.com/panjf2000/ants#Options)
```Go
func main() {
	p, _ := ants.NewPool(2, ants.WithNonblocking(true))

	for i := 0; i < 5; i++ {
		err := p.Submit(func() {
			fmt.Println(""Testing wait for 1 second..."")
			time.Sleep(1 * time.Second)
		})
		if err != nil {
			fmt.Println(""Error: "" + err.Error())
		}
	}

	time.Sleep(500 * time.Second) // Only for test and block main(), something like waitgroup!
}
```
This code returns:
```
Error: too many goroutines blocked on submit or Nonblocking is set
Error: too many goroutines blocked on submit or Nonblocking is set
Error: too many goroutines blocked on submit or Nonblocking is set
Something is here, waiting..
Something is here, waiting..
```

**Describe the solution you'd like**
I think it's better to have something like a (second) queue in ants. tasks submit without any error and complete one-by-one.
In other words, `Submit()` should be non-blocking but it shouldn't return `ErrPoolOverload` error even if capacity is full, and should continue receiving tasks.
I'm not sure if this feature exists in ants or not.

**Describe alternatives you've considered**
A clear and concise description of any alternative solutions or features you've considered.

**Additional context**
`go` keyword can do that:
```Go
p, _ := ants.NewPool(2, ants.WithNonblocking(false))

for i := 0; i < 5; i++ {
    go p.Submit(func() {
        fmt.Println(""Testing wait for 1 second..."")
        time.Sleep(1 * time.Second)
    })
}
```
But i think there must be a better way.",,,,50948745,ffb255,7496278,panjf2000,139259,https://github.com/panjf2000/ants/issues/76,2020-04-25T17:39:16.000+08:00,2020-01-20T00:39:17.000+08:00,2020-04-25T17:39:16.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,82,
553711776,134018330,77,closed,å¦‚ä½•åœ¨antsä¸­æ¥æ”¶os.Signal,"æˆ‘æƒ³è¦åœ¨mainä¸­ç›‘å¬os.Signalä¿¡å·ï¼Œå¦‚æœæœ‰ä¼ å…¥ctrl+cçš„ä¿¡å·ï¼Œå°†ä¼šé€€å‡ºæ‰€æœ‰çº¿ç¨‹ã€‚ä½†æ˜¯åœ¨æ“ä½œä¸­å‘ç°é”®å…¥ctrl+cåï¼Œæ‰“å°ä¸å‡ºæ¥â€œé€€å‡ºâ€ä¸¤ä¸ªå­—ä»¥åŠä»»åŠ¡ç»“æœã€‚ã€‚éº»çƒ¦å¸®å¿™çœ‹çœ‹æ˜¯å“ªé‡Œä¸å¯¹ï¼Œè°¢è°¢

```
package main

import (
	""fmt""
	""github.com/panjf2000/ants/v2""
	""os""
	""os/signal""
	""sync""
	""sync/atomic""
	""syscall""
	""time""
)


var sum int32
var results []int32

func myFunc(i interface{}) {
	n := i.(int32)
	results = append(results, n)
	time.Sleep(10 * time.Millisecond)
	atomic.AddInt32(&sum, n)
	fmt.Printf(""run with %d\n"", n)
}


func main() {
	var wg sync.WaitGroup

	p, _ := ants.NewPoolWithFunc(2, func(i interface{}) {
		myFunc(i)
		wg.Done()

	})

	// Use the common pool.
	defer p.Release()
	// Submit tasks one by one.
	for i := 0; i < 1000; i++ {
		wg.Add(1)
		_ = p.Invoke(int32(i))
	}
	
	//åˆå»ºchan
	c := make(chan os.Signal)
	//ç›‘å¬æŒ‡å®šä¿¡å· ctrl+c kill
	signal.Notify(c, os.Interrupt, os.Kill)
	go func() {
		for s := range c {
			switch s {
			case syscall.SIGHUP, syscall.SIGINT, syscall.SIGTERM, syscall.SIGQUIT:
				fmt.Println(""é€€å‡º"", s)
				ExitFunc()
			default:
				fmt.Println(""other"", s)
			}
		}
	}()
	

	wg.Wait()

	fmt.Printf(""running goroutines: %d\n"", p.Running())
	fmt.Printf(""running sum: %d\n"", sum)
	fmt.Printf(""finish all tasks.\n"")

}

func ExitFunc() {
	fmt.Println(""reslut:"")
	fmt.Println(results)
	fmt.Println(""exit..."")
}
```
",,,,45157320,iiiusky,7496278,panjf2000,1225,https://github.com/panjf2000/ants/issues/77,2020-01-23T22:43:32.000+08:00,2020-01-23T02:18:13.000+08:00,2020-01-23T22:43:33.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,83,
557507246,134018330,78,closed,about revertWorker,"NewPoolæ—¶ï¼ŒgoWorkerä¸­çš„channelå¤§å°ä¸éœ€è¦åˆå§‹åŒ–å—ï¼Ÿ
workerCacheä¸­task channelçš„å¤§å°è®¾ç½®æˆ1/0æœ‰ä»€ä¹ˆè€ƒè™‘ä¹ˆï¼Ÿ",,,,12018707,blacktoot,7496278,panjf2000,996,https://github.com/panjf2000/ants/issues/78,2020-01-31T14:27:05.000+08:00,2020-01-30T21:50:37.000+08:00,2020-01-31T14:29:28.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,84,
576944665,134018330,80,closed,"å½“å¤§é‡åç¨‹åµŒå¥—æ—¶,ä¼šå‡ºç°å‡æ­»çŠ¶æ€","ç¯å¢ƒ:
linux Centos 6.5
golang1.13
ç°è±¡:
1.åˆ›å»º2ä¸ªpool:p1,p2
2.ä»chanä¸æ–­çš„æ‹¿å‡ºæ¶ˆæ¯ååœ¨p1åˆ›å»ºgoroutine
3.p1å»ºç«‹goroutineå,åœ¨p2ç”Ÿæˆ100ä¸ªgoroutine
4.antsä¼šæ°¸è¿œé˜»å¡,å¹¶ä¸”ä¼šè¶…å‡ºåç¨‹æ± æœ¬èº«çš„é™åˆ¶
![image](https://user-images.githubusercontent.com/16916249/76089201-34294400-5ff4-11ea-8722-bf0763ee0168.png)
",,,,16916249,arch3754,7496278,panjf2000,4227,https://github.com/panjf2000/ants/issues/80,2020-03-09T20:18:09.000+08:00,2020-03-06T21:50:56.000+08:00,2020-03-09T20:18:10.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,86,
583444295,134018330,81,open,how to pass context and other args in pool_func?,"hello, @panjf2000  
`func NewPoolWithFunc(size int, pf func(interface{}), options ...Option)`
in NewPoolWithFunc, pf only have an ingerface{}, but i want to pass at least two args, how to solve tihes?

my run function like :
```
func (s *fileSystemServer) handleOp(
	c *Connection,
	ctx context.Context,
	op interface{}) {
}
```
context is not suggested to put into a struct, how to pass ctx + args as one task to queue?",,,,24663329,kungf,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/81,,2020-03-18T11:49:05.000+08:00,2021-11-26T20:34:47.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,87,
590876739,134018330,82,closed,èƒ½å¦ä¸­æ–­æœªæ‰§è¡Œå®Œæˆçš„ä»»åŠ¡ï¼Ÿ,"æˆ‘åˆ›å»ºäº†ä¸€ä¸ªPoolWithFunc
ç„¶åé€šè¿‡ä¸€ä¸ªforå¾ªç¯ï¼Œç”¨pool.Invoke()æ¥æ‰§è¡Œä»»åŠ¡
æˆ‘çš„éœ€æ±‚æ˜¯ï¼šæˆ‘æ‰€æœ‰çš„ä»»åŠ¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„deadlineï¼Œè¶…è¿‡å°±éœ€è¦è®©æ‰€æœ‰ä»»åŠ¡é€€å‡ºï¼ˆåŒ…æ‹¬æ­£åœ¨æ‰§è¡Œä½†æ˜¯æœªæ‰§è¡Œå®Œæˆï¼Œä»¥åŠè¿˜æœªå¼€å§‹æ‰§è¡Œçš„ï¼‰

è¯·é—®ï¼Œç”¨è¿™ä¸ªantsèƒ½å®ç°è¿™ä¸ªå—ï¼Ÿ

è°¢è°¢ï¼",,,,9315278,bglmmz,7496278,panjf2000,9036,https://github.com/panjf2000/ants/issues/82,2020-04-06T22:23:54.000+08:00,2020-03-31T15:47:29.000+08:00,2020-04-06T22:25:18.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,88,
598490848,134018330,83,closed,ä¸ºä»€ä¹ˆä¸ç”¨listä½œä¸ºworkerArry è€Œç”¨åˆ‡ç‰‡,"**What is your question about ants?**
Please describe your question meticulously.
ä¸ºä»€ä¹ˆä¸ç”¨å®¹å™¨å°è£…workerçš„å®¹å™¨å‘¢",,,,21356664,zjytra,7496278,panjf2000,85,https://github.com/panjf2000/ants/issues/83,2020-04-12T23:23:14.000+08:00,2020-04-12T21:57:31.000+08:00,2020-04-12T23:23:14.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,89,
598491535,134018330,84,closed,å½“option.Nonblockingä¸ºtrue,"**What is your question about ants?**
Please describe your question meticulously.
å½“option.Nonblockingä¸ºtrueæäº¤ä»»åŠ¡çš„goroutineè¦ä¸€ç›´å¾ªç¯ç­‰åˆ°åˆ°æœ‰ç©ºé—²å·¥ä½œæ¥æ”¶æ‰ä¼šå‘åé¢æ‰§è¡Œä»£ç å“¦",,,,21356664,zjytra,7496278,panjf2000,114,https://github.com/panjf2000/ants/issues/84,2020-04-12T23:55:35.000+08:00,2020-04-12T22:00:40.000+08:00,2020-04-12T23:55:35.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,90,
598516739,134018330,85,closed,pool.Release ä¸èƒ½å¹²æ‰ç¹å¿™çš„åç¨‹å“¦,"**What is your question about ants?**
Please describe your question meticulously.
å¯ä»¥å°†taskè®¾ç½®ä¸ºæ¥å£,poolé‡Šæ”¾çš„æ—¶å€™ä¸»åŠ¨é€šçŸ¥task ç»“æŸ ä»»åŠ¡ï¼Œé‡Šæ”¾åç¨‹",,,,21356664,zjytra,7496278,panjf2000,1130,https://github.com/panjf2000/ants/issues/85,2020-04-13T18:53:23.000+08:00,2020-04-13T00:02:49.000+08:00,2020-04-13T18:53:23.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,91,
599450188,134018330,86,closed,Panic occurred when using nested pools ,"call chain :
```go
pool1:
	antsP, _ := ants.NewPoolWithFunc(len(block.GetTransactions()), func(params interface{}) {
		syncVerify1(params) //handle some verify, this func define another ants pool
		xxxx
	})
	defer antsP.Release()
pool2:
      syncVerify1(params{
            xxxx
           antsP1, _ := ants.NewPoolWithFunc(len(block.GetTransactions()), func(params interface{}) {
		syncVerify2(params)
		xxx
	})
	defer antsP1.Release()//problems happens
      }
```
debug info like this:
```
2020/04/14 17:50:05 worker with func exits from a panic: runtime error: invalid memory address or nil pointer dereference
2020/04/14 17:50:05 worker with func exits from panic: goroutine 55 [running]:
github.com/panjf2000/ants.(*goWorkerWithFunc).run.func1.1(0xc000165b30)
        /data/home/go_workspace/src/trustsql-spv-go/vendor/github.com/panjf2000/ants/worker_func.go:59 +0x140
panic(0xf859e0, 0x18950d0)
        /usr/local/go/src/runtime/panic.go:679 +0x1b2
github.com/panjf2000/ants.(*PoolWithFunc).Release(0x0)
        /data/home/go_workspace/src/trustsql-spv-go/vendor/github.com/panjf2000/ants/pool_func.go:221 +0x22
trustsql-spv-go/validator.Validator.AsyncVerifyBlock(0x0, 0x1, 0xc000196090, 0x25, 0xc00016e4f0, 0xf, 0x1, 0x1, 0x0, 0x0, ...)
        /data/home/go_workspace/src/trustsql-spv-go/validator/validatator.go:113 +0x3b3
trustsql-spv-go/storage.(*BlocksDaoImpl).AsyncStoreBlocks.func1(0xfbef60, 0xc0001dc6e0)
        /data/home/go_workspace/src/trustsql-spv-go/storage/block_dao_impl.go:163 +0x239
trustsql-spv-go/storage.(*BlocksDaoImpl).AsyncStoreBlocks.func2(0xfbef60, 0xc0001dc6e0)
        /data/home/go_workspace/src/trustsql-spv-go/storage/block_dao_impl.go:171 +0x42
github.com/panjf2000/ants.(*goWorkerWithFunc).run.func1(0xc000165b30)
        /data/home/go_workspace/src/trustsql-spv-go/vendor/github.com/panjf2000/ants/worker_func.go:71 +0xbd
created by github.com/panjf2000/ants.(*goWorkerWithFunc).run
        /data/home/go_workspace/src/trustsql-spv-go/vendor/github.com/panjf2000/ants/worker_func.go:49 +0x4c
```",,,,5850861,henkgo,7496278,panjf2000,5488,https://github.com/panjf2000/ants/issues/86,2020-04-18T13:33:38.000+08:00,2020-04-14T18:05:32.000+08:00,2020-04-18T13:33:38.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,92,
607208427,134018330,88,closed,v2.PoolWithFunc has no field or method Serve,"I encounter some build problems, hinting ""myPool.Serve undefined (type *v2.PoolWithFunc has no field or method Serve)""

```
import (
	""fmt""
	""strconv""
	""time""
	""github.com/panjf2000/ants/v2""
)


var tunnel = make(chan string, 1)
func main() {

	//push something to tunnel

	myPool, _ := ants.NewPoolWithFunc(3, Myfunc)
	defer myPool.Release()

	for {
		select {
		case a := <-tunnel:
			go myPool.Serve(a)
		}
	}
}

```
",,,,8937150,huangp0600,7496278,panjf2000,9,https://github.com/panjf2000/ants/issues/88,2020-04-27T11:50:35.000+08:00,2020-04-27T11:41:29.000+08:00,2020-04-27T17:09:25.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,94,
613752194,134018330,90,closed,æ”¯æŒ unlimited æ± å­å¤§å°,"**Is your feature request related to a problem? Please describe.**
A clear and concise description of what the problem is. Ex. I'm always frustrated when [...]
è€ƒè™‘ä¸€ä¸ªæƒ…å†µï¼Œå½“æ± å­è¿è¡Œçš„å‡½æ•°æœ¬èº«ï¼Œåˆéœ€è¦è°ƒç”¨è¿™ä¸ªæ± å­æŠ•æ”¾æ–°çš„ä»»åŠ¡æ—¶ï¼Œæ˜¯æœ‰æ­»é”çš„å¯èƒ½çš„ã€‚ä»ä½¿ç”¨å±‚é¢ä¸Šè¿™ä¸ªé—®é¢˜å¾ˆéš¾é¿å…ï¼Œä½†æ˜¯å¦‚æœæ± å­æœ¬èº«ä¸é™åˆ¶å¤§å°ï¼Œå°±èƒ½é¿å…æ­»é”ã€‚

**Describe the solution you'd like**
A clear and concise description of what you want to happen.
æ”¯æŒä¸é™åˆ¶æ± å­å¤§å°çš„åŠŸèƒ½ã€‚

**Describe alternatives you've considered**
A clear and concise description of any alternative solutions or features you've considered.
è¿™å¾ˆéš¾ï¼Œéœ€è¦ä½¿ç”¨è€…å°å¿ƒè°¨æ…åœ°ä½¿ç”¨æ± å­ï¼Œä¿è¯æ²¡æœ‰åŒä¸€ä¸ªæ± å­çš„åµŒå¥—ã€‚

**Additional context**
Add any other context or screenshots about the feature request here.
é™åˆ¶å¹¶å‘æ•°çš„åŠŸèƒ½å®Œå…¨å¯ä»¥åœ¨ä¸Šå±‚å®ç°ï¼Œæ‰€ä»¥æ²¡ä»€ä¹ˆæŸå¤±ã€‚
",,,,8923413,choleraehyq,7496278,panjf2000,2146,https://github.com/panjf2000/ants/issues/90,2020-05-08T23:32:48.000+08:00,2020-05-07T11:46:20.000+08:00,2020-05-27T22:14:17.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,96,
624852492,134018330,92,closed,å¸Œæœ›èƒ½å¤Ÿæ”¯æŒä¸€ä¸ªå°ç‰¹æ€§,"1.  PoolWithFuncå¸Œæœ›èƒ½å¤Ÿæ”¯æŒä»»åŠ¡æ± çš„åç§°ï¼›è¿™æ ·ä¸€ä¸ªserverå­˜åœ¨å¤šä¸ªä»»åŠ¡æ± ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜ï¼›
2. PoolWithFuncä¸­çš„Invokeæ–¹æ³•è¿”å›errorï¼Œå¸Œæœ›èƒ½åŒºåˆ†æ˜¯éé˜»å¡é˜Ÿåˆ—ä»»åŠ¡æ± æ»¡çš„error msgï¼Œè¿˜æ˜¯é˜»å¡é˜Ÿåˆ—éƒ½æ»¡çš„error msgé”™è¯¯åŒºåˆ†ï¼Œç›®å‰ç¬¼ç»Ÿåœ°ç§°ä¸ºï¼šErrPoolOverload, è¿™ä¸ªä¸å¤ªæ–¹ä¾¿å®šä½é—®é¢˜ã€‚",,,,20457624,1046102779,7496278,panjf2000,7128,https://github.com/panjf2000/ants/issues/92,2020-05-31T19:29:10.000+08:00,2020-05-26T20:40:35.000+08:00,2020-05-31T19:29:10.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,98,
624854806,134018330,93,closed,ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€ä¸ªæ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜,æˆ‘åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸€ä¸ªserveéƒ¨ç½²åœ¨å¼‚æ„ç¯å¢ƒä¸­ï¼Œå¯èƒ½æˆ‘è®¾ç½®çš„ä»»åŠ¡æ± å¤§å°ï¼Œå°±ä¸å¤ªé€‚ç”¨ï¼Œè¦ä¹ˆèµ„æºæ‰“æ»¡ï¼Œè¦ä¹ˆèµ„æºåˆ©ç”¨ç‡ç›¸å¯¹æ¯”è¾ƒä½ï¼Œèƒ½æ ¹æ®å½“å‰cpuå’Œå†…å­˜ä½¿ç”¨æƒ…å†µè‡ªåŠ¨åŠ¨æ€çš„è°ƒæ•´ä»»åŠ¡æ± å¤§å°ä¸ï¼Ÿ,,,,20457624,1046102779,7496278,panjf2000,7124,https://github.com/panjf2000/ants/issues/93,2020-05-31T19:29:23.000+08:00,2020-05-26T20:44:27.000+08:00,2022-01-14T23:57:03.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,99,
629156928,134018330,95,open,Ants + fasthttp,"Hello,

I am using Ants with fasthttp. Is it possible that this both packages are not compatible? 
My Program fetchs 15000 rows from a MysqlDB and request the HTML code for parse 2 strings out of it. 

My memory usage is crazy 1,9g with only 434 open socket files = 434 connections (maximum was around 2800):
`15921 jonny     20   0 3093,3m   1,9g   6,9m S   7,3  25,1  11:59.63 goCheckResults`

root@jdebian:~$ ls -l /proc/15921/fd | wc -l
`434`

**in main():**
```go
client = &fasthttp.Client{
	ReadTimeout:         time.Duration(60) * time.Second,
	MaxIdleConnDuration: time.Duration(600) * time.Second,
	Dial: func(addr string) (net.Conn, error) {
		return fasthttp.DialTimeout(addr, time.Duration(60) * time.Second)
	},
	TLSConfig: &tls.Config{InsecureSkipVerify: true},
}
var wg sync.WaitGroup
p, _ := ants.NewPoolWithFunc(25, func(i interface{}) {
	processRow(i)
	wg.Done()
})
defer p.Release()

i := 0
for results.Next() {
	var current Job

	err = results.Scan(&current....)

	wg.Add(1)
	_ = p.Invoke(&current)
	i++
}
wg.Wait()
```

The function processRow calls 
```go
row := i.(*Job)

req := fasthttp.AcquireRequest()
defer fasthttp.ReleaseRequest(req)

req.SetRequestURI(row.url)
req.Header.SetMethod(""GET"")
req.Header.Add(""User-Agent"", userAgent)

//println(req.Header.String())

resp := fasthttp.AcquireResponse()
defer fasthttp.ReleaseResponse(resp)

//if err := client.Do(req, resp); err != nil {
if err := client.DoTimeout(req, resp, time.Duration(60) * time.Second); err != nil {
	return """", err
}

bodyBytes := resp.Body()
html := string(bodyBytes)

// parse using regex
// db.Exec (....) <- mysql query to update database
```

It is crazy how much memory usage this small program has.",,,,57217666,T200proX7,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/95,,2020-06-02T20:18:17.000+08:00,2020-06-06T04:22:07.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,100,
630445612,134018330,96,closed,å¯ä»¥å¯¹æŸä¸ªgroutineè¿›è¡Œæ“ä½œå—ï¼Ÿï¼ˆæ¯”å¦‚æ‰‹åŠ¨ç»ˆæ­¢æŸä¸ªgroutineï¼‰,,,,,59554835,resct,7496278,panjf2000,556,https://github.com/panjf2000/ants/issues/96,2020-06-04T18:59:16.000+08:00,2020-06-04T09:42:38.000+08:00,2020-06-04T21:36:33.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,101,
638116396,134018330,97,closed,SECURITY ERROR: checksum mismatch,"**Description**
Mismatched checksum

**To Reproduce**
Run `go get https://github.com/panjf2000/ants`

Or
1. Import `""github.com/panjf2000/ants""`
1. Run `go mod vendor`

**Expected behavior**
Successful installation of ants as a vendor/dependency

**Error messages/Trace logs**
go get github.com/panjf2000/ants: github.com/panjf2000/ants@v1.2.0: verifying module: checksum mismatch
        downloaded: h1:Ufw4aDz9RqH1RVblx2W9L9Uv5vSX5apbX5+peR7LQ5k=
        sum.golang.org: h1:pMQ1/XpSgnWx3ro4y1xr/uA3jXUsTuAaU3Dm0JjwggE=


**System info (please complete the following information):**
 - OS: 4.15.0-23-generic #25-Ubuntu
 - Go Version: go1.14 linux/amd64
 - ants version: v1.2.0

**Additional context**
SECURITY ERROR
This download does NOT match the one reported by the checksum server.
The bits may have been replaced on the origin server, or an attacker may
have intercepted the download attempt.
",,,,7106251,navid-kalaei,7496278,panjf2000,135,https://github.com/panjf2000/ants/issues/97,2020-06-13T18:01:44.000+08:00,2020-06-13T15:45:49.000+08:00,2020-06-13T18:01:44.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,102,
638596333,134018330,98,closed,pool.Tune does not take effect if the pool is preallocated,"Hello,

May I know the reason behind the p.options.PreAlloc check? 
https://github.com/panjf2000/ants/blob/master/pool.go#L173
`if capacity := p.Cap(); capacity == -1 || size <= 0 || size == capacity || p.options.PreAlloc {
	return
}`

Why can't we tune the pool if it is preallocated?

Thanks.
",,,,6374063,giangvu,7496278,panjf2000,8767,https://github.com/panjf2000/ants/issues/98,2020-06-21T17:05:37.000+08:00,2020-06-15T14:58:03.000+08:00,2020-06-21T17:05:37.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,103,
656493889,134018330,99,closed,goroutines num ä¸€ç›´ä¸Šæ¶¨,"æœ¬åœ°å‹æµ‹çš„è¯,å‹æµ‹çš„æ—¶å€™,goroutines ä¼šä¸Šæ¶¨,ä½†æ˜¯å‹æµ‹ç»“æŸå,ä¼šæ¢å¤.

go version 1.14.2
ä½¿ç”¨çš„ ants ç‰ˆæœ¬æ˜¯ v2.10(æ¢äº†é«˜ç‰ˆæœ¬v2.40 ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜)

ä½¿ç”¨pprof `/debug/pprof/goroutine` å¥½å¤šè¿™æ ·çš„æ–‡æœ¬
```
goroutine 25824 [chan receive, 21 minutes]:
github.com/panjf2000/ants/v2.(*goWorkerWithFunc).run.func1(0xc0011fce70)
	/www/gopath1.14.2/pkg/mod/github.com/panjf2000/ants/v2@v2.1.0/worker_func.go:65 +0x74
created by github.com/panjf2000/ants/v2.(*goWorkerWithFunc).run
	/www/gopath1.14.2/pkg/mod/github.com/panjf2000/ants/v2@v2.1.0/worker_func.go:49 +0x4c
```
æ ¸å¿ƒçš„ä½¿ç”¨ä»£ç ,æ¯ä¸€ä¸ªè¯·æ±‚éƒ½ä¼šè°ƒç”¨ DataQuery è¿™ä¸ªå‡½æ•°.
```golang
func DataQuery(mobile, id, name string) DataQuerySkeleton {
	startTime := 123456789
	defer ants.Release()
	var wg sync.WaitGroup
	pUser, _ := ants.NewPoolWithFunc(50, func(para interface{}) {
		fun1(para)
		wg.Done()
	})
	defer pUser.Release()
	queryInputValue := map[string]string{
		TypeMobile: mobile,
		TypeId:    id,
		TypeName: name,
	}
	var inputUser = make(chan *GoroutineUserInputParaType, 3)

	for k, v := range queryInputValue {
		wg.Add(1)
		inPara := &GoroutineUserInputParaType{
			UinfoType: k,
			UinfoPara: v,
			StartTime: 123456789,
		}
		inputUser <- inPara
		pUser.Invoke(inputUser)
	}
	wg.Wait()
	close(inputUser)

	findInfo, minRegisterTime := func3(inputUser)
	totalUserNum := len(findInfo)
	queryInfo := DataQuerySkeleton{}

	if totalUserNum == 0 {
		return queryInfo
	}
	findOrdersStartTime := 423456789
	findUserUsedTime := findOrdersStartTime - startTime

	var inputOrder = make(chan *GoroutineOrderInputParaType, totalUserNum)

	pOrder, _ := ants.NewPoolWithFunc(50, func(para interface{}) {
		fun2(para)
		wg.Done()
	})
	defer pOrder.Release()
	for _, oneUser := range findInfo {
		wg.Add(1)
		inPara := &GoroutineOrderInputParaType{
			UinfoType: oneUser.Type,
			UinfoId:   oneUser.Uinfo.Id,
			StartTime: tools.GetUnixMillis(),
		}
		inputOrder <- inPara
		pOrder.Invoke(inputOrder)
	}
	wg.Wait()
	close(inputOrder)

    ......
	return queryInfo
}
```
",,,,2841874,weichangdong,7496278,panjf2000,42,https://github.com/panjf2000/ants/issues/99,2020-07-14T18:50:32.000+08:00,2020-07-14T18:08:22.000+08:00,2020-07-14T18:50:32.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,104,
662892614,134018330,101,closed,å‚æ•°åŠ¨æ€åŒ–,æ‰§è¡Œçš„funcæ˜¯å¦å¯ä»¥æ·»åŠ å‚æ•°åŠ¨æ€  ä¾‹å¦‚  ...interface{},,,,20257788,tsxylhs,7496278,panjf2000,4351,https://github.com/panjf2000/ants/issues/101,2020-07-24T19:42:48.000+08:00,2020-07-21T19:11:31.000+08:00,2020-07-24T19:42:56.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,106,
1101114607,134018330,207,closed,"æƒ³é—®ä¸€ä¸‹, æœ‰æ²¡æœ‰åŠæ³•å›ºå®špoolä¸­åç¨‹çš„æ•°é‡","**æ˜¯å¦æ”¯æŒå›ºå®šåç¨‹æ± çš„å®¹é‡**
Please describe your question meticulously.

æœ‰çš„æ—¶å€™ä¸æƒ³è¦ç»™å¯¹æ–¹å¢åŠ å¤ªå¤šçš„å¹¶å‘, æ¯”å¦‚æˆ‘æœ‰1000ä¸ªå·¥ä½œéœ€è¦é€šè¿‡ 5ä¸ªåç¨‹æ¥è·‘.... åˆšåˆšç”¨æ–‡æ¡£ä¸­çš„ä¾‹å­, ç›´æ¥1000ä¸ªåç¨‹å°±æ€¼å®Œäº†, æ‹…å¿ƒæŠŠserveré‚£è¾¹æ€¼çˆ†äº†",,,,2660914,shoaly,7496278,panjf2000,1,https://github.com/panjf2000/ants/issues/207,2022-01-13T11:07:59.000+08:00,2022-01-13T11:06:39.000+08:00,2022-01-13T11:07:59.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,108,
1103820475,134018330,208,closed,è¯·é—®å½“antsåœ¨æ‰§è¡ŒCPUå¯†é›†å‹ä»»åŠ¡æ—¶ï¼Œè°ƒåº¦æ—¶èƒ½å¦ä¸æ‰“æ–­ä»»åŠ¡ï¼Ÿ,å¦‚æœéƒ½æ˜¯`CPUå¯†é›†å‹ä»»åŠ¡`ï¼Œè®©ä»»åŠ¡`æ— ä¸­æ–­`åœ°ä¸€ç›´è¿è¡Œæ˜¯æœ€å¥½çš„ï¼Œè€ŒGoåœ¨1.14å¼•å…¥äº†`ä¿¡å·æŠ¢å æœºåˆ¶`ï¼Œæ¯è°ƒç”¨10mså°±ä¼šæ‰“æ–­ä¸€æ¬¡è®¡ç®—ï¼Œç„¶åè¿›è¡Œä¸Šä¸‹æ–‡é‡åŠ è½½ï¼Œå†ç»§ç»­æ‰§è¡Œã€‚åœ¨`ants`ä¸­ï¼Œè°ƒåº¦`CPUå¯†é›†å‹`ä»»åŠ¡æ—¶ï¼Œèƒ½å¦å®Œå…¨ä¸æ‰“æ–­ä»»åŠ¡ï¼Ÿ,,,,38336731,dragon-zhang,7496278,panjf2000,10868,https://github.com/panjf2000/ants/issues/208,2022-01-22T12:58:36.000+08:00,2022-01-14T23:50:07.000+08:00,2022-01-22T22:39:51.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,109,
1108986026,134018330,209,closed,è¯·é—®èƒ½å¦è·å–æ¯ä¸ªgoroutinesçš„è¿”å›å€¼,"è¯·é—®èƒ½å¦è·å–æ¯ä¸ªgoroutinesçš„è¿”å›å€¼ï¼Œæˆ‘æƒ³æ¯æ¬¡å¹¶å‘ä½¿ç”¨100ä¸ªç«¯å£ï¼Œå“ªä¸ªç«¯å£ç©ºé—²äº†å°±ä½¿ç”¨å“ªä¸ªç«¯å£ï¼Œå¦‚ä½•æ‰èƒ½ä¿è¯ä¸åŒæ—¶ä½¿ç”¨åˆ°ç›¸åŒçš„ç«¯å£
",,,,31299839,dream0407,7496278,panjf2000,69062,https://github.com/panjf2000/ants/issues/209,2022-03-09T15:11:22.000+08:00,2022-01-20T16:08:49.000+08:00,2022-03-09T15:11:22.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,110,
1127816236,134018330,212,closed,`purgePeriodically` function is left running for a while after `pool.Release` is called,"**Describe the bug**
When the `Pool.Release()` function is called, it can leave the `purgePeriodically` function running until its heartbeat `time.Ticker` triggers, at which point the condition on whether the pool is closed is checked by the `purgePeriodically` for loop. 

The issue is that one cannot assume the goroutines associated with an ant pool are completely cleaned up until the `purgePeriodically` function is completed - and as such, tools like goleak (https://github.com/uber-go/goleak) will report a leaked goroutine in tests. 

**To Reproduce**
Steps to reproduce the behavior:
1. Clone https://github.com/loopholelabs/frisbee
2. Check out the `rpc-async` branch
3. Run `go test ./...`
4. See error

**Expected behavior**
The `purgePeriodically` goroutine is closed when the `Release` function returns.

**Error messages/Trace logs**
```bash
goleak: Errors on successful test run: found unexpected goroutines:
[Goroutine 4 in state chan receive, with github.com/panjf2000/ants/v2.(*Pool).purgePeriodically on top of the stack:
goroutine 4 [chan receive]:
github.com/panjf2000/ants/v2.(*Pool).purgePeriodically(0x14000140000)
        /Users/shivanshvij/go/pkg/mod/github.com/panjf2000/ants/v2@v2.4.7/pool.go:69 +0x80
created by github.com/panjf2000/ants/v2.NewPool
        /Users/shivanshvij/go/pkg/mod/github.com/panjf2000/ants/v2@v2.4.7/pool.go:137 +0x380
]
FAIL    github.com/loopholelabs/frisbee 10.624s
```

**System info (please complete the following information):**
 - OS: macOS
 - Go Version: 1.17.6
 - ants version: 2.4.7

**Additional context**
Add any other context about the problem here.
",,,,27162109,ShivanshVij,7496278,panjf2000,39493,https://github.com/panjf2000/ants/issues/212,2022-03-08T16:30:19.000+08:00,2022-02-09T06:16:27.000+08:00,2022-03-08T16:30:19.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,113,
1142268611,134018330,213,open,goWorkerWithFunc:recycleTime is not thread safe,"**Describe the bug**
goWorkerWithFunc:recycleTime is not thread safe, it may purge the non-idle goroutine accidently since purgePeriodically read the wrong recycleTime

**To Reproduce**
it is hard to reproduce in sample code
",,,,24819147,arrony135,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/213,,2022-02-18T11:18:10.000+08:00,2022-03-08T15:12:22.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,114,
1174810786,134018330,214,open,any difference between this and https://github.com/bytedance/gopkg/tree/develop/util/gopool,any difference between this and https://github.com/bytedance/gopkg/tree/develop/util/gopool?,,,,51492452,hiqsociety,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/214,,2022-03-21T10:35:20.000+08:00,2022-03-21T10:35:21.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,115,
1174907155,134018330,215,open,is the latest 1.18 go routine faster than this?,"is the latest 1.18 go routine faster than this?

just curious coz it seems faster etc now",,,,51492452,hiqsociety,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/215,,2022-03-21T13:25:35.000+08:00,2022-03-23T06:39:56.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,116,
1196996550,134018330,217,closed,ants å’Œ waitgroupä¸€èµ·ä½¿ç”¨æ—¶å‡ºç° negative waitGroup counteré—®é¢˜,"**å¤§è‡´çš„é—®é¢˜**
ants åŒ…å’Œwaitgroupä¸€èµ·ä½¿ç”¨æ—¶,å‡ºç°negative waitGroupå¯¼è‡´panicï¼Œæ˜¯ä¸ªå¶å…ˆçš„é—®é¢˜ï¼Œç›®å‰å°è¯•ä¸­æ²¡æœ‰å¤ç°é—®é¢˜

**è°ƒç”¨æ ˆä¿¡æ¯**
```
github.com/panjf2000/ants/v2.(*goWorker).run.func1.1()
        /opt/tiger/compile_path/pkg/mod/github.com/panjf2000/ants/v2@v2.4.8/worker.go:58 +0x10c
panic({0xfcd760, 0x12e6080})
        /usr/local/go/src/runtime/panic.go:1038 +0x215
sync.(*WaitGroup).Add(0x1, 0xc0047b52b8)
        /usr/local/go/src/sync/waitgroup.go:74 +0x105
sync.(*WaitGroup).Done(0xc04451f700)
        /usr/local/go/src/sync/waitgroup.go:99 +0x25
main.F.func1()
        /opt/tiger/compile_path/src/A/p.go:85 +0x278
github.com/panjf2000/ants/v2.(*goWorker).run.func1()
        /opt/tiger/compile_path/pkg/mod/github.com/panjf2000/ants/v2@v2.4.8/worker.go:70 +0x97
created by github.com/panjf2000/ants/v2.(*goWorker).run
        /opt/tiger/compile_path/pkg/mod/github.com/panjf2000/ants/v2@v2.4.8/worker.go:48 +0x68
```

**é—®é¢˜ä»£ç **

```Go
package main

import (
	""fmt""
	""github.com/panjf2000/ants/v2""
	""sync""
)

func main() {
	res := make([]string, 20)
	for i := 0; i < 20; i++ {
		res[i] = ""a""
	}
	ids := make([]string, 0)
	tmp := make([]string, 0)
	var w sync.WaitGroup
	var mu sync.Mutex
	for i, r := range res {
		ids = append(ids, r)
		if len(ids) == 2 || i == len(res)-1 {
			tt := ids
			if err := ants.Submit(func() {
				defer w.Done()

				mu.Lock()
				defer mu.Unlock()
				tmp = append(tmp, tt...)
			});err != nil {
				fmt.Printf(""err occur %v\n"", err.Error())
			} else {
				w.Add(1)
				fmt.Printf(""add 1\n"")
			}
			ids = make([]string, 0)
		}
	}
	w.Wait()
	fmt.Println(""finish"")
}

```

**é¢„æœŸè¡¨ç°**
é¢„æœŸæ˜¯ä»»åŠ¡æäº¤æˆåŠŸåï¼Œå°±é€šè¿‡waitGroupçš„addåŠ ä¸€,å¦åˆ™ä¸æ‰§è¡Œï¼Œä½†ä»»åŠ¡å‡ºç°å¤šæ¬¡doneçš„æƒ…å†µï¼Œä¸æ¸…æ¥šåŸå› 
",,,,38785315,huangketsudou,7496278,panjf2000,42148,https://github.com/panjf2000/ants/issues/217,2022-05-07T22:45:35.000+08:00,2022-04-08T16:17:13.000+08:00,2022-05-07T22:45:35.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,117,
1201065478,134018330,218,closed,What happens to Routine when it has finished? ,"Just wondering what happens to a routine that is invoked within an ants pool after it finishes ? 

Let say i set up an ants pool of size 10, and I've invoked 10 routines, so there should be 10 routines running within the pool.
If 1 routine has finished, is it now 9 routines running? Or are we still left with 10 routine but with 1 inactive ? 

I've setup my application to handle PubSub messages concurrently with each message handled by a function invoked in a worker pool (so 10 messages = 10 Message handler in ants pool). However I want to make sure that the ant pool frees up resources when 1 of the handler finishes. ",,,,77963837,FeurJak,7496278,panjf2000,46,https://github.com/panjf2000/ants/issues/218,2022-04-12T13:50:28.000+08:00,2022-04-12T13:03:29.000+08:00,2022-04-12T13:50:29.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,118,
1206125988,134018330,219,closed,å…¬å¼€å‹æµ‹ä»£ç ,"å¯ä»¥å…¬å¼€å‹æµ‹çš„ä»£ç ï¼Ÿ
",,,,21958683,lockeliu,7496278,panjf2000,26691,https://github.com/panjf2000/ants/issues/219,2022-05-05T11:25:43.000+08:00,2022-04-16T22:33:56.000+08:00,2022-05-05T11:25:43.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,119,
1210377843,134018330,220,closed,Handling a worker / task that has failed,Is there an option to re-invoke worker if it has failed / crashed? Not too sure what WithPanicHandler() does. ,,,,77963837,FeurJak,7496278,panjf2000,23657,https://github.com/panjf2000/ants/issues/220,2022-05-07T19:29:32.000+08:00,2022-04-21T09:11:58.000+08:00,2022-05-07T19:29:32.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,120,
1215362122,134018330,222,closed,æƒ³çŸ¥é“æ˜¯ä½ ä»¬æ˜¯æ€ä¹ˆåšå‹æµ‹çš„ï¼Œå…‰çœ‹é€Ÿåº¦çš„è¯ï¼Œæˆ‘è¯•äº†ä¸€ä¸‹ï¼Œè¿˜ä¸å¦‚åŸç”Ÿçš„,"```
package main

import (
	""fmt""
	""github.com/panjf2000/ants/v2""
	""sync""
	""time""
)

var wg sync.WaitGroup

func main() {
	f := func() {
		wg.Done()
	}
	runTimes := 10000000
	defer ants.Release()
	start := time.Now()
	fmt.Println(start.Format(""2006-01-02 15:04:05""))
	wg.Add(runTimes)
	for i := 0; i < runTimes; i++ {
		//ants.Submit(f) // 4.5ç§’å·¦å³
		go f() //1.6ç§’å·¦å³
	}
	wg.Wait()
	fmt.Println(time.Now().Format(""2006-01-02 15:04:05""))
	e := time.Since(start)
	fmt.Println(e.String())
}
```",,,,30883503,yxiupei,7496278,panjf2000,12914,https://github.com/panjf2000/ants/issues/222,2022-05-05T11:25:13.000+08:00,2022-04-26T12:10:53.000+08:00,2022-05-05T11:25:13.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,121,
1239397157,134018330,223,closed,goroutine pool å¯¹æ€§èƒ½çš„å½±å“çš„ç–‘é—®,åœ¨go GMPæ¨¡å‹ä¸­ï¼Œæ•°æ®ç»“æ„Gæœ¬èº«ä¼šè¢«go schedulerå¤ç”¨ï¼Œä»å†…å­˜å’Œæ€§èƒ½æ–¹é¢è€ƒè™‘ï¼Œæ˜¯ä¸æ˜¯å’Œgoroutine poolä¸­å¯¹goroutineçš„å¤ç”¨æ•ˆæœæ˜¯ä¸€æ ·çš„å‘¢,,,,39076288,hugh-404,0,,0,https://github.com/panjf2000/ants/issues/223,2022-05-18T12:00:54.000+08:00,2022-05-18T12:00:11.000+08:00,2022-05-18T12:00:54.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,122,
1243368453,134018330,225,open,purgePeriodically å¯¼è‡´é˜»å¡,"æœ€æ–°ç‰ˆçš„ v2.5.0 releaseå ä»ç„¶ purgePeriodically å¾ªç¯ å¯¼è‡´ç¨‹åºé˜»å¡ ï¼Œæ˜¯æˆ‘ç”¨çš„ä¸å¯¹å—
Type: delay
Time: May 21, 2022 at 12:01am (CST)
Duration: 20.02s, Total samples = 40s (199.80%)
Entering interactive mode (type ""help"" for commands, ""o"" for options)
(pprof) traces
Type: delay
Time: May 21, 2022 at 12:01am (CST)
Duration: 20.02s, Total samples = 40s (199.80%)
-----------+-------------------------------------------------------
       20s   runtime.selectgo
             github.com/panjf2000/ants/v2.(*Pool).purgePeriodically
",,,,43371021,zqlpaopao,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/225,,2022-05-21T00:14:22.000+08:00,2022-05-27T19:11:23.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,123,
1244030382,134018330,226,closed,æœŸæœ›èƒ½æœ‰ TuneMaxBlockingTasks(size int) åŠ¨æ€è°ƒæ•´åŠŸèƒ½,"**Is your feature request related to a problem? Please describe.**
A clear and concise description of what the problem is. Ex. I'm always frustrated when [...]

```go
package main

import (
	""github.com/panjf2000/ants/v2""
)

var (
	// æ¨¡æ‹Ÿé…ç½®æ–‡ä»¶
	// å…è®¸åŒæ—¶å¤„ç† 10 ä¸ªä»»åŠ¡, æœ€å¤§å†æœ‰ 80 ä¸ªä»»åŠ¡æ’é˜Ÿ, è‹¥é˜Ÿæ»¡å°± ErrPoolOverload
	capSize  = 10
	maxTasks = 80
)

func main() {
	p, _ := ants.NewPool(capSize, ants.WithMaxBlockingTasks(maxTasks))
	defer p.Release()
	// ...

	// ç°åœ¨é…ç½®å˜åŒ–, æœŸæœ›åŠ¨æ€å˜æ›´
	capSize = 20
	maxTasks = 150

	p.Tune(capSize)
	// TODO
	p.TuneMaxBlockingTasks(maxTasks)
}
```

**Describe the solution you'd like**
A clear and concise description of what you want to happen.

```go
p.TuneMaxBlockingTasks(maxTasks)
```

**Describe alternatives you've considered**
A clear and concise description of any alternative solutions or features you've considered.

ç›®å‰ä¼¼ä¹åªèƒ½ä»¥æ–°çš„ maxTasks å‚æ•°æ–°å»º pool æ¥æ›¿æ¢. ä½†è¦æ–™ç†æ—§ pool æœªå®Œæˆçš„ä»»åŠ¡.
è‹¥æœ‰ç°æˆæ–¹æ¡ˆè¯·æŒ‡ç‚¹ä¸€ä¸‹. è°¢è°¢.

**Additional context**
Add any other context or screenshots about the feature request here.
",,,,4979407,fufuok,7496278,panjf2000,1086,https://github.com/panjf2000/ants/issues/226,2022-05-22T18:46:11.000+08:00,2022-05-22T00:39:29.000+08:00,2022-05-22T18:46:11.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,124,
1253913230,134018330,227,open,Performance differences between go1.13 and 1.14 and later versions,"In the same hardware environment, I found similar results to the author's conclusion for go1.13 in my tests, but for 1.14 onwards, ants no longer has a time consumption advantage, only a memory usage advantage. Is it because version 1.14 implements signal-based scheduling?
Attached are the test results, 3 million times, default pool size

1.13
go test -run=""TestNoPool"" -v
=== RUN   TestNoPool
--- PASS: TestNoPool (2.64s)
    ants_test.go:47: memory usage:1530 MB
PASS
ok      testGo/ant      2.759s

go test -run=""TestAntsPool"" -v
=== RUN   TestAntsPool
--- PASS: TestAntsPool (1.55s)
    ants_test.go:71: pool, capacity:2147483647
    ants_test.go:72: pool, running workers number:29722
    ants_test.go:73: pool, free workers number:2147453925
    ants_test.go:78: memory usage:73 MB
PASS
ok      testGo/ant      1.549s


1.14
go test -run=""TestNoPool"" -v
=== RUN   TestNoPool
    TestNoPool: ants_test.go:47: memory usage:289 MB
--- PASS: TestNoPool (0.78s)
PASS
ok      testGo/ant      0.783s

go test -run=""TestAntsPool"" -v
=== RUN   TestAntsPool
    TestAntsPool: ants_test.go:71: pool, capacity:2147483647
    TestAntsPool: ants_test.go:72: pool, running workers number:27475
    TestAntsPool: ants_test.go:73: pool, free workers number:2147456172
    TestAntsPool: ants_test.go:78: memory usage:71 MB
--- PASS: TestAntsPool (1.38s)
PASS
ok      testGo/ant      1.385s

",,,,29474400,LiaoPuJian,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/227,,2022-05-31T21:58:47.000+08:00,2022-05-31T21:58:48.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,125,
1257847610,134018330,228,closed,golang 1.17.x ç‰ˆæœ¬æµ‹è¯•é€šè¿‡äº†å—ï¼Ÿ,golang 1.17.x ç‰ˆæœ¬èƒ½æ­£å¸¸ä½¿ç”¨ ants å—ï¼Ÿæ˜¯å¦å·²ç»ç»è¿‡æµ‹è¯•äº†ã€‚,,,,47515663,ZhMaio,7496278,panjf2000,9689,https://github.com/panjf2000/ants/issues/228,2022-06-09T09:42:11.000+08:00,2022-06-02T16:13:04.000+08:00,2022-06-09T09:42:11.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,126,
1262980710,134018330,229,open,æ±‚é—®poolä¸­running()æ–¹æ³•è¿”å›çš„æ•°å­—çš„å«ä¹‰,"æˆ‘çš„ä»£ç ä¸­æœ‰ä¸€ä¸ªç”Ÿäº§è€…ï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…ã€‚ä»–ä»¬åˆ†å±ä¸‰ä¸ªæ± å­ã€‚
ç”Ÿäº§è€…ã€‚è¯»æ–‡ä»¶ï¼Œè§£æå¯¹è±¡ï¼Œæ ¹æ®ä¸šåŠ¡é€»è¾‘åˆ†åˆ«æäº¤ç»™æ¶ˆè´¹è€…1å’Œæ¶ˆè´¹è€…2ã€‚åç¨‹æ± å¤§å°=16.
æ¶ˆè´¹è€…1ã€‚cpuè®¡ç®—ã€‚åç¨‹æ± å¤§å°=64
æ¶ˆè´¹è€…2ã€‚GPUè®¡ç®—ã€‚åç¨‹æ± å¤§å°=64

ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ç›‘å¬åç¨‹æ± æ­£åœ¨è¿è¡Œæ•°é‡:
`
go func() {
		for {
			time.Sleep(time.Duration(1000) * time.Millisecond)
			fmt.Println(
				""RealCallPool:"" + strconv.Itoa(RealCallPool.Running()) + ""-"" + strconv.Itoa(RealCallPool.Waiting()) +
					""\tRd2PileupOnGpuPool:"" + strconv.Itoa(Rd2PileupOnGpuPool.Running()) + ""-"" + strconv.Itoa(Rd2PileupOnGpuPool.Waiting()) +
					""\tRd2pileupOnGoPool:"" + strconv.Itoa(Rd2pileupOnGoPool.Running()) + ""-"" + strconv.Itoa(Rd2PileupOnGpuPool.Waiting()))
		}
	}()
`

è¾“å‡ºçš„å†…å®¹:
ç”Ÿäº§è€…åç¨‹æ±  ï¼šrunning=16ï¼Œwaiting=1ï¼›ç¨³å®šä¸å˜
æ¶ˆè´¹è€…1/2ï¼Œrunning = 30-64 åŠ¨æ€ç¨³å®šï¼Œwaiting=0

æˆ‘çš„ç–‘é—®ï¼š
åœ¨ä¸Šè¿°è¿è¡ŒçŠ¶æ€ä¸­ï¼Œcpuåˆ©ç”¨ç‡åªæœ‰30-40æ ¸ã€‚è¯·é—®running()å’Œwaiting()æ–¹æ³•è¿”å›çš„æ•°å­—çš„å«ä¹‰ã€‚",,,,48267340,imDpeng,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/229,,2022-06-07T17:11:46.000+08:00,2022-06-08T19:46:06.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,127,
1264107782,134018330,230,open,How do I get the results of my tasks,"Hello:)
when i use â€œ_ = p.Invoke(task)â€ , I want to do something while the task is being completed, how do it?

",,,,14806824,iGen1us,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/230,,2022-06-08T10:35:14.000+08:00,2022-06-08T19:43:42.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,128,
671575307,134018330,102,closed,æ±‚è§£ï¼šç©ºé—²workerå›æ”¶åï¼Œä¸ºä»€ä¹ˆä¼šé‡æ–°æ”¾å›sync.Poolä¸­å‘¢,"ä½œè€…ä½ å¥½ï¼Œåœ¨é˜…è¯»æºç çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼š
ä¸€ä¸ªgoWorkeråœ¨å¤„ç†å®Œchanä¸­çš„taskåï¼Œä¼šæŠŠè‡ªèº«é‡æ–°æ”¾å›ç©ºé—²çš„workArrayä¸­ï¼Œä½†åŒæ—¶ä¹Ÿæ”¾åˆ°äº†workerCacheï¼ˆsync.Poolï¼‰ä¸­ï¼Œçœ‹äº†ä¸‹fasthttpçš„å®ç°ï¼Œä¹Ÿåšäº†åŒæ ·çš„å¤„ç†ã€‚åœ¨ä»£ç ä¸­æˆ‘æ ‡å‡ºäº†è¿™ä¸¤å¤„çš„ä½ç½®ã€‚

```go
func (w *goWorker) run() {
	w.pool.incRunning()
	go func() {
		defer func() {
			w.pool.decRunning()
			w.pool.workerCache.Put(w) // è¿™é‡Œæ”¾åˆ°äº†cacheä¸­
			if p := recover(); p != nil {
				if ph := w.pool.options.PanicHandler; ph != nil {
					ph(p)
				} else {
					w.pool.options.Logger.Printf(""worker exits from a panic: %v\n"", p)
					var buf [4096]byte
					n := runtime.Stack(buf[:], false)
					w.pool.options.Logger.Printf(""worker exits from panic: %s\n"", string(buf[:n]))
				}
			}
		}()

		for f := range w.task {
			if f == nil {
				return
			}
			f()
			if ok := w.pool.revertWorker(w); !ok {  // è¿™é‡ŒæŠŠç©ºé—²workeræ”¾å›äº†workArrayä¸­
				return
			}
		}
	}()
}
```

ç”±äºgoWorkeræ˜¯å¼•ç”¨ï¼Œæ‰€ä»¥åŒä¸€ä¸ªgoWorkerä¼šåŒæ—¶å­˜åœ¨äºworkerArrayå’Œsync.Poolä¸­ï¼Œä¼šä¸ä¼šå‡ºç°ä¸€ç§æƒ…å†µï¼Œä»sync.Poolä¸­Getçš„workerå…¶å®åœ¨è¿˜åœ¨æœ‰æ•ˆæœŸä¸­ï¼Œæœ€ç»ˆå¯¼è‡´goroutine poolä¸­è¿è¡Œçš„workeræ•°é‡æ˜¯â€å‡â€œçš„ï¼Œå› ä¸ºæœ‰ä¸¤ä¸ªworkeræ˜¯åŒä¸€ä¸ª

è¿™ç§æƒ…å†µå¯èƒ½éœ€è¦æµ‹è¯•ï¼Œå¹¶è¡Œæµ‹è¯•è¾ƒéš¾å¤ç°æˆ‘è¯´çš„åœºæ™¯ï¼Œå¦‚æœæ‚¨å¯¹äºè¿™å—æœ‰æ¯”è¾ƒå¥½çš„è§£ç­”ï¼Œæ„Ÿè°¢~

",,,,10286120,xieao,7496278,panjf2000,1380,https://github.com/panjf2000/ants/issues/102,2020-08-03T15:22:04.000+08:00,2020-08-02T16:21:16.000+08:00,2020-08-03T15:22:04.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,129,
675830456,134018330,104,closed,"æˆ‘æœ‰ä¸ªç–‘é—®,httpæœ¬èº«å°±æ˜¯åŸºäºgoroutineå®ç°å—ï¼Ÿ é›†æˆhttp server æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œå¤§ç¥ä»¬å›ç­”ä¸‹å‘—","æˆ‘æœ‰ä¸ªç–‘é—®,httpæœ¬èº«å°±æ˜¯åŸºäºgoroutineå®ç°å—ï¼Ÿ é›†æˆhttp server æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œå¤§ç¥ä»¬å›ç­”ä¸‹å‘—",,,,24741439,Xuzan9396,7496278,panjf2000,350,https://github.com/panjf2000/ants/issues/104,2020-08-10T16:37:13.000+08:00,2020-08-10T10:46:29.000+08:00,2020-08-10T16:37:13.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,131,
675845276,134018330,105,closed,"ç–‘é—®ï¼Ÿæˆ‘ç”¨NewPoolWithFunc åˆ›å»ºäº†10ä¸ªåç¨‹å»å¤„ç†ï¼Œæ¯ä¸ªgoroutineè€—æ—¶éœ€è¦1åˆ†é’Ÿå·¦å³,çœ‹ä¸‹æˆ‘çš„ä»£ç æ˜¯ä¸æ˜¯å¯ä»¥è¿™ä¹ˆå¤„ç†","#### ç–‘é—®ï¼Ÿæˆ‘ç”¨NewPoolWithFunc åˆ›å»ºäº†10ä¸ªåç¨‹å»å¤„ç†ï¼Œæ¯ä¸ªgoroutineè€—æ—¶éœ€è¦1åˆ†é’Ÿå·¦å³ï¼Œæœ‰ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯æˆ‘çš„goroutine é‡Œé¢å¯èƒ½æœ‰è¶…æ—¶ä»»åŠ¡ï¼Œä¸é‡Šæ”¾ï¼Œæˆ‘è¿™è¾¹æƒ³å¤„ç†2åˆ†é’Ÿè¿˜æ²¡ç»“æŸï¼Œå°±ç»“æŸæ‰è¿™ä¸ªgotoutineï¼Œ æˆ‘è¿™è¾¹ä»£ç æ˜¯ä¸æ˜¯å¯ä»¥è¿™ä¹ˆä¼˜åŒ–
```
	options := ants.Options{}
	options.ExpiryDuration = 2 * time.Minute  // ä¸¤åˆ†é’Ÿæ²¡å¤„ç†å®Œç»“æŸï¼Œé‡Šæ”¾
	p, _ := ants.NewPoolWithFunc(10, func(i interface{}) {
		// ä¸€åˆ†é’Ÿä»»åŠ¡
		return 
	},ants.WithOptions(options))
	p.Release()
```",,,,24741439,Xuzan9396,7496278,panjf2000,285,https://github.com/panjf2000/ants/issues/105,2020-08-10T16:33:18.000+08:00,2020-08-10T11:47:40.000+08:00,2020-08-11T09:19:29.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,132,
683789291,134018330,106,closed,æ€ä¹ˆæ ·å®ç°å…ˆæŠŠä»»åŠ¡æäº¤å†é™åˆ¶æ± çš„å¹¶å‘,,,,,61406754,dukv2001,7496278,panjf2000,3814,https://github.com/panjf2000/ants/issues/106,2020-08-24T19:15:41.000+08:00,2020-08-22T03:40:47.000+08:00,2020-08-24T19:15:41.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,133,
692140116,134018330,109,closed,è¾ƒæ–°ç‰ˆæœ¬golangæ˜¯å¦è¿˜éœ€è¦antsä»¥åŠç±»ä¼¼çš„poolå®ç°æ¥æ›¿ä»£goï¼Ÿ,"```sh
# go version go1.13.1

BenchmarkGoroutines-8  3   352026800 ns/op	   14885 B/op	      39 allocs/op
BenchmarkAntsPool-8    2   581543800 ns/op	16137376 B/op	 1001286 allocs/op
```

1. å¦‚æœä¸Šæ¸¸ä¸šåŠ¡æœ¬èº«å¹¶å‘åº¦è¾ƒé«˜ï¼Œç›´æ¥åŒæ­¥æ‰§è¡Œtaskå°±å¯ä»¥ï¼Œä¸éœ€è¦åç¨‹pool
2. ä¸ç®¡ä¸Šæ¸¸ä¸šåŠ¡æœ¬èº«å¹¶å‘åº¦æ˜¯é«˜è¿˜æ˜¯ä½ï¼Œå¦‚æœæƒ³è¦å¼‚æ­¥taskï¼Œç”±äºè¾ƒæ–°ç‰ˆæœ¬çš„goæ€§èƒ½å’Œgcéƒ½è¡¨ç°çš„å¾ˆä¸é”™ã€æ¯”poolå„æ–¹é¢è¿˜ç®—å¥½äº›ï¼Œpoolä¸goçš„ä¸»è¦åŒºåˆ«å°±æ˜¯åç¨‹æ•°é‡æ§åˆ¶ï¼Œgo+rate limitå³å¯ï¼Œä¸å¤ªéœ€è¦pool
",,,,3296206,cokeboL,7496278,panjf2000,6553,https://github.com/panjf2000/ants/issues/109,2020-09-08T14:26:02.000+08:00,2020-09-04T01:12:14.000+08:00,2020-09-08T14:26:02.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,135,
700343813,134018330,110,closed,WithMaxBlockingTasks doesn't seem to work as the docs indicate,"**Describe the bug**
`WithMaxBlockingTasks` doesn't seem to do what I think it should be doing based on the docs.

**To Reproduce**

I expect this to actually error:
```
p, _ := ants.NewPool(1, ants.WithMaxBlockingTasks(1))
var wg sync.WaitGroup
for i := 0; i < 5; i++ {
  err := p.Submit(func() {
   wg.Add(1)
   time.Sleep(time.Second)
   wg.Done()
  })
  if err != nil {
     // I expect this to have an error if i >= 2
  }
}
wg.Wait()
p.Release()
```

**Expected behavior**
I expect err to return `ants.ErrPoolOverload` when i >= 2.

**Error messages/Trace logs**
No error, it processes everything 1 at a time.

**System info (please complete the following information):**
 - OS: macOS
 - Go Version: 1.15.1
 - ants version: v2.4.2

",,,,2372558,polds,7496278,panjf2000,1378,https://github.com/panjf2000/ants/issues/110,2020-09-14T02:10:09.000+08:00,2020-09-13T03:11:24.000+08:00,2020-09-14T15:27:28.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,136,
719788673,134018330,112,closed,æƒ³é—®ä¸‹æœ¬é¡¹ç›®åœ¨è§£é”æ—¶ä¸ç”¨deferè¯­å¥çš„åŸå› ,æˆ‘é˜…è¯»äº†æœ¬é¡¹ç›®çš„ä»£ç ï¼Œå‘ç°æœ‰è®¸å¤šéœ€è¦è§£é”çš„åœ°æ–¹æ²¡æœ‰åœ¨deferä¸­è¿›è¡Œunlockï¼Œè€Œæ˜¯é‡‡å–äº†æ¯”è¾ƒéº»çƒ¦çš„â€”â€”åœ¨æ‰€æœ‰çš„å‡½æ•°é€€å‡ºç‚¹æ‰‹åŠ¨unlockã€‚æƒ³é—®ä¸‹ï¼Œæˆ‘ä»¬æ˜¯å‡ºäºdeferçš„æ€§èƒ½é—®é¢˜è€Œæ”¾å¼ƒäº†è¿™ä¸€å†™æ³•å—ï¼Ÿå¦‚æœæ˜¯ï¼Œåœ¨go1.13ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œdeferè¯­å¥æœ‰äº†æ¯”è¾ƒæ˜æ˜¾çš„æ€§èƒ½ä¼˜åŒ–ï¼Œå¦‚æœæ˜¯åŸºäº1.13ä¹‹åçš„ç‰ˆæœ¬æ¥å¼€å‘è¿™ä¸€å·¥å…·ï¼Œæˆ‘ä»¬çš„å¼€å‘è€…ä¼šå€¾å‘äºé€‰æ‹©deferè¯­å¥ä¸­unlockè¿˜æ˜¯æ‰‹åŠ¨unlockï¼Ÿ,,,,25627418,FingalVon,7496278,panjf2000,2404,https://github.com/panjf2000/ants/issues/112,2020-10-15T01:56:28.000+08:00,2020-10-13T09:51:40.000+08:00,2020-10-15T01:56:28.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,138,
719993557,134018330,113,closed,[BUG] Memory leak,"The following is my code causing a memory leak in `ants@v2.4.2`
```
package main

import (
	""fmt""
	""net/http""
	_ ""net/http/pprof""
	""sync""
	""time""

	""github.com/panjf2000/ants/v2""
)

func main() {
	/**
	pprof
	http://127.0.0.1:6060/debug/pprof/
	*/
	go func() {
		_ = http.ListenAndServe(""localhost:6060"", nil)
	}()

	for k := 0; k < 4; k++ {
		for i := 0; i < 400; i++ {
			go DoTask()
			time.Sleep(time.Millisecond * 10)
		}
		time.Sleep(time.Second * 2)
	}
	fmt.Println(""Done"")

}

func DoTask() {
	pool, _ := ants.NewPool(2, ants.WithExpiryDuration(time.Second*2))

	wg := sync.WaitGroup{}

	{
		wg.Add(1)
		err := pool.Submit(func() {
			defer wg.Done()
			time.Sleep(time.Millisecond * 10)
		})
		if err != nil {
			fmt.Println(err)
		}
	}

	{
		wg.Add(1)
		err := pool.Submit(func() {
			defer wg.Done()
			time.Sleep(time.Millisecond * 10)
		})
		if err != nil {
			fmt.Println(err)
		}
	}

	wg.Wait()
	pool.Release()
}

```

### Timeline
```
------------------------------------------------------------------------------------------
CPU0 revertWorker            -> state closed -> Lock -> reset -> Unlock
------------------------------------------------------------------------------------------
CPU1 Release     -> state ok ->                                         -> Lock -> insert
------------------------------------------------------------------------------------------
```

### Consider the following:
1. `Pool.revertWorker` starts to execute (`Pool.state` is not `CLOSED`), but `Pool.revertWorker` -> `Pool.lock.Lock` has not yet been called.
2. `Pool.Release` starts to execute (`Pool.state` is `CLOSED`) and `Pool.Release` -> `Pool.lock.Lock` has been called.
3. `Pool.purgePeriodically` would break out of a loop next time.
4. `Pool.Release` -> `p.workers.reset` (clean up all workers in `workerStack.items`).
5. `Pool.revertWorker` -> `p.workers.insert`(add a worker to `workerStack.items`), but this worker would never receive any task, also leading to `goWorker.run` leaks.

However, there may be a race condition between 1 and 2.


### Note:
I tried to solve that, it seemed to work.
```
 // revertWorker puts a worker back into free pool, recycling the goroutines.
 func (p *Pool) revertWorker(worker *goWorker) bool {
-       if capacity := p.Cap(); (capacity > 0 && p.Running() > capacity) || atomic.LoadInt32(&p.state) == CLOSED {
+       if capacity := p.Cap(); capacity > 0 && p.Running() > capacity {
                return false
        }
        worker.recycleTime = time.Now()
        p.lock.Lock()

+       if atomic.LoadInt32(&p.state) == CLOSED {
+               p.lock.Unlock()
+               return false
+       }
```

# In Chinese
æˆ‘ä»¬å‘ç°`Pool.revertWorker`è·Ÿ`Pool.Release`å­˜åœ¨ç«æ€é—®é¢˜ï¼Œä¼šå¯¼è‡´`goroutine`æ³„éœ²ã€‚

### Timeline
```
------------------------------------------------------------------------------------------
CPU0 revertWorker            -> state closed -> Lock -> reset -> Unlock
------------------------------------------------------------------------------------------
CPU1 Release     -> state ok ->                                         -> Lock -> insert
------------------------------------------------------------------------------------------
```

å¦‚æœ`Release`å…ˆè¿è¡Œï¼ˆå½“å‰æ± å­çŠ¶æ€æœªå…³é—­å¾€ä¸‹èµ°ç­‰é”ï¼‰ï¼Œç„¶å`revertWorker`ä¹Ÿå¼€å§‹è¿è¡Œäº†ã€‚åªè¦åè€…æ¯”å‰è€…å…ˆæ‹¿åˆ°é”`Pool.lock`ï¼Œå°±ä¼šå¯¼è‡´è¿™ä¸ªworkeræ³„éœ²ã€‚
`Release`åªä¼šç»™å½“æ—¶å­˜åœ¨æ± å­ä¸­çš„`worker`å‘`nil`ï¼Œè€Œè¿™ä¸ª`worker`è‚¯å®šæ²¡æœ‰åœ¨æ± å­ä¸­ï¼›ç„¶å`purgePeriodically`ä¹Ÿä¼šå› ä¸ºæ± å­å…³é—­è€Œé€€å‡ºå¾ªç¯ï¼Œåé¢`worker`è¿‡æœŸå°±æ²¡äººç®¡äº†ã€‚é™¤æ­¤ä¹‹å¤–å¥½åƒä¹Ÿæ²¡æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥è®©æ³„éœ²çš„`worker`é€€å‡ºäº†ã€‚

### Note:
å°å¼Ÿæ–—èƒ†ç»™å¤§ä½¬æ‚¨æäº¤ä¸€ä¸ªissueï¼Œè¯´çš„ä¸å¯¹çš„åœ°æ–¹è¿˜è¯·å¤šå¤šæŒ‡æ­£ï¼ŒèŸ¹èŸ¹ï¼
æƒ³è·Ÿæ‚¨æ›´åŠ æ·±å…¥çš„è®¨è®ºä¸€ä¸‹è¿™ä¸ªåº“ï¼Œæ–¹ä¾¿åŠ ä¸‹æ‚¨çš„å¾®ä¿¡å—ï¼Ÿå°å¼Ÿé‚®ç®±cainiao666999@gmail.comï¼Œå¯ä»¥çš„è¯æˆ‘æ¥åŠ æ‚¨ğŸ˜ƒã€‚",,,,29589055,Mutated1994,7496278,panjf2000,2595,https://github.com/panjf2000/ants/issues/113,2020-10-15T11:35:56.000+08:00,2020-10-13T16:20:56.000+08:00,2020-10-15T11:35:56.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,139,
722994544,134018330,115,closed,[QUESTION] Excuse me,"Bro, when will you consider adding a new tagï¼Ÿ",,,,29589055,Mutated1994,7496278,panjf2000,22,https://github.com/panjf2000/ants/issues/115,2020-10-16T16:14:51.000+08:00,2020-10-16T15:52:14.000+08:00,2020-10-16T16:14:51.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,141,
724008505,134018330,116,closed,æƒ³è¯·æ•™ä¸€ä¸‹ï¼ŒæŠŠäº’æ–¥é”æ”¹æˆè‡ªæ—‹é”çš„ç›®çš„æ˜¯ä»€ä¹ˆå‘¢,"**What is your question about ants?**
Please describe your question meticulously.
å¦‚é¢˜ï¼Œå¤§æ¦‚çŒœæµ‹æ˜¯å› ä¸ºé”ä¿æŠ¤çš„ä»£ç æ—¶é—´éå¸¸çŸ­ï¼Œä½¿ç”¨è‡ªæ—‹é”èƒ½å¤Ÿæ¯”äº’æ–¥é”æ€§èƒ½æ›´ä¼˜ï¼Ÿ",,,,7411249,imxyb,7496278,panjf2000,71,https://github.com/panjf2000/ants/issues/116,2020-10-18T22:46:48.000+08:00,2020-10-18T21:35:14.000+08:00,2020-10-19T00:03:27.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,142,
728597070,134018330,118,open,Does this means we can perform soft-realtime goroutine using this feature like erlang?,"possible to use ants as a soft-realtime go func() like erlang?

sorry i hv yet to explore this code in detail but i'm exploring options to make goroutines handle more connections like erlang.",,,,51514008,gitmko0,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/118,,2020-10-24T07:26:54.000+08:00,2020-10-24T07:26:54.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,144,
729205618,134018330,119,closed,worker exits from a panic: reflect: call of reflect.Value.Len on ptr Value,**worker exits from a panic: reflect: call of reflect.Value.Len on ptr Value**,,,,48704159,gdlxSong,7496278,panjf2000,10713,https://github.com/panjf2000/ants/issues/119,2020-11-02T22:02:26.000+08:00,2020-10-26T11:28:28.000+08:00,2020-11-02T22:02:26.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,145,
730161470,134018330,120,closed,æäº¤äº†å¤§é‡BlockingTasksï¼Œå½“pool.æ³¨é”€æ—¶ï¼Œå›æ”¶å†…å­˜æ¯”è¾ƒæ…¢,æˆ‘æƒ³çŸ¥é“ï¼Œæ€ä¹ˆè‡ªå®šä¹‰å›æ”¶å†…å­˜çš„æ—¶é—´,,,,7267234,jiangjiali,7496278,panjf2000,1599,https://github.com/panjf2000/ants/issues/120,2020-10-28T17:20:39.000+08:00,2020-10-27T14:41:08.000+08:00,2020-10-30T17:41:28.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,146,
731239827,134018330,121,closed,æœ‰è€ƒè™‘æ”¯æŒåŠ¨æ€ä¼¸ç¼©æ± å­å¤§å°å—ï¼Ÿ,,,,,6133860,jianzhiyao,7496278,panjf2000,24,https://github.com/panjf2000/ants/issues/121,2020-10-28T17:18:39.000+08:00,2020-10-28T16:54:25.000+08:00,2020-10-28T17:18:39.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,147,
736200176,134018330,122,closed,Some questions about pool.Tune(),"i use the ants as the pool to control goroutines, and pool.Tune() can  tune pool capacity in runtime, so it is necessary to realize automatic expansion and contraction of pool? Looking forward to your answer, thank you ï¼
ä½¿ç”¨äº†antsä½œä¸ºpoolç®¡æ§goroutineï¼Œ poolä¸­ä¹Ÿæä¾›äº†ä¸€ä¸ªTune()æ–¹æ³•å¯ä»¥åœ¨è¿è¡ŒæœŸé—´è°ƒæ•´å¤§å°ï¼Œé‚£ä¹ˆè¿˜æœ‰å¿…è¦å»å®ç°poolçš„è‡ªåŠ¨æ‰©ç¼©å®¹å—ï¼ŸæœŸå¾…ä½ çš„è§£ç­”ï¼Œè°¢è°¢ï¼",,,,42341553,PPeacHH,7496278,panjf2000,7884,https://github.com/panjf2000/ants/issues/122,2020-11-10T10:45:34.000+08:00,2020-11-04T23:20:51.000+08:00,2020-11-10T10:45:34.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,148,
737043014,134018330,123,closed,the ants goroutine pool performance ,"**Why the perf result on my local when using ants goroutines pool doesn't like the benchmark pictures?**
I have cloned the latest code on the master branch and tried to run this command _go test -bench=. -run=none -benchmem=true_ but I got the result quite different from your benchmark pictures, the time of each test loop when using ants pool takes longer.

Here is the result on my machine:
![image](https://user-images.githubusercontent.com/23579202/98261210-cb490000-1fb6-11eb-95fb-ef28d2227234.png)

In the bench tests, I see you're using the ant pool with size 200000 to handle 1000000 tasks, so the result on my machine is what I expected because the size of the ants pool smaller than the number of tasks, so it will save the hardware resources for us but can not be faster than spawning 1000000 goroutines for that job. 

please correct me. 

Here is the detail of my environment when running the test:
_go version go1.15 darwin/amd64_
`
    Hardware Overview:

      Processor Name: 6-Core Intel Core i7
      Processor Speed: 2.6 GHz`
OS: macOS catalina",,,,23579202,jedrp,7496278,panjf2000,12162,https://github.com/panjf2000/ants/issues/123,2020-11-14T10:23:44.000+08:00,2020-11-05T23:41:29.000+08:00,2020-11-22T15:19:49.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,149,
737434903,134018330,124,closed,å¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡ ä¿å­˜ NewPoolä¹ˆï¼Ÿ,,,,,14883130,foreverZSJ,7496278,panjf2000,9164,https://github.com/panjf2000/ants/issues/124,2020-11-12T20:34:23.000+08:00,2020-11-06T11:49:31.000+08:00,2020-11-12T20:34:41.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,150,
738170151,134018330,125,open,About the memory consumption of pool,"How much memory per goroutine pool size? Can you please put this on main page?
p, _ := ants.NewPool(50000) <- basically goroutine use 2kb / 4kb per go routine

From benchmark, it's 50k pool
https://github.com/panjf2000/ants/#-performance-summary
total 10M ants instance is 38mb which means each item size is 760bytes with 50000 items.

is 760bytes the limit for each pool item?

last question:
pool.Tune(100000) <- May I ask what's the ""optimum size"" for this? what's a good suggestion / advise on setting size? also on what occasion will u suggest tuning this size? please put the number of bytes each pool is on front page as mentioned so we can calculate and adjust better with your input.",,,,51514008,gitmko0,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/125,,2020-11-07T12:40:04.000+08:00,2020-11-07T12:48:39.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,151,
738173237,134018330,126,open,About the performace when using ants in websocket ,"Will websocket be written with ants be more performant than using solutions such as gobwas or fastws

With reference to go routines being used in websocket here
https://www.freecodecamp.org/news/million-websockets-and-go-cc58418460bb/
and also here:
https://github.com/dgrr/fastws/

I havent tried yet but do you think ants with websocket will be faster and more performant than them for high number of connections? e.g. 1M to 10M connections using ants for websocket.",,,,51514008,gitmko0,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/126,,2020-11-07T13:02:02.000+08:00,2021-01-11T09:50:12.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,152,
738174165,134018330,127,open,I just realised your server spec must be very very good,"For 10M tasks using only 1.3gb, can you put your server spec into front page for your benchmark?
It seems to be very very good.",,,,51514008,gitmko0,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/127,,2020-11-07T13:08:00.000+08:00,2020-11-07T13:08:00.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,153,
741209727,134018330,128,closed,æ•´ä¸ªé¡¹ç›®çš„æ ¸å¿ƒï¼Œ æˆ‘çš„ç†è§£å¯¹ä¸å¯¹ï¼,"
![image](https://user-images.githubusercontent.com/24741439/98886138-674e9c00-24ce-11eb-9303-48ae82158104.png)

æˆªå›¾æ‰€ç¤º
## ç¬¬ä¸€éƒ¨åˆ†æ˜¯å¤ç”¨ goruntine workeræ± å­ï¼Œ é˜²æ­¢é¢‘ç¹åˆ›å»ºï¼Œgc ä¸å¿…è¦çš„æŸè€—
## ç¬¬äºŒéƒ¨åˆ†æ˜¯åœ¨å¤ç”¨æ± å­çš„åŸºç¡€ä¸Šï¼Œæ§åˆ¶æ± å­çš„å¤§å°
ä¸çŸ¥é“æˆ‘ç†è§£çš„å¯¹ä¸å¯¹ï¼Œ æœ€æ–°å¯¹è¿™å—æ€§èƒ½æ–¹é¢ä¼˜åŒ–æŒºæ„Ÿå…´è¶£çš„",,,,24741439,Xuzan9396,7496278,panjf2000,2889,https://github.com/panjf2000/ants/issues/128,2020-11-14T10:17:22.000+08:00,2020-11-12T10:08:14.000+08:00,2020-11-18T16:15:24.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,154,
755047477,134018330,129,closed,"å¦‚æœä»»åŠ¡å¡ä¸»äº†,æ€ä¹ˆå…³é—­è¿™ä¸ªä»»åŠ¡","æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•ä¸»åŠ¨å…³é—­åç¨‹
",,,,30611869,lwydyby,7496278,panjf2000,4041,https://github.com/panjf2000/ants/issues/129,2020-12-05T11:33:10.000+08:00,2020-12-02T16:11:16.000+08:00,2020-12-05T11:33:17.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,155,
772339531,134018330,130,closed,å…³äºè¿”å›å€¼,æˆ‘æƒ³çŸ¥é“ï¼Œæˆ‘æ€æ ·æ‰èƒ½è·å–æ¯ä¸ªåç¨‹çš„è¿”å›å€¼ï¼Œéœ€è¦æˆ‘å•ç‹¬æ„å»ºä¸€ä¸ªç®¡é“ä¹ˆï¼Ÿå¦å¤–ï¼Œæˆ‘åº”å½“å¦‚ä½•æ§åˆ¶è¶…æ—¶ï¼Ÿ,,,,17517153,Alberthchang,7496278,panjf2000,799,https://github.com/panjf2000/ants/issues/130,2020-12-22T14:43:23.000+08:00,2020-12-22T01:23:50.000+08:00,2020-12-22T14:43:23.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,156,
802177721,134018330,132,closed,need more examples,"Is there any repo using ants as an example? 
ants is an amazing package , though i feel it needs more documentation and examples",,,,70520127,savixazz,7496278,panjf2000,154068,https://github.com/panjf2000/ants/issues/132,2021-05-23T21:34:56.000+08:00,2021-02-05T21:46:12.000+08:00,2021-05-23T21:34:57.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,158,
807765048,134018330,133,closed,Any difference between using without modules and v2?,I'm using without modules and it works fine. Wondering if there are any benefits to use the v2 version with modules,,,,51492452,hiqsociety,7496278,panjf2000,57727,https://github.com/panjf2000/ants/issues/133,2021-03-26T01:11:15.000+08:00,2021-02-13T23:03:51.000+08:00,2021-03-26T01:11:15.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,159,
818082145,134018330,134,closed,ç”¨vendoræ€ä¹ˆä¸‹è½½v2ç‰ˆæœ¬ï¼Ÿï¼Ÿï¼Ÿ,è€é¡¹ç›®ç”¨çš„vendorï¼Œæš‚æ—¶ç”¨ä¸äº†gomodï¼Œä½†æ˜¯ç°åœ¨åº“é‡Œä¸€ä¸ªåŒ…ä¾èµ–çš„æ˜¯v2ç‰ˆæœ¬ï¼Œæ€ä¹ˆä¸‹è½½v2çš„åˆ°vendoré‡Œå‘¢ï¼Ÿ,,,,25148685,hhyvs111,7496278,panjf2000,4541,https://github.com/panjf2000/ants/issues/134,2021-03-03T14:20:51.000+08:00,2021-02-28T10:39:49.000+08:00,2021-03-03T14:20:51.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,160,
818372401,134018330,135,closed,"If ants' goroutine crash, will the whole software crash?","If ants' goroutine crash, will the whole software crash?

If so, how can we make it so that the software will still runs even if crash like erlang processes?",,,,51492452,hiqsociety,7496278,panjf2000,933,https://github.com/panjf2000/ants/issues/135,2021-03-02T00:44:24.000+08:00,2021-03-01T09:10:30.000+08:00,2021-03-02T00:44:24.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,161,
821650908,134018330,137,closed,"Since we can pool.Tune(), how can we return the current capacity to check if it's worth tuning up or down?","Since we can pool.Tune(), how can we return the current capacity to check if it's worth tuning up or down?

possible to do a Capacity()? Does it hv this function already?",,,,51492452,hiqsociety,7496278,panjf2000,1,https://github.com/panjf2000/ants/issues/137,2021-03-04T09:04:21.000+08:00,2021-03-04T09:03:06.000+08:00,2021-03-04T09:04:21.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,163,
823817947,134018330,138,closed,è¯·æ•™ä¸‹æ€ä¹ˆåˆ¤æ–­æ¯ä¸ªworkerçš„ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•å‘¢ï¼Ÿ,"ä½œè€…ä½ å¥½ï¼Œåœ¨`README`ä¸­ï¼Œé¢„å…ˆçŸ¥é“äº†éœ€è¦æ‰§è¡Œçš„taskä¸ªæ•°ï¼Œåˆ©ç”¨`sync.WaitGroup`å»ç­‰å¾…æ‰€æœ‰çš„taskæ‰§è¡Œå®Œæ¯•

æƒ³è¯·æ•™ä¸‹ï¼Œåœ¨é¢„å…ˆä¸çŸ¥é“taskä¸ªæ•°çš„æƒ…å†µä¸‹ï¼Œæ€ä¹ˆå»çŸ¥é“æ‰€æœ‰çš„Taskéƒ½æ‰§è¡Œå®Œäº†å‘¢ï¼Ÿï¼Œä¼ªä»£ç å¦‚ä¸‹:

```golang

type Args struct {
    ID       int
    Name string
}

func Task(args interface{}){
    param := args.(Args)
    fmt.Printf(""param: %#v\n"", param)
}

func main() {
    defer ants.Release()
    
    p, _ = ants.NewPoolWithFunc(10, Task)
    
    defer p.Release()

    for _, model := range queryResult {    
        args := Args {
             Name: model.Name,
             ID:       model.ID,
        }
        p.Invoke(args)
    }
    //ç­‰å¾…æ‰€æœ‰çš„Taskæ‰§è¡Œå®Œæ¯•åå†ç»“æŸ ï¼Ÿ
}
```
",,,,18528873,mayouzi,7496278,panjf2000,4479,https://github.com/panjf2000/ants/issues/138,2021-03-10T14:05:31.000+08:00,2021-03-07T11:26:03.000+08:00,2021-03-10T14:05:31.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,164,
824927472,134018330,140,closed,Sitting idle using ants eats up to 5% cpu progressively from time to time,"Sitting idle using ants eats up to 5% cpu just sitting idle from time to time.

possible to disable this eating cpu? if idle should not be eating cpu time.",,,,51492452,hiqsociety,7496278,panjf2000,28376,https://github.com/panjf2000/ants/issues/140,2021-03-28T21:29:40.000+08:00,2021-03-09T04:32:45.000+08:00,2021-03-28T21:29:40.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,166,
830099075,134018330,141,closed,retrieveWorker may wait forever,"1. retrieveWorker will wait when there is no any available work.
2. Then, call Pool.Release(), the state of pool will be changed to CLOSED.
3. All works which are running finish their work, then revertWorker return false, since the state is CLOSED.
4. The tick in purgePeriodically() function will arrive, then break from the for loop, since the state is CLOSED.

So, nobody will send the signals to the guys which are waiting in retrieveWorker function.",,,,17548688,math345,7496278,panjf2000,8697,https://github.com/panjf2000/ants/issues/141,2021-03-18T22:01:18.000+08:00,2021-03-12T21:04:12.000+08:00,2021-03-18T22:01:18.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,167,
830908542,134018330,142,closed,Why not â€œp.Running()<capacityâ€ï¼Ÿ,"https://github.com/panjf2000/ants/blob/fd8d670fd09489e6ea7693c0a382ba85d2694f16/pool.go#L238

When the worker being executed is less than the capacity, it is already possible not to block, so why wait for all the execution to be completed before you can spawnWorker().
Why not â€œp.Running()<capacityâ€ï¼Ÿ
I am a newbie and would like to get answersï¼Œthanks.

å½“æ­£åœ¨æ‰§è¡Œçš„workerå°äºå®¹é‡çš„æ—¶å€™ï¼Œå°±å·²ç»å¯ä»¥ä¸ç”¨é˜»å¡äº†ï¼Œä¸ºä»€ä¹ˆè¦ç­‰å¾…å…¨éƒ¨æ‰§è¡Œå®Œäº†æ‰å¯ä»¥è¿›è¡ŒspawnWorker()",,,,48661001,sirodeneko,0,,5676,https://github.com/panjf2000/ants/issues/142,2021-03-17T20:54:56.000+08:00,2021-03-13T22:17:59.000+08:00,2021-03-18T09:30:05.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,168,
834309657,134018330,143,open,å…³äº [Issue 142][Why not â€œp.Running()<capacityâ€] çš„é—®é¢˜,"
ç”±äº [Issue 142 Why not â€œp.Running()<capacityâ€](https://github.com/panjf2000/ants/issues/142) å·²ç» Closed ï¼Œæ‰€ä»¥æˆ‘æ–°æäº¤äº†ä¸€ä¸ª Issue ã€‚

è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æƒ³è¿‡ã€‚æˆ‘è§‰å¾—ç›®å‰çš„åšæ³•ä¸æ˜¯å¾ˆä¼˜é›…ã€‚æˆ‘ä¹‹å‰å¯¹è¿™æ®µä»£ç è¿›è¡Œäº†ä¸€äº›æ¨æ•²ï¼Œæˆ‘æŠŠæˆ‘çš„ç†è§£æ•´ç†å¦‚ä¸‹ã€‚

ä¸ºä»€ä¹ˆè¦åŠ ä¸‹é¢è¿™æ®µä»£ç å‘¢ï¼Ÿè€Œä¸” p.lock.Unlock() åå†è°ƒç”¨ spawnWorker()ï¼Œrunning ä¸ªæ•°å¤±å»äº†ä¿æŠ¤ï¼Œè¿™ä¸ªæ¬¡æ•°å°±æœ‰å¯èƒ½è¶…è¿‡äº†è®¾å®šçš„æœ€å¤§å€¼ capacityã€‚

```
		if p.Running() == 0 {
			p.lock.Unlock()
			spawnWorker()
			return
		}
```

å¥½å§ï¼Œæˆ‘ä»¬å…ˆå¿½ç•¥ä¸Šé¢è¿™ä¸ªå°é—®é¢˜ã€‚å†æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼Œä¸ºä»€ä¹ˆä¸èƒ½åœ¨ w == nil æ—¶ï¼Œç›´æ¥ spawnWorker() ä¸ªæ–°çš„ worker?  å› ä¸ºæœ‰å¯èƒ½æ˜¯æ”¶åˆ°å¹¿æ’­ä¿¡å·ï¼Œæ­¤æ—¶ä¸èƒ½ä¿è¯ p.Running() <= capacity ã€‚

```
		w = p.workers.detach()
		if w == nil {
			goto Reentry
		}
```

ä½†æ˜¯ï¼Œæˆ‘è§‰å¾—å¯ä»¥é€šè¿‡ä¿®æ”¹æˆä¸‹é¢çš„ä»£ç è§£å†³æ‰è¿™ä¸ªé—®é¢˜

```
		w = p.workers.detach()
		if w == nil {
			if p.Running() < capacity {
				spawnWorker()
				p.lock.Unlock()
				return
			}
			goto Reentry
		}
```

ç”±äºä½œè€…æ²¡æœ‰é‡‡ç”¨ç±»ä¼¼è¿™æ ·çš„å†™æ³•ï¼Œå¯¼è‡´éœ€è¦å¢åŠ  `if p.Running() == 0` è¿™æ®µä»£ç å¤„ç†å¹¿æ’­ä¿¡å·ã€‚

å†æ¥çœ‹å¹¿æ’­ä¿¡å·ï¼Œå¹¿æ’­ä¿¡å·æ˜¯åœ¨å®šæ—¶å›æ”¶æ—¶ï¼Œæ»¡è¶³ä¸‹é¢çš„æ¡ä»¶è§¦å‘çš„ã€‚

```
		// There might be a situation that all workers have been cleaned up(no any worker is running)
		// while some invokers still get stuck in ""p.cond.Wait()"",
		// then it ought to wakes all those invokers.
		if p.Running() == 0 {
			p.cond.Broadcast()
		}
```

ä¸ºä»€ä¹ˆéœ€è¦è¿™æ®µä»£ç ï¼ŸåŸå› åœ¨äºéœ€è¦è€ƒè™‘è¿™ä¹ˆä¸€ç§æƒ…å†µï¼Œå½“ retrieveWorker() å‘ç° runing() ä¸ªæ•°è¶…è¿‡äº†å®¹é‡ï¼Œå› æ­¤åœ¨ p.cond.Wait() ä¸­ã€‚ä¹‹å runing() çš„æ‰€æœ‰ worker f() éƒ½å‘ç”Ÿäº† panicï¼ŒæŒ‰å½“å‰çš„ä»£ç é€»è¾‘ï¼Œæ˜¯æ— æ³•æ­£å¸¸å½’è¿˜åˆ°å·¥ä½œæ± ä¸­çš„ï¼ŒrevertWorker ä¸ä¼šè¢«è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ revertWorker ä¸ä¼šå‘å‡º Signal é€šçŸ¥ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æ£€æµ‹åˆ°æ²¡æœ‰1ä¸ªworker runningï¼Œå°± Broadcast ä¿¡å·ã€‚

```
for f := range w.task {
	
	if f == nil {
		return
	}
	
	// éœ€è¦è€ƒè™‘ f() panic çš„æƒ…å†µï¼Œæ­¤æ—¶ä¸ä¼šå½’è¿˜åˆ°å·¥ä½œæ± ä¸­
	f()
	
	if ok := w.pool.revertWorker(w); !ok {
		return
	}
}
```

å› æ­¤å¹¿æ’­ä¿¡å·çš„åŠ å…¥ï¼Œç¡®å®å¢åŠ äº†å¤æ‚åº¦ã€‚èƒ½ä¸èƒ½åœ¨work run() ä¸­åŒ…è£…è°ƒç”¨ f() ï¼Œå¤„ç† panic ?",,,,17548688,math345,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/143,,2021-03-18T09:36:19.000+08:00,2021-08-30T12:06:42.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,169,
837779470,134018330,144,closed,"Out-of-date README, misleading terminology and stale description on high performance ","Thanks for your great job on the project. 

I have some questions:
1. out-of-date image and code
 The image [10M tasks](https://github.com/panjf2000/ants#10m-tasks) is a misused or stale image. The bench function it called is not the same as [1M tasks](https://github.com/panjf2000/ants#1m-tasks) and [100k tasks](https://github.com/panjf2000/ants#100k-tasks). It is partly the same as the pic [benchmarks-with-poolwithfunc](https://github.com/panjf2000/ants#benchmarks-with-poolwithfunc) above.
 And I didn't see the bench function it called ,naming ""BenchmarkGoroutineWithFunc"",""BenchmarkAntsPoolWithFunc"", exists in the source code. Maybe it has already been removed from the src, or changed to ""^TestAntsPoolWithFunc...""

2. About throughput and latency
 In [here](https://github.com/panjf2000/ants#throughput-it-is-suitable-for-scenarios-where-tasks-are-submitted-asynchronously-without-waiting-for-the-final-results), you describe the result as a kind of throughput,but maybe it should be more like a one-way latency (you just commit the job,and never wait it to be done)
 Throughput should be calculated like  [here](https://github.com/panjf2000/ants/blob/master/ants_benchmark_test.go#L64) , using wg.Wait() to get the total elapsed time t, and divide it to the number of goroutines committed, e.g."" t / #goroutine ""
 That's a clear question when facing pipeline.
 The Image [performance-summary](https://github.com/panjf2000/ants#-performance-summary) uses ""Goroutine throughput benchmark"" as its title, but using memory and latency as its y-label, which is confusing. Maybe ""throughput"" should be removed

3. About the performance,I tried to run the bench for more than 3 times, and got the following results.
The results seem to be very different from the bench in your [README](https://github.com/panjf2000/ants#benchmarks-with-pool)

About my machine&env:
```
Intel(R) Core(TM) i5-8250U CPU @ 1.60GHz

go version go1.16.2 windows/amd64
```

3.1 Using Test
The only quoted variable `n` has been set to ` n        = 10000000 `, e.g. 10M
It seems that TestAntsPool runs slower than TestNoPool, though the memory saved is obviously huge.

```sh
PS D:\go-work\src\github.com\panjf2000\ants> go test -run=NoPool -v
=== RUN   TestNoPool
    ants_test.go:210: memory usage:789 MB
--- PASS: TestNoPool (5.04s)
PASS
ok      github.com/panjf2000/ants/v2    5.154s

PS D:\go-work\src\github.com\panjf2000\ants> go test -run=""AntsPool$"" -v
=== RUN   TestAntsPool
    ants_test.go:225: pool, capacity:2147483647
    ants_test.go:226: pool, running workers number:19360
    ants_test.go:227: pool, free workers number:2147464287
    ants_test.go:232: memory usage:184 MB
--- PASS: TestAntsPool (7.41s)
PASS
ok      github.com/panjf2000/ants/v2    7.528s
```

3.2 Using Benchmark
I first set the param to 1M tasks and 50k pool capacity,just like what you set in [README](https://github.com/panjf2000/ants#-benchmarks)
Here the performance is significantly higher than ""without pool""
```sh
Running tool: D:\GO\bin\go.exe test -benchmem -run=^$ -bench ^(BenchmarkGoroutines)$ github.com/panjf2000/ants/v2

goos: windows
goarch: amd64
pkg: github.com/panjf2000/ants/v2
cpu: Intel(R) Core(TM) i5-8250U CPU @ 1.60GHz
BenchmarkGoroutines-8   	       1	10773745800 ns/op	509732352 B/op	 1996637 allocs/op
PASS
ok  	github.com/panjf2000/ants/v2	11.616s

Running tool: D:\GO\bin\go.exe test -benchmem -run=^$ -bench ^(BenchmarkAntsPool)$ github.com/panjf2000/ants/v2

goos: windows
goarch: amd64
pkg: github.com/panjf2000/ants/v2
cpu: Intel(R) Core(TM) i5-8250U CPU @ 1.60GHz
BenchmarkAntsPool-8   	       2	 712292750 ns/op	21032456 B/op	 1063341 allocs/op
PASS
ok  	github.com/panjf2000/ants/v2	2.363s
```
It is weird for me to see the different result, given the src code is nearly the same.

4. Is it OK to use a [only sleep function](https://github.com/panjf2000/ants/blob/master/ants_benchmark_test.go#L39) acting as worker?
Maybe changing the demoFunc to a CPU-bound func like the following, or a related compromise.
```go
// func demoFunc() {
// 	time.Sleep(time.Duration(BenchParam) * time.Millisecond)
// }
func demoFunc() {
	begin := time.Now()
	i := 0
	for {
		i++
		end := time.Now()
		if end.UnixNano()-begin.UnixNano() > int64(time.Millisecond)*BenchParam {
			return
		}
	}
}
```

5. However, in this [issue](https://github.com/panjf2000/ants/issues/123), you admit that the performance isn't higher than the plain goroutine anymore. Please UPDATE THE README!

If I have any error,correct me plz. That's my pleasure to see such an awesome project in saving memory alloction, avoiding unlimited goroutine constructions.


",,,,49816514,wymli,7496278,panjf2000,142139,https://github.com/panjf2000/ants/issues/144,2021-06-29T15:33:58.000+08:00,2021-03-22T22:34:21.000+08:00,2021-06-29T15:33:58.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,170,
838523489,134018330,145,closed,åç¨‹æ€§èƒ½,"ç›®å‰æˆ‘ç”¨antsä½œä¸ºåç¨‹æ± å¤„ç†å¹¶å‘è¯·æ±‚, å‘ç°åç¨‹çš„å»¶è¿Ÿæœ‰80~100us,  å’Œæˆ‘ç›´æ¥ç”¨go funcçš„å»¶è¿Ÿå·®åˆ«ä¸å¤§. 
ç”±äºæˆ‘çš„è¯·æ±‚æœ¬èº«å»¶è¿Ÿå¤§æ¦‚500-600us, åç¨‹çš„å»¶è¿Ÿæ¯”è¾ƒå½±å“æ€§èƒ½
è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥æ”¹å–„çš„å—
",,,,75625523,cham-pin,7496278,panjf2000,87682,https://github.com/panjf2000/ants/issues/145,2021-05-23T14:50:35.000+08:00,2021-03-23T17:28:13.000+08:00,2021-05-23T14:50:35.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,171,
840918413,134018330,146,closed,æ‰€æœ‰ workers å‘ç”Ÿ panic å¯¼è‡´é‚£äº›æ­£åœ¨ç­‰å¾…å¯ç”¨ worker çš„è°ƒç”¨æ–¹é˜»å¡ä½,"**Describe the bug**
æç«¯æƒ…å†µä¸‹ï¼Œåç¨‹çš„æ‰§è¡Œé€Ÿåº¦ä¸º`ExpiryDuration`çš„æ—¶é•¿

**To Reproduce**
Steps to reproduce the behavior:
1. åˆ›å»ºä¸€ä¸ª`size`ä¸º1ï¼Œ`ExpiryDuration`ä¸º10sçš„åç¨‹æ± 
2. åˆ›å»ºä¸€ä¸ªæ¯æ¬¡å¿…panicçš„å‡½æ•°`panicFunc`
3. å‘åç¨‹æ± æ·»åŠ 5æ¬¡`panicFunc`ä»»åŠ¡ï¼Œå¹¶ä¸”åç»­ä¸ä¼šå†æ·»åŠ æ–°çš„ä»»åŠ¡
4. ç»“æœæ¯`10s`(ä¹Ÿå°±æ˜¯è®¾å®šçš„`ExpiryDuration`çš„æ—¶é•¿)æ‰ä¼šæ‰“å°ä¸€æ¬¡panicå †æ ˆ

ä»£ç å¦‚ä¸‹ï¼š
```go
package main

import (
	""fmt""
	""sync""
	""time""

	""github.com/panjf2000/ants/v2""
)

func main() {
	runTimes := 5
	var wg sync.WaitGroup
	pool, _ := ants.NewPool(1, ants.WithExpiryDuration(10 * time.Second))
	panicFunc := func() {
		time.Sleep(10 * time.Millisecond)
		wg.Done()
		panic(""test panic"")
	}
	for i := 0; i < runTimes; i++ {
		wg.Add(1)
		_ = pool.Submit(panicFunc)
	}
	wg.Wait()
	fmt.Printf(""running goroutines: %d\n"", pool.Running())
}

```
**Expected behavior**
5æ¬¡`panic`åº”è¯¥å †æ ˆå¾ˆå¿«å°±æ‰“å°å®Œ

**Error messages/Trace logs**
```cmd
2021/03/25 21:10:15 worker exits from a panic: test panic
2021/03/25 21:10:15 worker exits from panic: goroutine 8 [running]:
github.com/panjf2000/ants/v2.(*goWorker).run.func1.1(0xc000072180)
        /Users/admin/dev/ginlearn/ants/worker.go:58 +0x161
panic(0x10b2d60, 0x10f3fa0)
        /usr/local/opt/go@1.13/libexec/src/runtime/panic.go:679 +0x1b2
main.main.func1()
        /Users/admin/dev/ginlearn/ants/examples/test_panic/main.go:18 +0x67
github.com/panjf2000/ants/v2.(*goWorker).run.func1(0xc000072180)
        /Users/admin/dev/ginlearn/ants/worker.go:68 +0xa5
created by github.com/panjf2000/ants/v2.(*goWorker).run
        /Users/admin/dev/ginlearn/ants/worker.go:48 +0x4c

2021/03/25 21:10:25 worker exits from a panic: test panic
2021/03/25 21:10:25 worker exits from panic: goroutine 18 [running]:
github.com/panjf2000/ants/v2.(*goWorker).run.func1.1(0xc0000c8000)
        /Users/admin/dev/ginlearn/ants/worker.go:58 +0x161
panic(0x10b2d60, 0x10f3fa0)
        /usr/local/opt/go@1.13/libexec/src/runtime/panic.go:679 +0x1b2
main.main.func1()
        /Users/admin/dev/ginlearn/ants/examples/test_panic/main.go:18 +0x67
github.com/panjf2000/ants/v2.(*goWorker).run.func1(0xc0000c8000)
        /Users/admin/dev/ginlearn/ants/worker.go:68 +0xa5
created by github.com/panjf2000/ants/v2.(*goWorker).run
        /Users/admin/dev/ginlearn/ants/worker.go:48 +0x4c

2021/03/25 21:10:35 worker exits from a panic: test panic
2021/03/25 21:10:35 worker exits from panic: goroutine 33 [running]:
github.com/panjf2000/ants/v2.(*goWorker).run.func1.1(0xc0000e6000)
        /Users/admin/dev/ginlearn/ants/worker.go:58 +0x161
panic(0x10b2d60, 0x10f3fa0)
        /usr/local/opt/go@1.13/libexec/src/runtime/panic.go:679 +0x1b2
main.main.func1()
        /Users/admin/dev/ginlearn/ants/examples/test_panic/main.go:18 +0x67
github.com/panjf2000/ants/v2.(*goWorker).run.func1(0xc0000e6000)
        /Users/admin/dev/ginlearn/ants/worker.go:68 +0xa5
created by github.com/panjf2000/ants/v2.(*goWorker).run
        /Users/admin/dev/ginlearn/ants/worker.go:48 +0x4c

2021/03/25 21:10:45 worker exits from a panic: test panic
2021/03/25 21:10:45 worker exits from panic: goroutine 49 [running]:
github.com/panjf2000/ants/v2.(*goWorker).run.func1.1(0xc000072180)
        /Users/admin/dev/ginlearn/ants/worker.go:58 +0x161
panic(0x10b2d60, 0x10f3fa0)
        /usr/local/opt/go@1.13/libexec/src/runtime/panic.go:679 +0x1b2
main.main.func1()
        /Users/admin/dev/ginlearn/ants/examples/test_panic/main.go:18 +0x67
github.com/panjf2000/ants/v2.(*goWorker).run.func1(0xc000072180)
        /Users/admin/dev/ginlearn/ants/worker.go:68 +0xa5
created by github.com/panjf2000/ants/v2.(*goWorker).run
        /Users/admin/dev/ginlearn/ants/worker.go:48 +0x4c

2021/03/25 21:10:55 worker exits from a panic: test panic
2021/03/25 21:10:55 worker exits from panic: goroutine 51 [running]:
github.com/panjf2000/ants/v2.(*goWorker).run.func1.1(0xc0000e6000)
        /Users/admin/dev/ginlearn/ants/worker.go:58 +0x161
panic(0x10b2d60, 0x10f3fa0)
        /usr/local/opt/go@1.13/libexec/src/runtime/panic.go:679 +0x1b2
main.main.func1()
        /Users/admin/dev/ginlearn/ants/examples/test_panic/main.go:18 +0x67
github.com/panjf2000/ants/v2.(*goWorker).run.func1(0xc0000e6000)
        /Users/admin/dev/ginlearn/ants/worker.go:68 +0xa5
created by github.com/panjf2000/ants/v2.(*goWorker).run
        /Users/admin/dev/ginlearn/ants/worker.go:48 +0x4c

running goroutines: 0

```
**System info (please complete the following information):**
 - OS:  macOS 11.2.3
 - Go Version: go1.13.15 darwin/amd64
 - ants version: v2.4.3

**Additional context**
æ„Ÿè§‰è¿™ç§æƒ…å†µå¾ˆæç«¯ï¼Œç”Ÿäº§ç¯å¢ƒä¸­å‡ ä¹ä¸ä¼šå­˜åœ¨ï¼Œä¸çŸ¥æœ‰æ²¡æœ‰ä¿®å¤çš„å¿…è¦ã€‚",,,,38038921,shangxiaomi,7496278,panjf2000,4400,https://github.com/panjf2000/ants/issues/146,2021-03-28T22:38:11.000+08:00,2021-03-25T21:17:49.000+08:00,2021-03-28T22:39:24.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,172,
841138037,134018330,147,closed,Crash with bbolt db.Batch after running for some time,"long running program crash here

        putDB := func() {
                db.Batch(func(tx *bbolt.Tx) error {
                 

                
                })
        }


ants.Submit(putDB) <-- pseudocode




goroutine 1225 [chan receive]:
bbolt.(*DB).Batch(0xc0001a6800, 0xc000096200, 0xc0005d6a80, 0xc0007b37a8)





        /go/pkg/mod/github.com/panjf2000/ants/v2@v2.4.3/worker.go:68 +0x94
created by github.com/panjf2000/ants/v2.(*goWorker).run
        /go/pkg/mod/github.com/panjf2000/ants/v2@v2.4.3/worker.go:48 +0x4c

goroutine 1295 [chan receive]:
github.com/panjf2000/ants/v2.(*goWorker).run.func1(0xc0006230e0)
        /go/pkg/mod/github.com/panjf2000/ants/v2@v2.4.3/worker.go:64 +0x75
created by github.com/panjf2000/ants/v2.(*goWorker).run
        /go/pkg/mod/github.com/panjf2000/ants/v2@v2.4.3/worker.go:48 +0x4c

goroutine 1296 [chan receive]:
github.com/panjf2000/ants/v2.(*goWorker).run.func1(0xc000623110)
        /go/pkg/mod/github.com/panjf2000/ants/v2@v2.4.3/worker.go:64 +0x75
created by github.com/panjf2000/ants/v2.(*goWorker).run
        /go/pkg/mod/github.com/panjf2000/ants/v2@v2.4.3/worker.go:48 +0x4c

rax    0x0
rbx    0x7f578b4f9700
rcx    0x7f57c60ef18b
rdx    0x0
rdi    0x2
rsi    0x7f578b4f8a10
rbp    0x7f57c6264588
rsp    0x7f578b4f8a10
r8     0x0
r9     0x7f578b4f8a10
r10    0x8
r11    0x246
r12    0x7f57c62b35fa
r13    0x1a7
r14    0x7f57c62b3530
r15    0x2978710
rip    0x7f57c60ef18b
rflags 0x246
cs     0x33
fs     0x0
gs     0x0",,,,51492452,hiqsociety,7496278,panjf2000,4169,https://github.com/panjf2000/ants/issues/147,2021-03-28T22:40:00.000+08:00,2021-03-26T01:10:12.000+08:00,2021-03-28T22:40:00.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,173,
844010065,134018330,148,closed,A proper way of using `sync.Cond`,"Hello, there! I'd like to say this package shows great work!

According to the doc comments in [go pkg](https://golang.org/pkg/sync/#Cond), I doubt whether this is a proper way of using conditional variable, since I see no `p.cond.L.Lock()` before calling `p.cond.Wait()`. I haven't make any test, but won't be a problem there?

https://github.com/panjf2000/ants/blob/dbcb6a104f23b1a6a7521796b30515230353283e/pool.go#L244",,,,37577088,fangxlmr,0,,3,https://github.com/panjf2000/ants/issues/148,2021-03-30T10:51:39.000+08:00,2021-03-30T10:48:12.000+08:00,2021-03-30T10:56:23.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,174,
851256703,134018330,150,closed,Why delete tag v1.3.0?,"**What is your question about ants?**
Please describe your question meticulously.

Why delete tag v1.3.0?",,,,4394982,deliangyang,7496278,panjf2000,2895,https://github.com/panjf2000/ants/issues/150,2021-04-08T18:08:10.000+08:00,2021-04-06T17:52:27.000+08:00,2021-04-08T18:08:10.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,176,
857977427,134018330,151,closed,how do u pass value like goroutine?,"e.g.

for i:=0; i<10000; i++ {
go func(abc uint64) {

}(i)
}

how do u do the same with ants?",,,,51492452,hiqsociety,7496278,panjf2000,6,https://github.com/panjf2000/ants/issues/151,2021-04-14T22:57:13.000+08:00,2021-04-14T22:51:13.000+08:00,2021-04-14T22:57:13.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,177,
863400810,134018330,152,closed,Doubt about Pool.Free() / å…³äº Pool.Free() çš„ä¸€äº›ç–‘æƒ‘,"I need to know whether the goroutine pool is ""full""(blocked in `Pool.Submit()`), and I found this function `Pool.Free()`, but I'm really confused about its behavior. 
```
// Free returns the available goroutines to work.
func (p *Pool) Free() int {
	return p.Cap() - p.Running()
}
```
as you commented, it returns the avaliable goroutines, but when you created a pool with a size of -1, you will get a negative  number. So only when `Pool.Free()` returns exactly zero, can I know that the pool is ""full"", right?


æˆ‘æƒ³é€šè¿‡çŸ¥é“ goroutine æ± æ˜¯å¦å·²ç»æ»¡äº†ï¼ˆæäº¤ä»»åŠ¡ `Pool.Submit()` æ—¶é˜»å¡ï¼‰ï¼Œæˆ‘æ‰¾åˆ°äº†è¿™ä¸ªå‡½æ•° `Pool.Free()`ï¼Œä½†æˆ‘å¯¹å…¶è¡Œä¸ºæœ‰ä¸€äº›ç–‘é—®ã€‚
```
// Free returns the available goroutines to work.
func (p *Pool) Free() int {
	return p.Cap() - p.Running()
}
```
æ­£å¦‚ä½ æ‰€è¯„è®ºçš„ï¼Œå®ƒè¿”å›å¯ç”¨çš„goroutineï¼Œä½†æ˜¯å½“ä½ åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º -1 çš„æ± æ—¶ï¼Œä½ å°†å¾—åˆ°ä¸€ä¸ªè´Ÿæ•°ã€‚æ‰€ä»¥åªæœ‰å½“ `Pool.Free()` æ­£å¥½è¿”å› 0 æ—¶ï¼Œæˆ‘æ‰èƒ½çŸ¥é“æ± å·²æ»¡ï¼Œå¯¹å—ï¼Ÿ
",,,,34428640,ycydsxy,7496278,panjf2000,8482,https://github.com/panjf2000/ants/issues/152,2021-04-27T08:17:09.000+08:00,2021-04-21T10:55:09.000+08:00,2021-04-27T08:17:09.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,178,
864353725,134018330,153,closed,Nested ants function gives error for long running fast for loops?,"Getting error of 

2021/04/21 22:28:03 worker exits from a panic: runtime error: invalid memory address or nil pointer dereference
2021/04/21 22:28:03 worker exits from panic: goroutine 23634 [running]:
github.com/panjf2000/ants/v2.(*goWorker).run.func1.1(0xc004b7ae70)
        /go/pkg/mod/github.com/panjf2000/ants/v2@v2.4.4/worker.go:58 +0x17c
panic(0x68dc60, 0x9d0eb0)
        /usr/lib/go-1.16/src/runtime/panic.go:965 +0x1b9


if nested multi layer. is this a problem?",,,,51492452,hiqsociety,7496278,panjf2000,45140,https://github.com/panjf2000/ants/issues/153,2021-05-23T14:50:27.000+08:00,2021-04-22T06:29:50.000+08:00,2021-05-23T14:50:27.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,179,
869939645,134018330,154,closed,retrieveWorkeræ—¶å€™p.Running()è¾¹ç•Œé—®é¢˜,"```go
spawnWorker := func() {
		w = p.workerCache.Get().(*goWorker)
		w.run()
	}

	p.lock.Lock()

	w = p.workers.detach()
	if w != nil {
		p.lock.Unlock()
	} else if capacity := p.Cap(); capacity == -1 || capacity > p.Running() {
		p.lock.Unlock()
		spawnWorker()
```
p.Runningå–å‡ºååˆ¤æ–­å°äºcapacityï¼Œè§£é”ï¼Œå†å¢åŠ ä¸€ä¸ªworkerï¼Œæ˜¯å¦å­˜åœ¨è¾¹ç•Œé—®é¢˜ï¼Ÿ
åœ¨incrRunning()å‰ï¼Œæœ‰å…¶ä»–åç¨‹ä¹Ÿå–åˆ°äº†åŒæ ·çš„p.Running()ï¼Œæ˜¯å¦å­˜åœ¨æœ€ååç¨‹æ•°è¶…è¿‡capacity?
",,,,78064625,LinghuChongHaha,7496278,panjf2000,17244,https://github.com/panjf2000/ants/issues/154,2021-05-10T20:42:43.000+08:00,2021-04-28T21:18:29.000+08:00,2021-05-10T20:42:43.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,180,
890078421,134018330,155,closed,è€ƒè™‘å°†loopQueueçš„å®ç°æ›¿æ¢ä¸ºæ ˆ,æˆ‘åœ¨ä½¿ç”¨antçš„è¿‡ç¨‹å‘ç°ä¸€ä¸ªè¿™æ ·çš„caseï¼Œå½“qpså‡ºç°é™¡å¢æ—¶ï¼Œä¼šæ–°å¢å¾ˆå¤šworkeråˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œå½“æµé‡é™ä¸‹æ¥åï¼Œè¿™äº›workerå› ä¸ºè¿˜åœ¨å¾ªç¯å·¥ä½œï¼Œä¸”è¿‡æœŸæ—¶é—´è®¾ç½®åå¤§ï¼Œå¯¼è‡´workerçš„goroutineä¸€ç›´è¾¾ä¸åˆ°è¿‡æœŸæ¡ä»¶ï¼Œä¸èƒ½è¢«å›æ”¶ï¼Œæ­¤ågoroutineæ•°é‡ä¸€ç›´å¤„äºé«˜ä½ï¼Œåˆ©ç”¨ç‡ä¸‹é™ã€‚è¿™å›ºç„¶æœ‰è¿‡æœŸæ—¶é—´è®¾ç½®ä¸åˆç†çš„åŸå› ï¼Œä½†åœ¨è®¾è®¡ä¸Šä¹Ÿå­˜åœ¨ä¸€å®šç¼ºé™·ï¼Œå¦‚æœä½¿ç”¨æ ˆï¼Œworkerçš„detachå’Œinsertéƒ½åœ¨æ ˆé¡¶ï¼Œåˆ™èƒ½æ˜¾è‘—æé«˜å•ä¸ªgoroutineçš„åˆ©ç”¨ç‡ï¼Œæ ˆåº•ç”¨ä¸åˆ°çš„workerä¹Ÿèƒ½æ›´åŠæ—¶çš„è¢«å›æ”¶ï¼ŒretrieveExpiryå‡½æ•°ä»æ ˆåº•å¼€å§‹éå†ï¼ŒåŒæ ·æ»¡è¶³æ ˆåº•é¦–ä¸ªå…ƒç´ ä¸è¿‡æœŸï¼Œåˆ™æ•´ä¸ªæ ˆçš„å…ƒç´ ä¸è¿‡æœŸã€‚,,,,25758101,spadan,0,,9928,https://github.com/panjf2000/ants/issues/155,2021-05-19T18:42:32.000+08:00,2021-05-12T21:13:58.000+08:00,2021-05-19T18:42:32.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,181,
892678963,134018330,156,closed,retrieveExpiryä¸­expiryTimeé—®é¢˜,"ä¸ºä»€ä¹ˆæ˜¯expiryTime := time.Now().Add(-duration)ï¼Œè€Œä¸æ˜¯expiryTime := time.Now().Add(duration)ï¼Ÿ
æŒ‰ç…§ç°åœ¨çš„å®ç°ï¼ŒrevertWorkerè®¾ç½®worker.recycleTime = time.Now()ï¼Œé‚£ä¹ˆexpiryTimeè‚¯å®šå¤§äºworker.recycleTimeï¼Œå¯¼è‡´workerç”¨äº†ä¸€æ¬¡å¿…å®šè¢«å›æ”¶ã€‚å¼•å…¥expiryTimeä¸å°±æ˜¯ä¸ºäº†å¤šé‡å¤åˆ©ç”¨å‡ æ¬¡å—ï¼Ÿ æœ‰ç‚¹ä¸æ˜ç™½ï¼Œæœ›è§£ç­”",,,,30179199,chenbyby,7496278,panjf2000,4113,https://github.com/panjf2000/ants/issues/156,2021-05-19T18:42:01.000+08:00,2021-05-16T22:08:19.000+08:00,2021-05-19T18:42:01.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,182,
898973379,134018330,157,closed,æœŸæœ›æš´éœ²ä¸ª blockingNum çš„ç»Ÿè®¡æ•°é‡,"ç›®å‰æœ‰ï¼š
`p.Running()`
`p.Free()`
`p.Cap()`

åœ¨å¹¶ä¸æƒ³æ”¾å¼€å¹¶å‘æ•°çš„åœºæ™¯ä¸‹ï¼Œé«˜å³°æ—¶ï¼Œ
`p.Free()` å¯èƒ½è¾ƒé•¿æ—¶é—´ä¸º `0`ï¼Œ
æ­¤æ—¶å¾ˆå¸Œæœ›çŸ¥é“æ’é˜Ÿä»»åŠ¡é•¿åº¦ï¼Œå³ `blockingNum` æ•°é‡æˆ–å‰©ä½™æ’é˜Ÿæ•°é‡ `options.MaxBlockingTasks` - `blockingNum`ã€‚",,,,4979407,fufuok,7496278,panjf2000,502897,https://github.com/panjf2000/ants/issues/157,2022-05-07T22:45:12.000+08:00,2021-05-23T17:07:25.000+08:00,2022-05-07T22:45:12.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,183,
907118378,134018330,159,closed,å…³äºpanjf2000 / ants v2.0.0ç‰ˆæœ¬ä¿®å¤çš„é—®é¢˜,"ä½ å¥½ï¼Œæˆ‘åœ¨v2.0.0çœ‹åˆ°å¦‚ä¸‹æè¿°
![image](https://user-images.githubusercontent.com/53163548/120149656-9df6c480-c21c-11eb-8631-9128417da5a3.png)
ä½†æ˜¯å¯¹æ¯”v1.2.0å’Œv2.0.0çš„ä»£ç ï¼Œæˆ‘æ²¡çœ‹æ‡‚æ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œæˆ–è€…è¿™ä¸ªé—®é¢˜æ˜¯ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°ï¼Ÿ
å¯å¦ç»™æˆ‘è®²è§£ä¸€ä¸‹ï¼Ÿ
",,,,53163548,guoxinyu-shopee,7496278,panjf2000,5,https://github.com/panjf2000/ants/issues/159,2021-05-31T14:35:13.000+08:00,2021-05-31T14:29:42.000+08:00,2021-05-31T14:44:53.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,185,
907293042,134018330,163,open,å¶å‘æƒ…å†µä¸‹revertWorkerå†…time.Now()å ç”¨CPUè¾ƒé«˜,hiï¼Œä½ å¥½ï¼Œpprofæ€§èƒ½åˆ†ææ—¶ï¼Œ å¶å°”ä¼šå‡ºç°revertWorkerå†…time.Now()å ç”¨CPUè¾ƒé«˜çš„æƒ…å†µï¼Œæƒ³è¯·æ•™ä¸€ä¸‹ï¼Œå¦‚æœæŠŠè·å–å½“å‰æ—¶é—´æ¢æˆå¦ä¸€ç§æ€§èƒ½æ›´å¥½ä½†å¯èƒ½æœ‰è¯¯å·®ï¼ˆè¯¯å·®5msï¼‰çš„æ–¹æ³•ï¼Œä¼šå¯¹æ•´ä½“æœ‰è¾ƒå¤§å½±å“å—ï¼Ÿæˆ‘è‡ªå·±çš„ç†è§£ï¼Œé»˜è®¤1sè¿‡æœŸçš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æœ‰äº›workerçš„å›æ”¶æ—¶é—´å»¶è¿Ÿ1sï¼Œä½†æ˜¯ä¸å¤ªæ¸…æ¥šè¿™ä¸ªå¯¹antsæ•´ä½“çš„å½±å“,,,,22535169,chiselX,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/163,,2021-05-31T17:29:31.000+08:00,2021-05-31T23:06:00.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,186,
907817424,134018330,164,closed,ä½¿ç”¨sync.Mapï¼Œæœ‰æ—¶ä¼šå‘ç”Ÿfatal error: concurrent map writesçš„é—®é¢˜,ä½ å¥½ï¼Œæˆ‘è¿™è¾¹éœ€è¦ç”¨goroutineå¯¹å•ä¸ªmapè¿›è¡Œæ“ä½œï¼Œä¸ºäº†ä¸äº§ç”Ÿconcurrent map writesçš„é—®é¢˜ï¼Œä½¿ç”¨sync.Mapï¼Œä¸é€šè¿‡æ‚¨çš„æ¡†æ¶ï¼Œå•çº¯ä½¿ç”¨goroutineè²Œä¼¼æ˜¯OKçš„ï¼Œä½†æ˜¯ä½¿ç”¨äº†è¿™ä¸ªæ¡†æ¶ï¼Œæœ‰æ—¶å€™ä¼šæŠ¥fatal error: concurrent map writesè¿™ä¸ªé—®é¢˜,,,,7382698,usst830514,7496278,panjf2000,10,https://github.com/panjf2000/ants/issues/164,2021-06-01T10:52:29.000+08:00,2021-06-01T10:42:10.000+08:00,2021-06-01T10:52:29.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,187,
913065024,134018330,165,closed,TestNonblockingSubmitWithFunc éšæœºæˆåŠŸæˆ–å¤±è´¥,"**Describe the bug**
å½“è¿è¡ŒTestNonblockingSubmitWithFuncæ—¶ï¼Œå¶å°”æˆåŠŸï¼Œå¶å°”å¤±è´¥ï¼š
![image](https://user-images.githubusercontent.com/30179199/120957174-c3894e00-c787-11eb-9f08-e08af4afa86b.png)
å½“å¤šæ¬¡è¿è¡Œè¯¥æµ‹è¯•å‡½æ•°ï¼Œå‡ºç°å¦‚ä¸‹ç»“æœï¼š
![image](https://user-images.githubusercontent.com/30179199/120957214-dc91ff00-c787-11eb-84cf-5e4f15d91e5d.png)

**Error messages/Trace logs**
=== RUN   TestNonblockingSubmitWithFunc
    TestNonblockingSubmitWithFunc: ants_test.go:417: 
        	Error Trace:	ants_test.go:417
        	Error:      	An error is expected but got nil.
        	Test:       	TestNonblockingSubmitWithFunc
        	Messages:   	nonblocking submit when pool is full should get an ErrPoolOverload
--- FAIL: TestNonblockingSubmitWithFunc (0.00s)
FAIL

**System info (please complete the following information):**
 - OS: macOS,2.3 GHz å…«æ ¸Intel Core i9,16 GB 2667 MHz DDR4
 - Go Version: 1.14.4
 - ants version: latest

å½“p.Invoke(nil)æ”¹ä¸ºp.Invoke(Param)ï¼Œä¸ä¼šå‡ºç°è¯¥é—®é¢˜",,,,30179199,chenbyby,7496278,panjf2000,74128,https://github.com/panjf2000/ants/issues/165,2021-07-28T23:32:18.000+08:00,2021-06-07T12:03:24.000+08:00,2021-07-28T23:32:18.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,188,
918864340,134018330,166,closed,æœ€æ–°çš„åŸºå‡†æµ‹è¯•è·‘è¿‡äº†ä¹ˆï¼Œæ¯”ä¸è¿‡åŸç”Ÿçš„,"**What is your question about ants?**

BenchmarkAntsPool-12æ˜¯BenchmarkGoroutines-12çš„ä¸¤å€å¤šï¼Œæ˜¯æˆ‘çš„æœºå™¨ä¸å¯¹ä¹ˆï¼Ÿè¿˜æ˜¯åé¢ä»£ç å†™ç€å†™ç€å°±è·‘åäº†ï¼Ÿ

```sh
goos: darwin
goarch: amd64
pkg: github.com/panjf2000/ants/v2
cpu: Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz
BenchmarkGoroutines-12              	       3	 411810402 ns/op	80012933 B/op	 1000135 allocs/op
BenchmarkSemaphore-12               	       2	 637331376 ns/op	80197720 B/op	 1002060 allocs/op
BenchmarkAntsPool-12                	       1	1023957685 ns/op	20676048 B/op	 1063831 allocs/op
BenchmarkGoroutinesThroughput-12    	       3	 403223552 ns/op	82825797 B/op	 1008366 allocs/op
BenchmarkSemaphoreThroughput-12     	       2	 627645680 ns/op	80062776 B/op	 1000637 allocs/op
BenchmarkAntsPoolThroughput-12      	       2	 936248712 ns/op	 1887088 B/op	   29047 allocs/op
PASS
ok  	github.com/panjf2000/ants/v2	80.746s
```
",,,,1940588,bingoohuang,7496278,panjf2000,62,https://github.com/panjf2000/ants/issues/166,2021-06-12T00:05:34.000+08:00,2021-06-11T23:03:09.000+08:00,2021-06-18T17:59:51.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,189,
930705346,134018330,168,open,Announcement: please replace ants v1.2.0 with v1.2.1,"## Dear users of `ants`

This is a notice about an issue of `ants` in GO modules, the v1.2.0 has been re-tagged with a new commit, which causes the **checksum mismatch** with Go modules and you may encounter this problem sometime, see #49 for details.

To cut a long story short, the quick fix for this issue is to replace the version of v1.2.0 with v1.2.1 in your `go.mod`, then you'll be free from the tiresome **checksum mismatch** problem.

I'm sorry for the inconvenience caused to you.",,,,7496278,panjf2000,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/168,,2021-06-26T22:21:38.000+08:00,2021-06-26T22:21:38.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,191,
931106727,134018330,169,closed,Cancel all task when has any task return error,"**How to cancel all tasks when has any task return error?**
I have two pools: pool1 and pool2. The result of tasks on pool1 to send tasks for pool2. When having any task error, how to cancel all tasks running in pool1 and pool2?
",,,,38505126,ducpx,7496278,panjf2000,11887,https://github.com/panjf2000/ants/issues/169,2021-07-06T16:41:36.000+08:00,2021-06-28T10:33:47.000+08:00,2021-07-06T16:41:36.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,192,
932236472,134018330,170,closed,purgePeriodically  for cycle do nothingï¼Ÿ,"**What is your question about ants?**
https://github.com/panjf2000/ants/blob/master/pool_func.go#L81
why do nothingï¼Ÿ
Do you need to add this line of code ï¼Ÿ
expiredWorkers = append(expiredWorkers, idleWorkers[i])
",,,,49196656,leeliliang,7496278,panjf2000,8,https://github.com/panjf2000/ants/issues/170,2021-06-29T13:56:24.000+08:00,2021-06-29T13:47:51.000+08:00,2021-06-29T13:56:25.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,193,
938708991,134018330,171,closed,å…³äºantsä½¿ç”¨åœºæ™¯çš„ç–‘é—®,é’ˆå¯¹å¤§è§„æ¨¡é•¿è¿æ¥ï¼ˆåˆ©ç”¨å¿ƒè·³æœºåˆ¶ï¼Œå‡ ä¹ä¸æ–­ï¼‰ï¼Œä½¿ç”¨antsæ˜¯å¦èƒ½å¸¦æ¥æ€§èƒ½æå‡å‘¢ï¼Ÿ,,,,33331974,DMwangnima,7496278,panjf2000,940,https://github.com/panjf2000/ants/issues/171,2021-07-08T09:34:38.000+08:00,2021-07-07T17:54:18.000+08:00,2021-07-08T09:34:38.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,194,
946771746,134018330,173,closed,å¯¹äº retrieveWorker æ–¹æ³•ä¸­é˜»å¡é˜Ÿåˆ—çš„ç–‘æƒ‘,"æ‚¨å¥½ï¼Œæˆ‘æ¯”è¾ƒç–‘æƒ‘ pool.go é‡Œ retrieveWorker æ–¹æ³•ä¸­çš„è¿™æ®µä»£ç ï¼Œè¿™é‡Œç”±äºåŠ äº†é” p.lock.Lock()ï¼Œè€Œä¸”åªæœ‰åœ¨ p.cond.Wait() ä¹‹åæ‰ä¼šè§£é”ï¼Œæ‰€ä»¥åº”è¯¥æ°¸è¿œåªæœ‰ä¸€ä¸ªgoroutineåœ¨ Wait() ä¸­é˜»å¡ç­‰å¾…ï¼Œè€Œå…¶ä»–goroutineéƒ½è¢«æŒ¡åœ¨äº† p.lock.Lock() å¤–é¢ç­‰å¾…è§£é”ã€‚é‚£ä¹ˆè¿™æ ·çš„è¯ï¼Œæˆ‘æ„Ÿè§‰ä»»åŠ¡æäº¤çš„é˜»å¡é˜Ÿåˆ—å°±å¤±å»äº†æ„ä¹‰ï¼Œå¯¹ p.blockingNum çš„è®¡æ•°ä¹Ÿæ²¡æœ‰æ„ä¹‰äº†ã€‚ä¸çŸ¥é“æˆ‘çš„æƒ³æ³•æ˜¯å¦æ­£ç¡®ã€‚
`
	p.lock.Lock()

	w = p.workers.detach()
	if w != nil { // first try to fetch the worker from the queue
		p.lock.Unlock()
	} else if capacity := p.Cap(); capacity == -1 || capacity > p.Running() {
		// if the worker queue is empty and we don't run out of the pool capacity,
		// then just spawn a new worker goroutine.
		p.lock.Unlock()
		spawnWorker()
	} else { // otherwise, we'll have to keep them blocked and wait for at least one worker to be put back into pool.
		if p.options.Nonblocking {
			p.lock.Unlock()
			return
		}
	retry:
		if p.options.MaxBlockingTasks != 0 && p.blockingNum >= p.options.MaxBlockingTasks {
			p.lock.Unlock()
			return
		}
		p.blockingNum++
		p.cond.Wait() // block and wait for an available worker
		p.blockingNum--
		var nw int
		if nw = p.Running(); nw == 0 { // awakened by the scavenger
			p.lock.Unlock()
			if !p.IsClosed() {
				spawnWorker()
			}
			return
		}
		if w = p.workers.detach(); w == nil {
			if nw < capacity {
				p.lock.Unlock()
				spawnWorker()
				return
			}
			goto retry
		}

		p.lock.Unlock()
`",,,,34757591,isAlbertYu,7496278,panjf2000,123,https://github.com/panjf2000/ants/issues/173,2021-07-17T18:55:18.000+08:00,2021-07-17T16:52:14.000+08:00,2021-07-30T10:30:06.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,196,
951582378,134018330,175,open,doing so to call invoke does a lot of memory allocations.,"doing so to call invoke does a lot of memory allocations.

possible to replace {}Interface with [][]byte or something similar?
coz the allocation generated by using panjf is rather unbearable in high use case.

                var val [][]byte
                val = append(val,[]byte{0})
                val = append(val,[]byte{uint8(k)})
                val = append(val,[]byte{uint8(v)})
                val = append(val,[]byte{uint8(c)})
                val = append(val,kX) 
                val = append(val,b)
                pdbrpool.Invoke(&val)
",,,,87639173,superdolt,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/175,,2021-07-23T21:29:37.000+08:00,2021-07-24T19:15:17.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,198,
953856676,134018330,177,closed,"func with lots of mutex lock and unlock, when heavily called, will eat up linux threads","func with lots of mutex lock and unlock, when heavily called, will eat up linux threads and crash.

though i increased the debug.set max threads with runtime/debug, can this be resolved? 

threads doesnt seem to be released / free up too.",,,,51492452,hiqsociety,7496278,panjf2000,20,https://github.com/panjf2000/ants/issues/177,2021-07-27T21:19:36.000+08:00,2021-07-27T20:58:53.000+08:00,2021-07-27T21:20:15.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,200,
953963592,134018330,178,closed,"try heavily overload panjf with lots of locks and unlock, then u can see lock slow, semaphore issues and crash","try heavily overload panjf with lots of locks and unlock, then u can see lock slow, semaphore issues and crash

goroutine 6 [chan receive]:
github.com/panjf2000/ants/v2.(*Pool).purgePeriodically(0xc000112460)
        /root/go/pkg/mod/github.com/panjf2000/ants/v2@v2.4.6/pool.go:69 +0x109
created by github.com/panjf2000/ants/v2.NewPool
        /root/go/pkg/mod/github.com/panjf2000/ants/v2@v2.4.6/pool.go:137 +0x232

goroutine 7 [chan receive]:
github.com/panjf2000/ants/v2.(*Pool).purgePeriodically(0xc0001124d0)
        /root/go/pkg/mod/github.com/panjf2000/ants/v2@v2.4.6/pool.go:69 +0x109
created by github.com/panjf2000/ants/v2.NewPool
        /root/go/pkg/mod/github.com/panjf2000/ants/v2@v2.4.6/pool.go:137 +0x232

goroutine 21 [runnable]:
sync.runtime_SemacquireMutex(0x15f56f4, 0x0, 0x1)
        /usr/local/go/src/runtime/sema.go:71 +0x47
sync.(*Mutex).lockSlow(0x15f56f0)
        /usr/local/go/src/sync/mutex.go:138 +0x105
sync.(*Mutex).Lock(...)
        /usr/local/go/src/sync/mutex.go:81
",,,,51492452,hiqsociety,7496278,panjf2000,340551,https://github.com/panjf2000/ants/issues/178,2022-03-21T10:39:49.000+08:00,2021-07-27T22:48:30.000+08:00,2022-03-21T10:39:49.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,201,
959089879,134018330,179,closed,æ˜¯å¦å¯ä»¥é™åˆ¶å•ä¸€goroutineçš„æ‰§è¡Œæ—¶é—´,"è¯·é—®å…³äºantsï¼Œæ˜¯å¦æœ‰æ¥å£å¯ä»¥é™åˆ¶å•ä¸€goroutineæ‰§è¡Œæ—¶é—´çš„ï¼Œæ¯”å¦‚æˆ‘ä¸€æ¬¡æ€§ä¸‹å‘20000ä¸ªä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘æ± å­å¼€äº†100ä¸ªï¼Œé‚£å¦‚æœæ‰€æœ‰çš„éƒ½é˜»å¡äº†ï¼Œæ˜¯å¦å¯ä»¥è®¾ç½®å•ä¸€goroutineåœ¨é˜»å¡20sä»¥åè‡ªåŠ¨ç»“æŸå½“å‰ä»»åŠ¡ï¼Œæ¥æ”¶æ–°çš„ä»»åŠ¡ï¼Ÿ
",,,,17517153,Alberthchang,7496278,panjf2000,6655,https://github.com/panjf2000/ants/issues/179,2021-08-08T11:53:20.000+08:00,2021-08-03T20:57:43.000+08:00,2021-08-08T11:53:20.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,202,
971116711,134018330,180,closed,åœ¨åç¨‹é‡Œé¢‘ç¹åˆ›å»ºåç¨‹æ± æœ‰å¼‚å¸¸ï¼Œè²Œä¼¼æœ‰åç¨‹æ³„éœ²çš„é—®é¢˜,"![image](https://user-images.githubusercontent.com/19659483/129477453-879a175b-fe83-4ef1-966a-1d5e58a9be2b.png)
è¿™è¾¹çš„doæ–¹æ³•ï¼Œ å¤–å±‚å¯ä»¥ç†è§£æ˜¯ä¸ªforå¾ªç¯ï¼Œ ä¼šä¸€ç›´æ‰§è¡Œï¼Œ æ¯æ¬¡æ‰§è¡Œåˆ°setCardTimeçš„æ—¶å€™ï¼Œ éƒ½ä¼šæ‰§è¡Œå¦‚ä¸‹
![image](https://user-images.githubusercontent.com/19659483/129477515-663f0e4e-a9be-4c6e-9167-80a79c0240a7.png)
ç»è¿‡åå¤æµ‹è¯•ï¼Œ å°±æ˜¯è¿™ä¸ªå‡½æ•°ï¼Œ å¦‚æœæŠŠå®ƒæ³¨é‡Šæ‰ï¼Œ åç¨‹æ•°é‡å’Œå†…å­˜éƒ½æ­£å¸¸ï¼Œä¸ä¼šé£™å‡ï¼Œ ä¸€æ‰“å¼€å°±å¼‚å¸¸ 

w.dataCenter.CarListæ˜¯ä¸ªlistæ•°ç»„ï¼Œ æœ¬æ¬¡æµ‹è¯•å¤§æ¦‚æ˜¯1kæ•°é‡
goç‰ˆæœ¬1.15
antsç‰ˆæœ¬1.3

æˆ‘æŠŠå›¾ç‰‡ä¸­çš„åç¨‹æ± æ–¹æ³•å•ç‹¬æ‹¿å‡ºæ¥
![image](https://user-images.githubusercontent.com/19659483/129477621-800ddab2-b292-441a-9360-4d7aef6aa0cc.png)
ç„¶åè°ƒç”¨çš„æ—¶å€™
![image](https://user-images.githubusercontent.com/19659483/129477630-0c4232d1-c4c8-415d-bd46-fcfa514c87b9.png)
å°±ä¸€åˆ‡æ­£å¸¸ï¼Œåç¨‹å’Œå†…å­˜éƒ½å¾ˆç¨³å®šï¼Œ ä¸çŸ¥é“è¿™æ˜¯å¦æ˜¯ä¸ªbugï¼Œ ä½†æ˜¯æˆ‘è¿™è¾¹è‚¯å®šæ˜¯æœ‰è¿™ä¸ªé—®é¢˜ï¼Œè¿™æ˜¯çº¿ä¸Šé—®é¢˜ï¼Œ å®šä½ä¸€å¤©äº†æ‰å®šä½åˆ°è¿™ä¸ª
![image](https://user-images.githubusercontent.com/19659483/129477738-b167ff68-2d94-48b1-a9b3-59aa4b76d632.png)
è¿™æ˜¯æˆ‘ä»¬çº¿ä¸Šçš„å†…å­˜ç›‘æ§ï¼Œ æ¯›åˆºéƒ½æ˜¯æœ‰é—®é¢˜çš„ç‰ˆæœ¬ï¼Œ pprofç›‘æ§ä¹Ÿæ˜¯ï¼Œ æœ€ä½åç¨‹æ•°éƒ½åœ¨ç¼“æ…¢å¢é•¿

![image](https://user-images.githubusercontent.com/19659483/129477761-9e47d668-346d-4868-b0de-af607aa386e8.png)

ç„¶åä¸Šé¢è¿™ä¸ªå›¾ï¼Œ æ˜¯æˆ‘æ”¹åŠ¨ä¹‹åçš„å†…å­˜æ­£å¸¸æƒ…å†µ",,,,19659483,ohmygd,7496278,panjf2000,149601,https://github.com/panjf2000/ants/issues/180,2021-11-27T17:17:03.000+08:00,2021-08-15T19:55:35.000+08:00,2021-11-27T17:17:03.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,203,
971511276,134018330,181,closed,ä¸å¤ªæ˜ç™½maxBlockingTasksçš„ä½œç”¨,"retrieveWorker å‡½æ•°é‡Œé¢æœ‰ä¸‹é¢è¿™æ®µä»£ç ï¼š
if p.maxBlockingTasks != 0 && p.blockingNum >= p.maxBlockingTasks { 
	p.lock.Unlock()
	return nil
}
p.blockingNum++
p.cond.Wait()
p.blockingNum--

è¿™é‡Œé¢æˆ‘çš„ç†è§£æ˜¯p.blockingNumåº”è¯¥ä¸ä¼šè¶…è¿‡2å§ï¼Œå› ä¸ºretrieveWorker é‡Œé¢æœ‰p.lock.Lock()åŠ é”ï¼ŒåŒä¸€æ—¶åˆ»p.blockingNumä¸ä¼šæœ‰å¹¶å‘æ“ä½œï¼Œå½“p.cond.Wait()è¿™é‡Œè¢«å”¤é†’åï¼Œåˆæ‰§è¡Œäº†p.blockingNum-- æ“ä½œï¼Œä¸€åŠ ä¸€å‡ï¼Œæœ€åp.blockingNumåˆå›å½’ä¸º0ï¼Œæ‰€ä»¥ä¸å¤ªæ˜ç™½maxBlockingTasksçš„å®ç°æ˜¯ä¸æ˜¯æœ‰è¾¾åˆ°ä½œè€…æœ¬æ„ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯æˆ‘çš„åˆ†ææœ‰è¯¯ï¼Œè¿˜æœ›æ½˜å¸…æœ‰ç©ºå¸®å¿™è§£ç­”ä¸€ç•ªï¼Œè°¢è°¢ï¼
",,,,10394162,jackerlu,7496278,panjf2000,57,https://github.com/panjf2000/ants/issues/181,2021-08-16T17:49:22.000+08:00,2021-08-16T16:51:30.000+08:00,2021-08-16T17:50:14.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,204,
984782442,134018330,182,closed,é™åˆ¶æ¯ç§’é’Ÿæœ€å¤§æ‰§è¡Œæ•°é‡,"**Is your feature request related to a problem? Please describe.**
I want use this lib to request a list of URL (restapi). But it limit request speed. If I didn't comply, It will throw a error.
æˆ‘æƒ³è¦è¯·æ±‚ä¸€ä¸ªURLåˆ—è¡¨ï¼ˆä»–ä»¬éƒ½æ˜¯restapiï¼‰ï¼Œä½†æ˜¯æ¥å£æ˜¯æœ‰é™é€Ÿçš„ï¼Œè¶…è¿‡é™é€Ÿæ¥å£å°±ä¼šè¿”å›é”™è¯¯ã€‚

**Describe the solution you'd like**
So I want a speedLimit option to limit go routine run  number every second.
Maybe use channel and time.ticker to support it.
æ‰€ä»¥æˆ‘å¸Œæœ›æœ‰ä¸€ä¸ªæ¯ç§’æœ€å¤§taskè¿è¡Œæ•°æˆ–è€…æœ€å°è¿è¡Œæ—¶é—´çš„å‚æ•°ï¼Œåº”è¯¥å¯ä»¥é€šè¿‡ä½¿ç”¨channelæˆ–time.tickeræ¥å®ç°ã€‚

**Describe alternatives you've considered**
If this lib cannot support it, Maybe I'll add a time.ticker channel reciever at the head of worker function.
å¦‚æœåº“æ— æ³•æä¾›è¿™ä¸ªå‚æ•°æˆ–è€…ä¸åº”è¯¥æä¾›æ­¤å‚æ•°çš„è¯ï¼Œé‚£ä¹ˆæˆ‘åº”è¯¥ä¼šåœ¨workerå‡½æ•°çš„å¼€å¤´å¢åŠ ä¸Štime.ticker chennelçš„æ¥æ”¶å™¨æ¥å®Œæˆé™åˆ¶
",,,,3294100,likyh,7496278,panjf2000,4514,https://github.com/panjf2000/ants/issues/182,2021-09-04T18:21:31.000+08:00,2021-09-01T15:06:47.000+08:00,2021-09-04T18:21:31.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,205,
987520012,134018330,183,closed,æä¾›éé˜»å¡çš„ Submit() æ–¹æ³•,"**Is your feature request related to a problem? Please describe.**
A clear and concise description of what the problem is. Ex. I'm always frustrated when [...]

**Describe the solution you'd like**
æœŸæœ›poolæœ‰ä¸ªæäº¤ä»»åŠ¡çš„æ–¹æ³•ï¼Œè¯¥æäº¤ä»»åŠ¡æ–¹æ³•æ˜¯éé˜»å¡çš„ï¼Œè€Œä¸”ä»»åŠ¡æ°¸ä¹…ä¸ä¼šè¢«ä¸¢å¼ƒï¼Œå½“è¶…è¿‡äº†capacityåï¼Œpoolå†…éƒ¨ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—æˆ–è€…æ•°ç»„å­˜å‚¨è¯¥ä»»åŠ¡ã€‚

**Describe alternatives you've considered**
A clear and concise description of any alternative solutions or features you've considered.

**Additional context**
Add any other context or screenshots about the feature request here.
",,,,7950702,liracle,7496278,panjf2000,92,https://github.com/panjf2000/ants/issues/183,2021-09-03T17:37:41.000+08:00,2021-09-03T16:05:01.000+08:00,2021-09-03T23:18:52.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,206,
1022229785,134018330,187,closed,.,ã€‚,,,,23187595,zt102545,7496278,panjf2000,13,https://github.com/panjf2000/ants/issues/187,2021-10-11T12:14:26.000+08:00,2021-10-11T12:01:01.000+08:00,2021-10-11T12:21:40.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,210,
1024790716,134018330,188,closed,"Shopify,Inc is using this project on production, maybe we ad a logo on user case.",,,,,3814966,lilien1010,7496278,panjf2000,514,https://github.com/panjf2000/ants/issues/188,2021-10-13T21:42:42.000+08:00,2021-10-13T13:07:52.000+08:00,2021-10-13T21:42:42.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,211,
1025263959,134018330,190,open,Pause API is needed in some scenario,"in our case, we need a `pool.Pause()` to  pause all jobs, and  use `pool.Resume()` to restart the jobs.",,,,3814966,lilien1010,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/190,,2021-10-13T21:37:28.000+08:00,2022-03-23T06:43:23.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,213,
1028877423,134018330,191,closed,è‡ªæ—‹é”çš„æ€§èƒ½å¯¹æ¯”æµ‹è¯•,"![1634552555(1)](https://user-images.githubusercontent.com/22676124/137714133-c424b7b5-de1a-41af-bc1d-ee633edba695.png)



æµ‹è¯•æ¡ˆä¾‹ä»£ç  
https://github.com/liu-song/ants/blob/master/internal/spinlock_test.go
 ",,,,22676124,liu-song,7496278,panjf2000,57847,https://github.com/panjf2000/ants/issues/191,2021-11-27T21:45:03.000+08:00,2021-10-18T17:37:35.000+08:00,2021-11-27T21:45:03.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,214,
1047896477,134018330,194,open,How do I call database insert operation using ants,"I have a for loop, which inserts data into the 2 different tables. How can I use ants in this case.

```go

for _, row := range rows {
 user := User{}
 user.Name = row.Name
 user.Email = row.Email
 err := dm.Insert(&user)
 if err != nil {
  panic(err)
 }
 address := Address{}
 address.Address1 = row.Address1
 address.Address2 = row.Address2
 address.PinCode = row.PinCode
 address.City = row.City
 err := dm.Insert(&address)
 if err != nil {
  panic(err)
 }
}
```
",,,,16970687,kiranupadhyak,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/194,,2021-11-09T04:38:11.000+08:00,2022-03-10T15:27:10.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,217,
1054484973,134018330,195,closed,pool should be Independence,"every goWork have Pool referenceï¼Œit is very hard to understand.
maybe have a struct map will better 
thx ",,,,45867365,venusDo,7496278,panjf2000,1858,https://github.com/panjf2000/ants/issues/195,2021-11-17T21:07:32.000+08:00,2021-11-16T14:08:34.000+08:00,2021-11-17T21:07:32.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,218,
1058613251,134018330,196,closed,é¢‘ç¹é€šè¿‡pool.Tuneæ–¹æ³•æ¥å®ç°åŠ¨æ€å¢åŠ /å‡å°‘åç¨‹çš„æ•°é‡,"å¤§æ¦‚çš„ä»£ç é€»è¾‘ï¼Œåœ¨ä¸€ä¸ªå®šæ—¶å™¨å†…è¿›è¡Œäº†é€šé“ä»»åŠ¡çš„æ•°é‡çš„ç»Ÿè®¡ï¼Œé€šè¿‡è¿™ä¸ªé€šé“çš„ä»»åŠ¡æ•°é‡åœ¨ä¸€å®šçš„æ—¶é—´ï¼Œæ¥é€šè¿‡pool.Tuneæ–¹æ³•è°ƒæ•´åç¨‹æ± çš„æ•°é‡ï¼Œ ä½†æ˜¯ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œé€šè¿‡poll.*é‡Œé¢æä¾›çš„æ–¹æ³•å»ç»Ÿè®¡å½“å‰æœ‰ï¼Œå¤šå°‘åç¨‹å’Œç©ºé—²åç¨‹ï¼Œä¼šå‡ºç°ä¸€å®šçš„è´Ÿæ•°ï¼Œ

pool.Tune(100)//é€šé“ä»»åŠ¡æœ‰200ä¸ªï¼Œå¼€å¯100ä¸ªåç¨‹å¤„ç†

pool.Tune(500)//é€šé“ä»»åŠ¡å¤§äº1000ä¸ªï¼Œè°ƒæ•´åç¨‹æ•°é‡ä¸º500

pool.Tune(10)// é€šé“ä»»åŠ¡å°äº100ï¼Œå°±æŠŠä»»åŠ¡è°ƒæ•´ä¸º10åç¨‹
ä»¥æ­¤ç±»æ¨æ¥å®ç° åç¨‹çš„åŠ¨æ€è°ƒæ•´ï¼Œ
å‡å¦‚ç›´æ¥ä»500ä¸‹è°ƒåˆ°10 ä¼šæœ‰ä»€ä¹ˆä¸å¯ä»¥é¢„ä¼°çš„é—®é¢˜å—ï¼Ÿ
ï¼ˆåç»­è´´ä»£ç ï¼‰",,,,19727273,longrbl,7496278,panjf2000,11186,https://github.com/panjf2000/ants/issues/196,2021-11-27T17:17:15.000+08:00,2021-11-19T22:50:48.000+08:00,2021-11-27T17:17:15.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,219,
1060770678,134018330,197,closed,åœ¨ä¼ ç»™Submitçš„taskå‡½æ•°ä¸­è°ƒç”¨Submitå¯èƒ½å¯¼è‡´block,"**Describe the bug**

åœ¨ä¼ ç»™Submitçš„taskå‡½æ•°ä¸­è°ƒç”¨Submitå¯èƒ½å¯¼è‡´block

ä¸‹é¢æ˜¯ä¸€æ®µç¤ºä¾‹ä»£ç ï¼š

```
package main

import (
	""fmt""
	""time""

	""github.com/panjf2000/ants/v2""
)

func main() {

	p, _ := ants.NewPool(100)

	for {
		p.Submit(func() {
			for i := 0; i < 3; i++ {
				p.Submit(func() {
					fmt.Println(time.Now().Unix())
				})
			}
		})
	}
}
```

åœ¨ubuntu 20.04 amd64å¹³å°ï¼Œä½¿ç”¨go 1.17ç‰ˆæœ¬è¿è¡Œä¸Šè¿°ç¨‹åºï¼Œä¼šå¯¼è‡´ç¨‹åºé”ä½ã€‚

**To Reproduce**

åœ¨linuxä¸Šè¿è¡Œä¸Šè¿°ç¨‹åºã€‚

**Expected behavior**

æ²¡æœ‰é”ä½ï¼Œä¸€ç›´æ‰§è¡Œä¸‹å»ã€‚

**Error messages/Trace logs**



**System info (please complete the following information):**
 - OS: linux
 - Go Version: 1.17
 - ants version: 2.4.6

**Additional context**

æˆ‘ä¸ç¡®è®¤åœ¨Submitæäº¤çš„taskå‡½æ•°ä¸­å†æ¬¡è°ƒç”¨Submitæ˜¯å¦æ˜¯okçš„ï¼Ÿæ‰¾äº†antsæ–‡æ¡£ï¼Œæ²¡çœ‹åˆ°å†™ä¸å…è®¸åœ¨Submitä¸­è°ƒç”¨Submitã€‚

å¦å¤–åˆæ­¥åˆ†æäº†ä¸€ä¸‹ï¼ŒSubmitçš„taskä¼šè¢«åˆ†é…ç»™poolä¸­çš„workerã€‚å¦‚æœæŸä¸ªworker1æ‰§è¡Œtask1ï¼Œè€Œtask1åˆè°ƒç”¨Submit task2ï¼Œä½†task2æ°å¥½åˆè¢«åˆ†ç»™worker1ï¼Œè¿™æ ·å°±é”ä½äº†ã€‚åŸºäºè¿™ä¸ªåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å¤ç°ï¼š

```
package main

import (
	""fmt""
	""time""

	""github.com/panjf2000/ants/v2""
)

func main() {
	p, _ := ants.NewPool(1)

	err := p.Submit(func() {
		fmt.Println(""func in first submit..."")
		err := p.Submit(func() {
			fmt.Println(""submit in submit ..."")
			fmt.Println(time.Now().Unix())
			fmt.Println(""submit in submit ok"")
		})

		if err != nil {
			fmt.Println(""func in first submit err:"", err)
			return
		}
		fmt.Println(""func in first submit ok"")
	})

	if err != nil {
		fmt.Println(""first submit error:"", err)
	}

	time.Sleep(5 * time.Second)
}
```

æˆ‘ä»¬ä»…åœ¨poolä¸­æ”¾ç½®ä¸€ä¸ªworkerã€‚è¿™æ ·å°±ä¼šå¯¼è‡´blockã€‚

",,,,419088,bigwhite,7496278,panjf2000,821,https://github.com/panjf2000/ants/issues/197,2021-11-23T23:57:13.000+08:00,2021-11-23T10:15:39.000+08:00,2021-11-29T16:12:19.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,220,
1074045507,134018330,199,open,worker with func exits from a panic: sync: negative WaitGroup counter,"**What is your question about ants?**
Please describe your question meticulously.
![image](https://user-images.githubusercontent.com/27792650/145157017-30598557-3105-4558-905e-d7fd11e73fb8.png)

### **ERROR**

![image](https://user-images.githubusercontent.com/27792650/145156779-48c197a9-4dc8-4ea2-84db-35c03efe1990.png)




CentOS6.9 x64      go version go1.17.3 linux/amd64

",,,,27792650,WyntersN,7496278,panjf2000,0,https://github.com/panjf2000/ants/issues/199,,2021-12-08T14:05:37.000+08:00,2021-12-19T16:13:55.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,222,
1074084207,134018330,200,closed,è¯·é—®ä½¿ç”¨é»˜è®¤ AntsPool éœ€è¦æ‰‹åŠ¨é‡Šæ”¾èµ„æºå—ï¼Ÿ,"hiï¼Œæˆ‘åˆšä¸Šæ‰‹è¿™ä¸ªç»„ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ–°æ‰‹çš„é—®é¢˜ã€‚

åœ¨æˆ‘ä½¿ç”¨ ants.Submit(func() {}) è¿›è¡Œå·¥ä½œæ—¶ï¼Œæœªæ‰‹åŠ¨åˆå§‹åŒ–ä¸€ä¸ª poolï¼Œants ä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤æ± ã€‚

åœ¨æˆ‘ä¸éœ€è¦é‡ç½®èµ„æºçš„æƒ…å†µä¸‹ï¼Œæˆ‘æ˜¯å¦ä¸ç”¨å»è€ƒè™‘è°ƒç”¨ pool.Release() é‡Šæ”¾èµ„æºå‘¢ï¼Ÿæˆ–è€…è¯´åœ¨ä»€ä¹ˆæƒ…å†µä¸‹æˆ‘éœ€è¦é‡Šæ”¾ pool ï¼Ÿæˆ–è®¸æ˜¯åœ¨é¡¹ç›®é‡æ–°éƒ¨ç½²æ—¶ï¼Ÿ
",,,,62499904,guowei-gong,7496278,panjf2000,216466,https://github.com/panjf2000/ants/issues/200,2022-05-07T22:57:13.000+08:00,2021-12-08T15:10:39.000+08:00,2022-05-07T22:57:13.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,223,
1076267066,134018330,201,closed,ä½ å¥½ï¼Œè¯·é—®å¯ä»¥å¼€ä¸ªå¾ªç¯å¤„ç†é˜Ÿåˆ—ä¸€ç›´ä¸å…³é—­å—ï¼Ÿä¼šä¸ä¼šå ç”¨å¾ˆé«˜å†…å­˜æˆ–è€…cpu,"**What is your question about ants?**

å¯ä»¥å¼€ä¸ªå¾ªç¯å¤„ç†é˜Ÿåˆ—ä¸€ç›´ä¸å…³é—­å—ï¼Ÿä¼šä¸ä¼šå ç”¨å¾ˆé«˜å†…å­˜æˆ–è€…cpu

Please describe your question meticulously.

ä¼ªä»£ç ï¼š

```
p, _ := ants.NewPoolWithFunc(pos, taskFunc, ants.WithNonblocking(true))
defer p.Release()
for {
...
value, ok := q.Get()
p.Invoke(value)
...
}
```
è°¢è°¢",,,,43238749,shikingram,7496278,panjf2000,2096,https://github.com/panjf2000/ants/issues/201,2021-12-11T20:09:21.000+08:00,2021-12-10T09:12:49.000+08:00,2021-12-11T20:09:21.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,224,
1078047238,134018330,202,closed,å…³é—­Poolæ—¶å‡ºç°å¼‚å¸¸è¡Œä¸º,"æƒ…æ™¯ï¼šä¸¤ä¸ªgoroutineåœ¨æ¨¡æ‹Ÿç”Ÿäº§è€…å‘Poolå‘é€ä»»åŠ¡ï¼Œä»»åŠ¡éœ€è¦æ‰§è¡Œä¸€å®šæ—¶é—´ï¼Œä¸€æ®µæ—¶é—´åéœ€è¦å…³é—­æœåŠ¡ç«¯ï¼ŒæœŸæœ›ç›¸å…³goroutineèƒ½æ­£å¸¸é€€å‡º
é—®é¢˜ï¼šå…¶ä¸­ä¸€ä¸ªgoroutineæ— æ³•é€€å‡º
æµ‹è¯•ä»£ç ï¼š
```go
func TestStop(t *testing.T) {
	var wg sync.WaitGroup
	p, _ := NewPoolWithFunc(1, func(i interface{}) {
		fmt.Println(""do task"", i)
		time.Sleep(2 * time.Second)
	})
	wg.Add(2)
	go func() {
		fmt.Println(""start aaa"")
		defer func() {
			wg.Done()
			fmt.Println(""stop aaa"")
		}()
		for i := 0; i < 30; i++ {
			p.Invoke(i)
		}
	}()

	go func() {
		fmt.Println(""start bbb"")
		defer func() {
			wg.Done()
			fmt.Println(""stop bbb"")
		}()
		for i := 100; i < 130; i++ {
			p.Invoke(i)
		}
	}()

	time.Sleep(5 * time.Second)
	p.Release()
	wg.Wait()
}
```
ants version: v2.4.7 SHA-1: 1e897421860606afc3d1304cafe5cd187cee13e9
go version: 1.17.2",,,,43245434,zhu121,7496278,panjf2000,82217,https://github.com/panjf2000/ants/issues/202,2022-02-08T13:53:49.000+08:00,2021-12-13T11:36:28.000+08:00,2022-02-08T13:53:49.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,225,
1080729448,134018330,203,closed,What is the appropriate number of goroutine pools for different hardware resources?," For example, what is the number of goroutine pools for a 4-core 8G device?
",,,,19580983,NICEXAI,7496278,panjf2000,1738,https://github.com/panjf2000/ants/issues/203,2021-12-16T21:29:49.000+08:00,2021-12-15T16:31:33.000+08:00,2021-12-16T21:29:49.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,226,
1083013181,134018330,204,closed,å¦‚ä½•è®¾ç½®åç¨‹æ± åˆå§‹åç¨‹çš„å¤§å°çš„å‘¢ï¼Ÿæœ‰æ²¡æœ‰è®¡ç®—å…¬å¼ï¼Ÿ,"**What is your question about ants?**
Please describe your question meticulously.
å¦‚ä½•è®¾ç½®åç¨‹æ± åˆå§‹åç¨‹çš„å¤§å°çš„å‘¢ï¼Ÿæœ‰æ²¡æœ‰è®¡ç®—å…¬å¼ï¼Ÿå½“å‰çš„æœºå™¨ç¯å¢ƒ4æ ¸8G",,,,12879248,18310983239,7496278,panjf2000,117996,https://github.com/panjf2000/ants/issues/204,2022-03-09T15:13:26.000+08:00,2021-12-17T16:36:44.000+08:00,2022-03-09T15:13:26.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,227,
1094905000,134018330,205,closed,å½“ä½¿ç”¨Tune(size int)æ”¾å¤§å®¹é‡æ—¶ï¼Œä¹‹å‰blockingçš„ä»»åŠ¡å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œ,"å½“ä½¿ç”¨Tune(size int)æ”¾å¤§å®¹é‡æ—¶ï¼Œä¹‹å‰blockingçš„ä»»åŠ¡å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œ
ç»è¿‡æµ‹è¯•ï¼Œæ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªä»»åŠ¡ç»“æŸåæ‰ä¼šæŒ‰ç…§å½“å‰è¢«Tuneåçš„çœŸå®capå»æ‰§è¡Œä»»åŠ¡

è¿™é‡Œæƒ³é—®ä¸€ä¸‹é™¤äº†æˆ‘åœ¨å¤–åšæŒºcapå˜åŒ–åå†æäº¤æ–°ä»»åŠ¡è¿™ç§æ–¹æ³•å¤–ï¼Œè¿˜æœ‰æ²¡æœ‰åˆ«çš„æ–¹æ³•å¯ä»¥è®©æˆ‘åœ¨æ”¾å¤§å®¹é‡åç«‹å³æ‰§è¡Œblockingçš„ä»»åŠ¡
",,,,12636470,nzx824,7496278,panjf2000,56848,https://github.com/panjf2000/ants/issues/205,2022-02-14T21:51:40.000+08:00,2022-01-06T10:23:30.000+08:00,2022-02-14T21:51:41.000+08:00,,,"{""Owner"":""panjf2000"",""Repo"":""ants""}",_raw_github_api_issues,228,
